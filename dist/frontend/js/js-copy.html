<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浅拷贝与深拷贝 | 一葦</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/icons/favicon.ico">
    <link rel="manifest" href="/blog/js/mainfest.json">
    <link rel="stylesheet" href="/blog/styles/css/style.css">
    <script type="utf-8" src="/blog/js/disable-user-zoom.js"></script>
    <meta name="description" content="这是一苇的前端技术博客哦~">
    <meta name="Author" content="一苇">
    <meta rel="keywords" content="verneyzhou,阿沐,一苇,前端,docs.verneyzhou-code.cn,博客,fe,IT,技术">
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport" content="width=device-width,width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/0.styles.61668f40.css" as="style"><link rel="preload" href="/blog/assets/js/app.76fa57e6.js" as="script"><link rel="preload" href="/blog/assets/js/3.a2a245ac.js" as="script"><link rel="preload" href="/blog/assets/js/60.0adc2f64.js" as="script"><link rel="preload" href="/blog/assets/js/4.245b4373.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2c3fb9b8.js"><link rel="prefetch" href="/blog/assets/js/100.84bf5092.js"><link rel="prefetch" href="/blog/assets/js/101.6b905b71.js"><link rel="prefetch" href="/blog/assets/js/102.7ece9162.js"><link rel="prefetch" href="/blog/assets/js/103.01775736.js"><link rel="prefetch" href="/blog/assets/js/104.c9b72bdf.js"><link rel="prefetch" href="/blog/assets/js/105.b7ceaf1e.js"><link rel="prefetch" href="/blog/assets/js/106.5321c092.js"><link rel="prefetch" href="/blog/assets/js/107.dfde808a.js"><link rel="prefetch" href="/blog/assets/js/108.76e55255.js"><link rel="prefetch" href="/blog/assets/js/109.b6b8f78e.js"><link rel="prefetch" href="/blog/assets/js/11.d8db7424.js"><link rel="prefetch" href="/blog/assets/js/110.03440fcf.js"><link rel="prefetch" href="/blog/assets/js/111.7001d092.js"><link rel="prefetch" href="/blog/assets/js/112.2c3ec8a9.js"><link rel="prefetch" href="/blog/assets/js/113.17aec38b.js"><link rel="prefetch" href="/blog/assets/js/114.d5c86b19.js"><link rel="prefetch" href="/blog/assets/js/115.c5e7ed6d.js"><link rel="prefetch" href="/blog/assets/js/116.c48f3f00.js"><link rel="prefetch" href="/blog/assets/js/117.46f33ca4.js"><link rel="prefetch" href="/blog/assets/js/118.891ade5b.js"><link rel="prefetch" href="/blog/assets/js/119.58a54ba4.js"><link rel="prefetch" href="/blog/assets/js/12.b6309f61.js"><link rel="prefetch" href="/blog/assets/js/120.e96a1ea7.js"><link rel="prefetch" href="/blog/assets/js/121.ba217794.js"><link rel="prefetch" href="/blog/assets/js/122.fa395dd6.js"><link rel="prefetch" href="/blog/assets/js/123.8dee52e0.js"><link rel="prefetch" href="/blog/assets/js/124.5964facb.js"><link rel="prefetch" href="/blog/assets/js/125.2b5713d4.js"><link rel="prefetch" href="/blog/assets/js/126.0b020030.js"><link rel="prefetch" href="/blog/assets/js/127.73d8db3a.js"><link rel="prefetch" href="/blog/assets/js/128.e350bccb.js"><link rel="prefetch" href="/blog/assets/js/129.6efe4916.js"><link rel="prefetch" href="/blog/assets/js/13.8df65d8d.js"><link rel="prefetch" href="/blog/assets/js/130.2feb4a2a.js"><link rel="prefetch" href="/blog/assets/js/131.ebf7c589.js"><link rel="prefetch" href="/blog/assets/js/132.2fd4ea82.js"><link rel="prefetch" href="/blog/assets/js/133.e9db689a.js"><link rel="prefetch" href="/blog/assets/js/134.8c37cc25.js"><link rel="prefetch" href="/blog/assets/js/135.ae783483.js"><link rel="prefetch" href="/blog/assets/js/136.92671aff.js"><link rel="prefetch" href="/blog/assets/js/137.0db285b2.js"><link rel="prefetch" href="/blog/assets/js/138.c73abe07.js"><link rel="prefetch" href="/blog/assets/js/139.41626f14.js"><link rel="prefetch" href="/blog/assets/js/14.b950268f.js"><link rel="prefetch" href="/blog/assets/js/140.99fdcd5c.js"><link rel="prefetch" href="/blog/assets/js/141.fbc8e614.js"><link rel="prefetch" href="/blog/assets/js/142.4f34e195.js"><link rel="prefetch" href="/blog/assets/js/143.127a9850.js"><link rel="prefetch" href="/blog/assets/js/144.0f65824d.js"><link rel="prefetch" href="/blog/assets/js/145.1ee8c5fc.js"><link rel="prefetch" href="/blog/assets/js/146.3ba627c8.js"><link rel="prefetch" href="/blog/assets/js/147.09e3708c.js"><link rel="prefetch" href="/blog/assets/js/148.5e218851.js"><link rel="prefetch" href="/blog/assets/js/149.0e52c725.js"><link rel="prefetch" href="/blog/assets/js/15.030ef122.js"><link rel="prefetch" href="/blog/assets/js/150.d3ae11a8.js"><link rel="prefetch" href="/blog/assets/js/151.817b960d.js"><link rel="prefetch" href="/blog/assets/js/152.5a77e7f4.js"><link rel="prefetch" href="/blog/assets/js/153.5bc9a462.js"><link rel="prefetch" href="/blog/assets/js/154.d4c7af79.js"><link rel="prefetch" href="/blog/assets/js/155.dc03710e.js"><link rel="prefetch" href="/blog/assets/js/156.5e872d85.js"><link rel="prefetch" href="/blog/assets/js/157.9e2becea.js"><link rel="prefetch" href="/blog/assets/js/158.a2942e85.js"><link rel="prefetch" href="/blog/assets/js/159.26c63404.js"><link rel="prefetch" href="/blog/assets/js/16.cfb1a53b.js"><link rel="prefetch" href="/blog/assets/js/160.96d3beaa.js"><link rel="prefetch" href="/blog/assets/js/161.c34c5b2e.js"><link rel="prefetch" href="/blog/assets/js/162.45223b4c.js"><link rel="prefetch" href="/blog/assets/js/163.dca039a1.js"><link rel="prefetch" href="/blog/assets/js/164.c188755b.js"><link rel="prefetch" href="/blog/assets/js/165.774591a1.js"><link rel="prefetch" href="/blog/assets/js/166.0bb7199e.js"><link rel="prefetch" href="/blog/assets/js/167.6c729c82.js"><link rel="prefetch" href="/blog/assets/js/168.9ddae43f.js"><link rel="prefetch" href="/blog/assets/js/169.a041747e.js"><link rel="prefetch" href="/blog/assets/js/17.7f17682b.js"><link rel="prefetch" href="/blog/assets/js/170.b70b623c.js"><link rel="prefetch" href="/blog/assets/js/171.4b0257b9.js"><link rel="prefetch" href="/blog/assets/js/172.7f4c2d3c.js"><link rel="prefetch" href="/blog/assets/js/173.b3b75dfa.js"><link rel="prefetch" href="/blog/assets/js/174.52d7ea40.js"><link rel="prefetch" href="/blog/assets/js/175.beb33995.js"><link rel="prefetch" href="/blog/assets/js/176.95e06720.js"><link rel="prefetch" href="/blog/assets/js/177.f491f17d.js"><link rel="prefetch" href="/blog/assets/js/178.71c66889.js"><link rel="prefetch" href="/blog/assets/js/179.ca760d60.js"><link rel="prefetch" href="/blog/assets/js/18.cbfdeb09.js"><link rel="prefetch" href="/blog/assets/js/180.b50d733c.js"><link rel="prefetch" href="/blog/assets/js/181.335287be.js"><link rel="prefetch" href="/blog/assets/js/182.8cad2bdb.js"><link rel="prefetch" href="/blog/assets/js/183.37a5fb7a.js"><link rel="prefetch" href="/blog/assets/js/184.e920bd7f.js"><link rel="prefetch" href="/blog/assets/js/185.0ffd8f98.js"><link rel="prefetch" href="/blog/assets/js/186.b9b7e58a.js"><link rel="prefetch" href="/blog/assets/js/187.ee242116.js"><link rel="prefetch" href="/blog/assets/js/188.a7f885d1.js"><link rel="prefetch" href="/blog/assets/js/189.41087ead.js"><link rel="prefetch" href="/blog/assets/js/19.355e9671.js"><link rel="prefetch" href="/blog/assets/js/190.0ff0d636.js"><link rel="prefetch" href="/blog/assets/js/191.b0c298a8.js"><link rel="prefetch" href="/blog/assets/js/192.e1fdc41d.js"><link rel="prefetch" href="/blog/assets/js/193.a12e8cc4.js"><link rel="prefetch" href="/blog/assets/js/194.552a7d72.js"><link rel="prefetch" href="/blog/assets/js/195.65c94003.js"><link rel="prefetch" href="/blog/assets/js/196.7ecad629.js"><link rel="prefetch" href="/blog/assets/js/197.769eb8f4.js"><link rel="prefetch" href="/blog/assets/js/198.417e877e.js"><link rel="prefetch" href="/blog/assets/js/199.c198e821.js"><link rel="prefetch" href="/blog/assets/js/20.925de35d.js"><link rel="prefetch" href="/blog/assets/js/200.aaf0c7da.js"><link rel="prefetch" href="/blog/assets/js/201.b9b528a4.js"><link rel="prefetch" href="/blog/assets/js/202.dc2130c4.js"><link rel="prefetch" href="/blog/assets/js/203.494c16a2.js"><link rel="prefetch" href="/blog/assets/js/204.5451a8b2.js"><link rel="prefetch" href="/blog/assets/js/205.3a9d9143.js"><link rel="prefetch" href="/blog/assets/js/206.8f218f53.js"><link rel="prefetch" href="/blog/assets/js/207.e286efec.js"><link rel="prefetch" href="/blog/assets/js/208.b15e7ceb.js"><link rel="prefetch" href="/blog/assets/js/209.8be13a1b.js"><link rel="prefetch" href="/blog/assets/js/21.73aa97dc.js"><link rel="prefetch" href="/blog/assets/js/210.8af7e1c3.js"><link rel="prefetch" href="/blog/assets/js/211.cf4f7aba.js"><link rel="prefetch" href="/blog/assets/js/212.b1e8078a.js"><link rel="prefetch" href="/blog/assets/js/213.99b7c2dd.js"><link rel="prefetch" href="/blog/assets/js/214.3073fbf3.js"><link rel="prefetch" href="/blog/assets/js/215.7884f71b.js"><link rel="prefetch" href="/blog/assets/js/216.fc4df39d.js"><link rel="prefetch" href="/blog/assets/js/217.dcf694ab.js"><link rel="prefetch" href="/blog/assets/js/218.91ac665b.js"><link rel="prefetch" href="/blog/assets/js/219.04f0e072.js"><link rel="prefetch" href="/blog/assets/js/22.a5e696f3.js"><link rel="prefetch" href="/blog/assets/js/220.ec5aa358.js"><link rel="prefetch" href="/blog/assets/js/221.eeacfb35.js"><link rel="prefetch" href="/blog/assets/js/222.6d68084c.js"><link rel="prefetch" href="/blog/assets/js/223.6d1ff62a.js"><link rel="prefetch" href="/blog/assets/js/224.b1682e38.js"><link rel="prefetch" href="/blog/assets/js/23.e58011e2.js"><link rel="prefetch" href="/blog/assets/js/24.9a66d8cd.js"><link rel="prefetch" href="/blog/assets/js/25.bbfbc411.js"><link rel="prefetch" href="/blog/assets/js/26.0a58cb04.js"><link rel="prefetch" href="/blog/assets/js/27.30ff8122.js"><link rel="prefetch" href="/blog/assets/js/28.1b138f63.js"><link rel="prefetch" href="/blog/assets/js/29.8706dde6.js"><link rel="prefetch" href="/blog/assets/js/30.7354bbdd.js"><link rel="prefetch" href="/blog/assets/js/31.42f329d7.js"><link rel="prefetch" href="/blog/assets/js/32.89b2e87d.js"><link rel="prefetch" href="/blog/assets/js/33.e762c9a2.js"><link rel="prefetch" href="/blog/assets/js/34.c4cc6afc.js"><link rel="prefetch" href="/blog/assets/js/35.a3e5fba6.js"><link rel="prefetch" href="/blog/assets/js/36.03e0ebe8.js"><link rel="prefetch" href="/blog/assets/js/37.ec453e24.js"><link rel="prefetch" href="/blog/assets/js/38.cf1f5fcf.js"><link rel="prefetch" href="/blog/assets/js/39.1156b141.js"><link rel="prefetch" href="/blog/assets/js/40.d33ba184.js"><link rel="prefetch" href="/blog/assets/js/41.2820e583.js"><link rel="prefetch" href="/blog/assets/js/42.c088f38a.js"><link rel="prefetch" href="/blog/assets/js/43.a832abeb.js"><link rel="prefetch" href="/blog/assets/js/44.9391c80d.js"><link rel="prefetch" href="/blog/assets/js/45.a0235304.js"><link rel="prefetch" href="/blog/assets/js/46.9730b825.js"><link rel="prefetch" href="/blog/assets/js/47.56fd5076.js"><link rel="prefetch" href="/blog/assets/js/48.b5374317.js"><link rel="prefetch" href="/blog/assets/js/49.8bb025d5.js"><link rel="prefetch" href="/blog/assets/js/5.32a2e1b6.js"><link rel="prefetch" href="/blog/assets/js/50.8011aa1f.js"><link rel="prefetch" href="/blog/assets/js/51.a915dbc4.js"><link rel="prefetch" href="/blog/assets/js/52.99d2399f.js"><link rel="prefetch" href="/blog/assets/js/53.be187caf.js"><link rel="prefetch" href="/blog/assets/js/54.07b08901.js"><link rel="prefetch" href="/blog/assets/js/55.3ef99688.js"><link rel="prefetch" href="/blog/assets/js/56.9258b8d8.js"><link rel="prefetch" href="/blog/assets/js/57.4762d5e6.js"><link rel="prefetch" href="/blog/assets/js/58.8d1268be.js"><link rel="prefetch" href="/blog/assets/js/59.20eb3b71.js"><link rel="prefetch" href="/blog/assets/js/6.9db196de.js"><link rel="prefetch" href="/blog/assets/js/61.7a4bb849.js"><link rel="prefetch" href="/blog/assets/js/62.4b595b7b.js"><link rel="prefetch" href="/blog/assets/js/63.8efe6050.js"><link rel="prefetch" href="/blog/assets/js/64.2daf2555.js"><link rel="prefetch" href="/blog/assets/js/65.01aa6930.js"><link rel="prefetch" href="/blog/assets/js/66.b71e30c2.js"><link rel="prefetch" href="/blog/assets/js/67.b88d5dfc.js"><link rel="prefetch" href="/blog/assets/js/68.0455a3ce.js"><link rel="prefetch" href="/blog/assets/js/69.aac22b54.js"><link rel="prefetch" href="/blog/assets/js/7.c958551b.js"><link rel="prefetch" href="/blog/assets/js/70.513be29f.js"><link rel="prefetch" href="/blog/assets/js/71.dda331fc.js"><link rel="prefetch" href="/blog/assets/js/72.20dc430c.js"><link rel="prefetch" href="/blog/assets/js/73.5046c7ef.js"><link rel="prefetch" href="/blog/assets/js/74.436c2c94.js"><link rel="prefetch" href="/blog/assets/js/75.717953f1.js"><link rel="prefetch" href="/blog/assets/js/76.4898deac.js"><link rel="prefetch" href="/blog/assets/js/77.1417b15d.js"><link rel="prefetch" href="/blog/assets/js/78.d51e77f9.js"><link rel="prefetch" href="/blog/assets/js/79.e7af2572.js"><link rel="prefetch" href="/blog/assets/js/8.d5f2c1ba.js"><link rel="prefetch" href="/blog/assets/js/80.f5d5c456.js"><link rel="prefetch" href="/blog/assets/js/81.e46213a6.js"><link rel="prefetch" href="/blog/assets/js/82.a2b78450.js"><link rel="prefetch" href="/blog/assets/js/83.ec57022e.js"><link rel="prefetch" href="/blog/assets/js/84.1a1e65b2.js"><link rel="prefetch" href="/blog/assets/js/85.453ecac0.js"><link rel="prefetch" href="/blog/assets/js/86.98f2e40a.js"><link rel="prefetch" href="/blog/assets/js/87.56486cd5.js"><link rel="prefetch" href="/blog/assets/js/88.25a76bc5.js"><link rel="prefetch" href="/blog/assets/js/89.0a157175.js"><link rel="prefetch" href="/blog/assets/js/9.952385f9.js"><link rel="prefetch" href="/blog/assets/js/90.5b516e54.js"><link rel="prefetch" href="/blog/assets/js/91.6d74ff97.js"><link rel="prefetch" href="/blog/assets/js/92.3b2d151b.js"><link rel="prefetch" href="/blog/assets/js/93.f20ce1f2.js"><link rel="prefetch" href="/blog/assets/js/94.c3062efe.js"><link rel="prefetch" href="/blog/assets/js/95.206ed12d.js"><link rel="prefetch" href="/blog/assets/js/96.fad1a27d.js"><link rel="prefetch" href="/blog/assets/js/97.23b93196.js"><link rel="prefetch" href="/blog/assets/js/98.a90f6f17.js"><link rel="prefetch" href="/blog/assets/js/99.adc32b70.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.381052ad.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.61668f40.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/icons/apple-touch-icon.png" alt="一葦" class="logo"> <span class="site-name can-hide">一葦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/js/" class="nav-link router-link-active">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/blog/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/blog/more/" class="nav-link">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/blog/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/blog/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/blog/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/more/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">其他</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/about/" class="nav-link">ME</a></li><li class="dropdown-item"><!----> <a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="images/poster03.jpeg"> <div class="blogger-info"><h3></h3> <span>是旷野，不是轨道哦，少年。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/js/" class="nav-link router-link-active">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/blog/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/blog/more/" class="nav-link">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/blog/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/blog/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/blog/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/more/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">其他</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/about/" class="nav-link">ME</a></li><li class="dropdown-item"><!----> <a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>浅拷贝与深拷贝</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frontend/js/js-copy.html#开始之前" class="sidebar-link">开始之前</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#js的的数据类型" class="sidebar-link">js的的数据类型</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#赋值、浅拷贝、和深拷贝" class="sidebar-link">赋值、浅拷贝、和深拷贝</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#赋值-copy" class="sidebar-link">赋值（copy）</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#浅拷贝与深拷贝-2" class="sidebar-link">浅拷贝与深拷贝</a></li></ul></li><li><a href="/blog/frontend/js/js-copy.html#浅拷贝的实现方法" class="sidebar-link">浅拷贝的实现方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_1-object-assign" class="sidebar-link">1. Object.assign</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_2-for-in-hasownproperty" class="sidebar-link">2. for...in+hasOwnProperty</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_3-扩展运算符" class="sidebar-link">3. ...扩展运算符</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_4-slice和concat方法-仅限数组" class="sidebar-link">4. slice和concat方法（仅限数组）</a></li></ul></li><li><a href="/blog/frontend/js/js-copy.html#深拷贝的实现方法" class="sidebar-link">深拷贝的实现方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_1-基础版" class="sidebar-link">1. 基础版</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_2-进阶版-递归实现" class="sidebar-link">2. 进阶版：递归实现</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#问题分析" class="sidebar-link">问题分析</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_3-轻奢版-while循环实现" class="sidebar-link">3. 轻奢版：while循环实现</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#_4-最终版" class="sidebar-link">4. 最终版</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#其他" class="sidebar-link">其他</a></li></ul></li><li><a href="/blog/frontend/js/js-copy.html#备注" class="sidebar-link">备注</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/frontend/js/js-copy.html#后记" class="sidebar-link">后记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/js/js-copy.html#递归优化版" class="sidebar-link">递归优化版</a></li></ul></li><li><a href="/blog/frontend/js/js-copy.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/blog/categories/?category=frontend" title="分类" data-v-0c557b5e>frontend</a></li><li data-v-0c557b5e><a href="/blog/categories/?category=js" title="分类" data-v-0c557b5e>js</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>阿沐</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2021-04-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">浅拷贝与深拷贝<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="浅拷贝与深拷贝"><a href="#浅拷贝与深拷贝" class="header-anchor">#</a> 浅拷贝与深拷贝</h1> <p>这里是我的浅拷贝和深拷贝的学习记录。</p> <h2 id="开始之前"><a href="#开始之前" class="header-anchor">#</a> 开始之前</h2> <p>开始之前，先梳理几个基本概念。</p> <h3 id="js的的数据类型"><a href="#js的的数据类型" class="header-anchor">#</a> js的的数据类型</h3> <p>JS中的数据类型主要分为基本数据类型和引用数据类型。</p> <ul><li><p><strong>基本数据类型</strong></p> <ul><li>ES5之前基本数据类型主要包括：<code>String、Number、Boolean、Null、undifiend</code>五种；</li> <li>ES6又新增了一种新的基本数据类型：<a href="https://es6.ruanyifeng.com/#docs/symbol" target="_blank" rel="noopener noreferrer">Symbol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，表示独一无二的值；</li> <li>在JavaScript中，<code>Number</code>可以准确表达的最大数字是2<sup>53</sup>，现在ES10又新增了一种新的数据类型<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt" target="_blank" rel="noopener noreferrer">BigInt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用于表示大于<code>2^53 - 1</code>的整数，<code>BigInt</code>可以表示任意大的整数，V8引擎<code>v6.7</code>默认启用对 BigInt 的支持。</li></ul></li> <li><p><strong>引用数据类型</strong></p> <p>引用数据类型主要包括：<code>Object、Array、Function、Date、RegExp</code>等复杂数据类型，包括ES6新增的<code>Map、Set</code>等；js的引用数据类型本质上都是对象类型。</p></li></ul> <blockquote><p>基本数据类型是存在<strong>栈内存</strong>中的，引用类型是存在<strong>堆内存</strong>中的，但是<strong>引用类型的引用还是存在栈内存</strong>中的。关于堆内存和栈内存的介绍我在<a href="./async-js">js的事件循环</a>中有过讲解，这里不再赘述。</p></blockquote> <h3 id="赋值、浅拷贝、和深拷贝"><a href="#赋值、浅拷贝、和深拷贝" class="header-anchor">#</a> 赋值、浅拷贝、和深拷贝</h3> <p>这里先梳理下赋值、浅拷贝、和深拷贝的区别。</p> <h4 id="赋值-copy"><a href="#赋值-copy" class="header-anchor">#</a> 赋值（copy）</h4> <p>对于基本数据类型来说，当我们进行赋值操作<code>=</code>时，实际上是在内存中新开一段栈内存，然后再将值赋值到新的栈中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a
a <span class="token operator">=</span> <span class="token number">5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p>赋值之后两个变量互不影响。</p> <p>而对于引用数据类型来说，在进行赋值操作时，实际上是<strong>按址传递</strong>：把变量的地址传给了另一个变量，所以称为传址。传址之后，两个变量就指向同一个地址，两者的操作是互有影响的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>

a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'rose'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rose</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rose</span>
</code></pre></div><h4 id="浅拷贝与深拷贝-2"><a href="#浅拷贝与深拷贝-2" class="header-anchor">#</a> 浅拷贝与深拷贝</h4> <ul><li><strong>什么是浅拷贝（shallow-copy）？</strong></li></ul> <blockquote><p><strong>创建一个新对象，该对象拥有原始对象第一层属性的精确拷贝</strong>。如果属性是基本类型，拷贝的就是基本类型的值，如果属性是引用类型，拷贝的就是内存地址 ，所以如果其中一个对象改变了这个地址，就会影响到另一个对象。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 浅拷贝</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span>
	b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// [5, [2, 6], 4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// [1, [2, 6], 4]</span>
</code></pre></div><p>以上b对象对a对象实现了一个浅拷贝，<code>a[0]</code>是一个基本数据类型<code>Number</code>，所以更改互不影响；<code>a[1]</code>是一个对象，所以里面的修改会互相影响。</p> <ul><li><strong>什么是深拷贝（deep-copy）？</strong></li></ul> <blockquote><p><strong>创建一个新对象，该对象有着对原始对象所有层级属性的递归精确拷贝</strong>。将一个对象从内存中完整的拷贝一份出来,从堆内存中开辟一个新的区域存放新对象,且修改新对象不会影响原对象。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 深拷贝</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// [5, [2, 6], 4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// [1, [2, 3], 4]</span>
</code></pre></div><p>深拷贝之后，原对象a的修改就不会影响目标对象b。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ol><li>对于基本数据类型来说，不存在赋值、深浅拷贝这个问题，每次赋值都相当于是一次深拷贝；深拷贝和浅拷贝都是针对js的引用数据类型。</li> <li>浅拷贝与赋值是有所区别的，赋值是与原数据指向同一对象，而浅拷贝则指向了不同对象。</li> <li>浅拷贝只对数据的引用地址进行复制，只复制保存在栈内存中的地址，指向堆内存中存储的值却还是只有一份，这样当对其中一个变量进行修改时，另一个就会受影响；</li> <li>而深拷贝则是对源对象进行多层级的复制，使<strong>栈内存中地址和堆内存中值都复制一份</strong>，彻底切断跟源对象的联系，这样彼此的修改就不会受影响。</li></ol></div> <ul><li>对比</li></ul> <table><thead><tr><th></th> <th>和原数据是否指向同一对象</th> <th>第一层数据的基本数据类型</th> <th>原数据中的子对象</th></tr></thead> <tbody><tr><td>赋值</td> <td>是</td> <td>修改会受影响</td> <td>修改会受影响</td></tr> <tr><td>浅拷贝</td> <td>否</td> <td>修改不会受影响</td> <td>修改会受影响</td></tr> <tr><td>深拷贝</td> <td>否</td> <td>修改不会受影响</td> <td>修改不会受影响</td></tr></tbody></table> <h2 id="浅拷贝的实现方法"><a href="#浅拷贝的实现方法" class="header-anchor">#</a> 浅拷贝的实现方法</h2> <p>先简单讲几个浅拷贝的方法。</p> <h3 id="_1-object-assign"><a href="#_1-object-assign" class="header-anchor">#</a> 1. <code>Object.assign</code></h3> <blockquote><p>ES6新增的方法：<a href="https://es6.ruanyifeng.com/#docs/object-methods#Object-assign" target="_blank" rel="noopener noreferrer">Object.assign<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用于将所有可枚举属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">,</span> obj1<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {b: 2} 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">,</span> obj2<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {b: 2} 2</span>
</code></pre></div><p>源对象obj1的a属性的值是一个对象，Object.assign()拷贝得到的是这个对象的引用。这个对象的任何变化，都会反映到目标对象上面。</p> <h3 id="_2-for-in-hasownproperty"><a href="#_2-for-in-hasownproperty" class="header-anchor">#</a> 2. <code>for...in</code>+<code>hasOwnProperty</code></h3> <blockquote><p><code>for...in</code>这个方法在上面已经简单用过，这里对其进行完善。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// shallowCopy(目标对象,源对象1,源对象2,...)</span>
<span class="token keyword">function</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// target为传入的第一个参数：目标对象</span>
    <span class="token comment">// 第一个为目标对象，从第二个参数开始，循环传入的源对象</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> source <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环每个源对象的属性</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> obj1<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'rose'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: {b: 2}, c: 2, name: &quot;rose&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: {b: 2}, c: 3, name: &quot;tom&quot;}</span>
</code></pre></div><p>这个方法也是只复制第一层，和<code>Object.assign</code>功能类似。</p> <h3 id="_3-扩展运算符"><a href="#_3-扩展运算符" class="header-anchor">#</a> 3. <code>...</code>扩展运算符</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>obj1<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'rose'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: {b: 2}, name: &quot;rose&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: {b: 2}, name: &quot;tom&quot;}</span>
</code></pre></div><p>只拷贝obj1的第一层，基础类型拷贝值，复杂类型拷贝引用。</p> <h3 id="_4-slice和concat方法-仅限数组"><a href="#_4-slice和concat方法-仅限数组" class="header-anchor">#</a> 4. <code>slice</code>和<code>concat</code>方法（仅限数组）</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// let b = a.slice(); // 返回新数组</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回新数组</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [11, [2, 33], 4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, [2, 33], 4]</span>
</code></pre></div><h2 id="深拷贝的实现方法"><a href="#深拷贝的实现方法" class="header-anchor">#</a> 深拷贝的实现方法</h2> <h3 id="_1-基础版"><a href="#_1-基础版" class="header-anchor">#</a> 1. 基础版</h3> <blockquote><p><code>JSON.parse</code>+<code>JSON.stringify</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">cloneJSON</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">e</span><span class="token operator">:</span> isNaN<span class="token punctuation">,</span> <span class="token literal-property property">f</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">h</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'symbol'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token function">cloneJSON</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {d: 2, f: {…}, g: &quot;2021-04-13T11:20:24.860Z&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tue Apr 13 2021 19:20:24 GMT+0800 (中国标准时间)</span>
</code></pre></div><p>这个是最简单的方法，虽然能满足大多数场景，但兼容性不好，无法对<code>正则</code>进行精准拷贝，无法正确拷贝<code>Date</code>格式，无法对<code>函数、undefined、Symbol</code>这些类型的数据进行拷贝。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 会把值为undefined的过滤掉</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {a: 1, c: null}</span>
</code></pre></div><ul><li><strong>栈溢出</strong></li></ul> <blockquote><p>还有一个很重要的问题是，用这个方法，当源对象层级过深时，容易出现<strong>栈溢出</strong>。怎么看出来会栈溢出的呢？这里用一个方法判断一下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义一个自动生成嵌套对象的函数</span>
<span class="token comment">// deep 生成对象层数，每层的数据个数</span>
<span class="token keyword">function</span> <span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token parameter">deep<span class="token punctuation">,</span> breadth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> temp <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deep<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历层数</span>
        temp <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// *** 这行代码实现了层级嵌套 ***</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> breadth<span class="token punctuation">;</span> j <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历个数，赋值</span>
            temp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {data: {0:0,1:1,2:2, data:{0:0,1:1,2:2, data:{0:0,1:1,2:2}}}}</span>
</code></pre></div><p><code>createObjData</code>这个方法挺巧妙的，主要是利用对象<code>=</code>赋值运算符可以复制对象引用的特性，实现数据层级的嵌套。下面试一下刚才的<code>cloneJSON</code>方法复制层级过多的数据会不会栈溢出：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">cloneJSON</span><span class="token punctuation">(</span><span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Maximum call stack size exceeded</span>
</code></pre></div><p>果不其然，直接报错了：<code>Maximum call stack size exceeded</code>。</p> <p>这个问题先放一放，我们先看看另外的实现深拷贝的方法：</p> <h3 id="_2-进阶版-递归实现"><a href="#_2-进阶版-递归实现" class="header-anchor">#</a> 2. 进阶版：递归实现</h3> <p><code>for...in</code>+<code>hasOwnProperty</code>递归实现。</p> <blockquote><p>这个方法是刚才浅拷贝中<code>for...in</code>+<code>hasOwnProperty</code>方法的延伸，浅拷贝中只是用于对源对象第一层数据的复制，这里可以通过递归对更深层级的数据进行复制。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 先定义个判断object类型（引用类型）判断的方法</span>
<span class="token comment">// 这个方法可以对Object,Array，Set,Map，Date,RegExp这些引用类型的数据进行判断，它们的实例都是对象；考虑Function和null这两种特殊类型</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> obj <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span> <span class="token comment">// 如果不是引用类型直接返回当前值</span>

    <span class="token keyword">var</span> res <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 数组兼容</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'[object Object]'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'[object Array]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是对象或数组，递归调用</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span> <span class="token comment">// 其他类型，直接赋值</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">e</span><span class="token operator">:</span> isNaN<span class="token punctuation">,</span> <span class="token literal-property property">f</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">h</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'symbol'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tue Apr 13 2021 19:22:14 GMT+0800 (中国标准时间)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {d: 2, f: /\s/g, g: Tue Apr 13 2021 19:22:14 GMT+0800 (中国标准时间), h: undefined, e: ƒ, i: Symbol('symbol')}</span>
</code></pre></div><p>该方法实现了：</p> <ul><li>实现了对<code>函数、正则、Symbol、undefined</code>等类型数据的拷贝，也能正确复制<code>Date</code>格式；</li> <li>提供了是否是引用类型的判断方法，对参数类型做了校验；</li> <li>兼容了数组类型</li></ul> <p>接着用刚才的<code>createObjData</code>方法看看还会不会发生栈溢出呢？</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">deepCopy</span><span class="token punctuation">(</span><span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以正常打印，说明数据长度不会影响发生栈溢出</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">deepCopy</span><span class="token punctuation">(</span><span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught RangeError: Maximum call stack size exceeded</span>
</code></pre></div><p>果不其然，报错依旧：<code>Maximum call stack size exceeded</code></p> <ul><li><strong>循环引用</strong></li></ul> <blockquote><p>还有一种容易发生栈溢出的情况需要注意一下:</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// 循环嵌套</span>
<span class="token function">deepCopy</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Maximum call stack size exceeded 这样直接死循环了</span>
<span class="token function">cloneJSON</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: Converting circular structure to JSON</span>
</code></pre></div><p><code>JSON.stringify</code>内部做了循环引用的检测，所以没有发生死循环导致栈溢出，但还是报错了。</p> <ul><li><strong>引用丢失</strong></li></ul> <blockquote><p>再来看另一种情况：</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a1</span><span class="token operator">:</span> b<span class="token punctuation">,</span> <span class="token literal-property property">a2</span><span class="token operator">:</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>a1 <span class="token operator">===</span> a<span class="token punctuation">.</span>a2<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">deepCopy</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>a1 <span class="token operator">===</span> c<span class="token punctuation">.</span>a2<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>一个对象a，a下面的两个键值都引用同一个对象b，经过深拷贝后，a的两个键值会丢失引用关系，从而变成两个不同的对象，这又出现了另一个问题：<strong>引用丢失</strong>。</p> <div class="custom-block tip"><p class="custom-block-title">整理下上面两种方法容易出现的问题：</p> <ol><li>递归调用容易出现栈溢出；</li> <li>循环引用会死循环，报错；</li> <li>会发生引用丢失。</li></ol></div> <p>下面针对这些问题简单分析一下：</p> <h4 id="问题分析"><a href="#问题分析" class="header-anchor">#</a> 问题分析</h4> <ul><li>栈溢出</li></ul> <blockquote><p>栈溢出的主要原因还是递归；在js中递归非常耗费内存，因为需要同时保存成千上百个调用帧，很容易发生“栈溢出”错误。解决这个问题的方法就是不用递归，改用循环来实现。</p></blockquote> <p>刚才的方法中循环是使用<code>for...in</code>实现，其实<code>for...in</code>循环需要读属性和原型链，当数据比较多时就会比较慢，可以采用<code>while</code>循环，提高循环效率。</p> <ul><li>循环引用</li></ul> <blockquote><p>循环引用是因为对象的属性间接或直接的引用了自身，最终导致死循环；解决循环引用问题，我们可以额外开辟一个存储空间，来存储当前对象和拷贝对象的对应关系，当需要拷贝当前对象时，先去存储空间中找，有没有拷贝过这个对象，如果有的话直接返回，如果没有的话继续拷贝，这样就巧妙化解的循环引用的问题。</p></blockquote> <p>这个存储空间，需要可以存储key-value形式的数据，且key可以是一个引用类型，可以选择<a href="https://es6.ruanyifeng.com/#docs/set-map#Map" target="_blank" rel="noopener noreferrer">Map<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这种数据结构。</p> <ul><li>引用丢失</li></ul> <blockquote><p>如果我们发现一个新对象就把这个对象和他的拷贝存下来，每次拷贝对象前，都先看一下这个对象是不是已经拷贝过了，如果拷贝过了，就不需要拷贝了，直接用原来的，这样我们就能够保留引用关系了；解决方法和循环引用的方法差不多。</p></blockquote> <p>除了上面的这些问题，还有一个重要的问题需要考虑：</p> <ul><li>对其他引用类型的兼容</li></ul> <blockquote><p>js的有好几种引用数据类型，包含：<code>Set、Map、Function、RegExp</code>等等，在上一个方法中只兼容了<code>Object</code>和<code>Array</code>类型，还需要对其他类型进行兼容处理</p></blockquote> <p>接下来先用<code>while</code>循环来实现深拷贝，解决递归爆栈的问题：</p> <h3 id="_3-轻奢版-while循环实现"><a href="#_3-轻奢版-while循环实现" class="header-anchor">#</a> 3. 轻奢版：while循环实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepCopyLoop</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> target<span class="token punctuation">;</span> <span class="token comment">// 如果不是对象的话直接返回当前值</span>

    <span class="token keyword">const</span> root <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 初始化root，兼容数组</span>
    <span class="token keyword">const</span> <span class="token function-variable function">type</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">targ</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>targ<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 判断类型</span>

    <span class="token comment">// 初始化一个栈，</span>
    <span class="token keyword">const</span> stackList <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">parent</span><span class="token operator">:</span> root<span class="token punctuation">,</span> <span class="token comment">// 父节点</span>
            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> target <span class="token comment">// 需要拷贝的节点</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

    <span class="token comment">// 循环遍历stackList</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>stackList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> stackList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移除栈的最后一个元素：pop() 方法用于删除并返回数组的最后一个元素</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">}</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>

        <span class="token comment">// 初始化赋值目标，key为undefined则拷贝到父元素，不是则拷贝到子元素</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> key <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取keys信息</span>
        <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span> <span class="token operator">?</span> data <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// while循环遍历</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span> <span class="token operator">?</span> i <span class="token operator">:</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log(i, key);</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断是否含有这个属性</span>
                <span class="token keyword">let</span> val <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// 如果是对象或数组，就在stackList中添加一组数据，不是则直接赋值</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span> <span class="token operator">||</span> <span class="token function">type</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">parent</span><span class="token operator">:</span> res<span class="token punctuation">,</span> <span class="token comment">// 将res赋值给parent，之后再次循环stackList时，进行相同的判断</span>
                        key<span class="token punctuation">,</span> <span class="token comment">// 保存key</span>
                        <span class="token literal-property property">data</span><span class="token operator">:</span> val <span class="token comment">// </span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            i <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> root<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>试一下看看还有没有栈溢出问题：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">deepCopyLoop</span><span class="token punctuation">(</span><span class="token function">createObjData</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {data: {…}}</span>
</code></pre></div><p>正常打印，果然解决了！</p> <ul><li>关于<code>while</code>里面的代码的执行逻辑有点绕，需要静下心来好好梳理，其实并不复杂，大致就是定义一个<code>list</code>用于保存拷贝信息，对每项数据进行循环，如果里面存在数组或对象，就生成一组新的拷贝信息，push到这个list中，继续循环遍历；</li> <li>由于刚开始初始化栈list的时候已经将<code>root</code>赋值给<code>parent</code>，之后又将<code>parent</code>赋值给<code>res</code>，之后的操作就是循环每组数据的<code>data</code>，将数据拷贝到<code>res</code>中，一层层嵌套下去，最终<code>root</code>中就获取到所有拷贝的数据。</li></ul> <blockquote><p>接下来，主要要做的就是用<code>Map</code>提供数据缓存，解决死循环和引用丢失的问题；并对其他类型做兼容。</p></blockquote> <h3 id="_4-最终版"><a href="#_4-最终版" class="header-anchor">#</a> 4. 最终版</h3> <p>直接上完整代码吧~</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
*常用数据类型
* 这里按是否可遍历分为两类，可遍历的如对象、数组，里面可以添加其他类型数据，需要单独处理
*/</span>
<span class="token comment">// 可遍历的数据类型</span>
<span class="token keyword">const</span> mapTag <span class="token operator">=</span> <span class="token string">'[object Map]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> setTag <span class="token operator">=</span> <span class="token string">'[object Set]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> arrayTag <span class="token operator">=</span> <span class="token string">'[object Array]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> objectTag <span class="token operator">=</span> <span class="token string">'[object Object]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> argsTag <span class="token operator">=</span> <span class="token string">'[object Arguments]'</span><span class="token punctuation">;</span>

<span class="token comment">// 不可遍历的数据类型</span>
<span class="token keyword">const</span> boolTag <span class="token operator">=</span> <span class="token string">'[object Boolean]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dateTag <span class="token operator">=</span> <span class="token string">'[object Date]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberTag <span class="token operator">=</span> <span class="token string">'[object Number]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stringTag <span class="token operator">=</span> <span class="token string">'[object String]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> symbolTag <span class="token operator">=</span> <span class="token string">'[object Symbol]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> errorTag <span class="token operator">=</span> <span class="token string">'[object Error]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> regexpTag <span class="token operator">=</span> <span class="token string">'[object RegExp]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> funcTag <span class="token operator">=</span> <span class="token string">'[object Function]'</span><span class="token punctuation">;</span>

<span class="token comment">// 可遍历的数据类型</span>
<span class="token keyword">const</span> deepTag <span class="token operator">=</span> <span class="token punctuation">[</span>mapTag<span class="token punctuation">,</span> setTag<span class="token punctuation">,</span> arrayTag<span class="token punctuation">,</span> objectTag<span class="token punctuation">,</span> argsTag<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token comment">// 克隆不可遍历的数据类型</span>
<span class="token keyword">function</span> <span class="token function">cloneOtherType</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Ctor <span class="token operator">=</span> target<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">// 获取构造函数</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token literal-property property">boolTag</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token literal-property property">numberTag</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token literal-property property">stringTag</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token literal-property property">errorTag</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token literal-property property">dateTag</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Ctor</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过new创建一个新实例</span>
        <span class="token keyword">case</span> <span class="token literal-property property">regexpTag</span><span class="token operator">:</span> <span class="token comment">// 正则</span>
            <span class="token keyword">return</span> <span class="token function">cloneReg</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token literal-property property">symbolTag</span><span class="token operator">:</span> <span class="token comment">// symbol</span>
            <span class="token keyword">return</span> <span class="token function">cloneSymbol</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token literal-property property">funcTag</span><span class="token operator">:</span> <span class="token comment">// 函数</span>
            <span class="token keyword">return</span> <span class="token function">cloneFunction</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 克隆symbol</span>
<span class="token keyword">function</span> <span class="token function">cloneSymbol</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token class-name">Symbol</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 克隆正则 https://juejin.cn/post/6844903775384125448</span>
<span class="token keyword">function</span> <span class="token function">cloneReg</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> reFlags <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\w*$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">target<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>source<span class="token punctuation">,</span> reFlags<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> target<span class="token punctuation">.</span>lastIndex<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 克隆函数</span>
<span class="token keyword">function</span> <span class="token function">cloneFunction</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bodyReg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;={)(.|\n)+(?=})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">m</span></span><span class="token punctuation">;</span> <span class="token comment">// 正则匹配函数体</span>
    <span class="token keyword">const</span> paramReg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=\().+(?=\)\s+{)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span> <span class="token comment">// 正则匹配函数参数</span>
    <span class="token keyword">const</span> funcString <span class="token operator">=</span> func<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过prototype来区分下箭头函数和普通函数，箭头函数是没有prototype的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>func<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> param <span class="token operator">=</span> paramReg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>funcString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> body <span class="token operator">=</span> bodyReg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>funcString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> paramArr <span class="token operator">=</span> param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 使用new Function ([arg1[, arg2[, ...argN]],] functionBody)构造函数重新构造一个新的函数</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token operator">...</span>paramArr<span class="token punctuation">,</span> body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 直接使用eval和函数字符串来重新生成一个箭头函数；eval() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。</span>
        <span class="token keyword">return</span> func <span class="token operator">||</span> <span class="token function">eval</span><span class="token punctuation">(</span>funcString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// 判断是否是引用类型</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 获取数据类型：调用Object原型上的toString()方法获取准确的引用类型</span>
<span class="token keyword">function</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 获取不同类型的初始化数据
 * 在上一个方法中通过：var res = Array.isArray(obj) ? [] : {}; 来初始化数据
 * 这里可以通过原对象的constructor构造函数获取初始化数据
 * 例如：const target = {}就是const target = new Object()的语法糖
 */</span>
<span class="token keyword">function</span> <span class="token function">getInit</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> Fn <span class="token operator">=</span> target<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 封装遍历方法：使用while循环进行遍历</span>
<span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        i <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">// 深拷贝：轻奢版</span>
<span class="token keyword">function</span> <span class="token function">deepCopyPro</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是基础数据类型，直接返回参数本身</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> target<span class="token punctuation">;</span>

    <span class="token comment">// 初始化</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 是可遍历的数据</span>
        cloneTarget <span class="token operator">=</span> <span class="token function">getInit</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取初始化数据</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 是不可遍历数据</span>
        <span class="token keyword">return</span> <span class="token function">cloneOtherType</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接返回克隆值</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 防止循环引用和引用丢失</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 检查map中有无克隆过的对象</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有则直接返回</span>
    <span class="token punctuation">}</span>
    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> cloneTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无则将当前对象作为key，克隆对象作为value进行存储，继续克隆</span>

    <span class="token comment">/**
     * 接下来开始遍历克隆，这里主要克隆Set、Map、Array、Object四种数据类型
     */</span>

    <span class="token comment">// 克隆set</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> setTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">deepCopyPro</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归调用deepCopyPro，传入遍历的子元素，和已经缓存的map</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 克隆map</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> mapTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            cloneTarget<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">deepCopyPro</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归调用deepCopyPro，传入遍历的子元素，和已经缓存的map</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 克隆数组和对象</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> type <span class="token operator">===</span> arrayTag <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是数组则先返回null，不是则用Object.keys获取所有key</span>
    <span class="token function">forEach</span><span class="token punctuation">(</span>keys <span class="token operator">||</span> target<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 是对象</span>
            key <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cloneTarget<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepCopyPro</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 深拷贝终极版测试</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">e</span><span class="token operator">:</span> isNaN<span class="token punctuation">,</span> <span class="token literal-property property">f</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">h</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'symbol'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">bool</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">str</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">symbol</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">empty</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        map<span class="token punctuation">,</span>
        set<span class="token punctuation">,</span>
        <span class="token function-variable function">func1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj4 <span class="token operator">=</span> <span class="token function">deepCopyPro</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj4<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印结果：</p> <img src="/blog/images/js/deep-copy.png" width="auto" class="zoom-custom-imgs"> <p>可以再用上面的方法试试<code>循环引用</code>和<code>引用丢失</code>的问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 循环引用</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">deepCopyPro</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a:{...}}</span>

<span class="token comment">// 引用丢失</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a1</span><span class="token operator">:</span> b<span class="token punctuation">,</span> <span class="token literal-property property">a2</span><span class="token operator">:</span> b<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>a1 <span class="token operator">===</span> a<span class="token punctuation">.</span>a2<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">deepCopyPro</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a1: {…}, a2: {…}}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>a1 <span class="token operator">===</span> c<span class="token punctuation">.</span>a2<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>发现都解决了！！！</p> <p>其实上面的方法还是用递归实现，也是<code>lodash</code>主要实现方式，当然lodash的实现肯定更完善一些，兼容情况更多一些，但用递归其实还是有栈溢出的问题。这里在这个方法基础上继续改进，改用<code>while</code>循环实现，解决爆栈的问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 深拷贝：终极版（while循环 + 缓存）</span>
<span class="token keyword">function</span> <span class="token function">deepCopyLoopLast</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> target<span class="token punctuation">;</span>

    <span class="token keyword">let</span> cloneTarget <span class="token operator">=</span> <span class="token function">getInit</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 初始化</span>
    <span class="token comment">// 初始化一个栈，</span>
    <span class="token keyword">const</span> stackList <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">parent</span><span class="token operator">:</span> cloneTarget<span class="token punctuation">,</span>
            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> target
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>stackList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> stackList<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">}</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> parent<span class="token punctuation">;</span> <span class="token comment">// 初始化res</span>
        <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> key <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getInit</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 防止循环引用和引用丢失</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 是需要遍历的类型</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 跳出此次循环</span>
            <span class="token punctuation">}</span>
            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 克隆set</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> setTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">parent</span><span class="token operator">:</span> res<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 克隆map</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> mapTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">parent</span><span class="token operator">:</span> res<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 克隆数组和对象</span>
        <span class="token keyword">const</span> keys <span class="token operator">=</span> type <span class="token operator">===</span> arrayTag <span class="token operator">?</span> data <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环遍历</span>
            <span class="token keyword">let</span> key <span class="token operator">=</span> type <span class="token operator">===</span> arrayTag <span class="token operator">?</span> i <span class="token operator">:</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断是否含有这个属性</span>
                <span class="token keyword">let</span> val <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>deepTag<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">parent</span><span class="token operator">:</span> res<span class="token punctuation">,</span> key<span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span> val<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            i <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> cloneTarget<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完整代码<a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer">地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <ol><li>递归为什么容易造成栈溢出？</li></ol> <blockquote><p>首先了解下函数的堆栈概念：js中，每次函数调用会在内存形成一个“调用记录”， 保存着调用位置和内部变量等信息。如果函数中调用了其他函数，则js引擎将其运行过程暂停，去执行新调用的函数，新调用函数成功后继续返回当前函数的执行位置，继续往后执行。执行新调用的函数过程，也是将其推入到堆栈的最顶部并为其开辟一块内容。新函数执行完毕后将其推出堆栈，并回收内存。由此便形成了函数的堆栈。</p></blockquote> <p>在递归的使用中，函数会直接或间接调用自身；根据栈<code>先进先出</code>的特性，每递归一次，就占用内存生成调用记录并推入调用栈顶部，等到它执行完毕才将其推出，执行下面的调用栈；这样不停调用，不停累积，就会占用内存，直到占用内存超出浏览器负荷，就溢出了。</p> <ul><li>解决方法：<strong>尾递归</strong>。</li></ul> <blockquote><p>当一个函数执行时的最后一个步骤是返回另一个函数的调用，这就叫做尾调用。这样就能保证在调用栈中始终只有一个调用记录，避免堆栈溢出。</p></blockquote> <p>用一个简单的阶乘函数对比下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 普通递归</span>
<span class="token keyword">function</span> <span class="token function">fac</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">fac</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这不算尾调用，因为返回的不是fac，而是 n * fac</span>
<span class="token punctuation">}</span>

<span class="token function">fac</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 120</span>

<span class="token comment">// 尾递归</span>
<span class="token keyword">function</span> <span class="token function">fac1</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> total</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> total<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fac1</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在最后一步返回函数调用</span>
<span class="token punctuation">}</span>

<span class="token function">fac1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 120</span>
</code></pre></div><h2 id="备注"><a href="#备注" class="header-anchor">#</a> 备注</h2> <ol><li>最后一个方法很多地方是参照<code>lodash</code>里深拷贝的实现，有精力再继续研究下<code>loadash</code>深拷贝的源码</li> <li>还有许多需要优化的点，比如对<code>Buffer</code>的兼容，对函数的复制等等，有精力再研究</li> <li>解决循环引用用的是<code>Map</code>来进行缓存，也可以用<code>WeakMap</code>来进行缓存，因为WeakMap的键名所引用的对象都是弱引用，只要所引用的对象的其他引用都被清除，垃圾回收机制就会释放该对象所占用的内存，不用手动删除引用，会避免Map会对内存造成非常大的额外消耗的问题。</li> <li>对于性能优化这块有时间还可以再继续深究下。</li></ol> <h2 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h2> <h3 id="递归优化版"><a href="#递归优化版" class="header-anchor">#</a> 递归优化版</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 2022-04-04 添加
 * 
*/</span>

<span class="token comment">// 判断类型的方法移到外部，避免递归过程中多次执行</span>
<span class="token keyword">const</span> <span class="token function-variable function">judgeType</span> <span class="token operator">=</span> <span class="token parameter">origin</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\[|\]|object </span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reference <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Set&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WeakSet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Map&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WeakMap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RegExp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Date&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token function">judgeType</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>reference<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 其他类型</span>
        res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Array'</span><span class="token punctuation">,</span> <span class="token string">'Object'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 对象，数组</span>
        res <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">'Array'</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// for...in会将原型中新增的属性和方法遍历出来, 所以需要判断一下是否是自身属性</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;ConardLi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;coder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;ConardLi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;coder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">field1</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field2</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">child</span><span class="token operator">:</span> <span class="token string">&quot;child&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">field4</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">empty</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    map<span class="token punctuation">,</span>
    set<span class="token punctuation">,</span>
    <span class="token literal-property property">bool</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">str</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">symbol</span><span class="token operator">:</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">reg</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">func1</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;coder&quot;</span><span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//测试代码</span>
<span class="token keyword">const</span> test1 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
target<span class="token punctuation">.</span>field4<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test1: '</span><span class="token punctuation">,</span> test1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://juejin.cn/post/7075351322014253064" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ol><li><a href="https://zhuanlan.zhihu.com/p/120752078" target="_blank" rel="noopener noreferrer">JS中的赋值、浅拷贝与深拷贝<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903692756336653" target="_blank" rel="noopener noreferrer">深拷贝的终极探索<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/jsmini/clone/blob/master/src/index.js" target="_blank" rel="noopener noreferrer">while循环实现源码参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903929705136141" target="_blank" rel="noopener noreferrer">如何写出一个惊艳面试官的深拷贝?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/ConardLi/ConardLi.github.io/blob/master/demo/deepClone/src/clone_6.js" target="_blank" rel="noopener noreferrer">完整版实现源码参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/lodash/lodash/blob/master/.internal/baseClone.js" target="_blank" rel="noopener noreferrer">lodash深拷贝源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/blog/tags/?tag=js%E5%9F%BA%E7%A1%80" title="标签">#js基础</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">6/5/2022, 11:33:36 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/more/node-deploy.html"><div>
            Vue+Node实现可视化部署工具
            <!----></div></a> <span class="date">01-21</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/tool/vscode-plugins.html"><div>
            VSCode插件开发笔记
            <!----></div></a> <span class="date">01-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/skills/vue/vue3-cli-repo.html"><div>
            开发一个快速搭建vue3项目的脚手架
            <!----></div></a> <span class="date">12-13</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>一苇 | <a href="https://beian.miit.gov.cn/" target="_blank" style="font-weight:normal"><img src="/blog/images/icp.png" width="20" height="20" alt="公网备案"/>京ICP备2021006935号-2</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><!----><!----><div></div></div></div>
    <script src="/blog/assets/js/app.76fa57e6.js" defer></script><script src="/blog/assets/js/3.a2a245ac.js" defer></script><script src="/blog/assets/js/60.0adc2f64.js" defer></script><script src="/blog/assets/js/4.245b4373.js" defer></script>
  </body>
</html>
