<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Github Actions自动部署 | 一苇</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/icons/favicon.ico">
    <link rel="manifest" href="/js/mainfest.json">
    <link rel="stylesheet" href="/styles/css/style.css">
    <script type="utf-8" src="/js/disable-user-zoom.js"></script>
    <meta name="description" content="这是阿沐的博客哦~">
    <meta name="Author" content="一苇">
    <meta rel="keywords" content="verneyzhou,阿沐,一苇,前端,docs.verneyzhou-code.cn,博客,fe,IT,技术">
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport" content="width=device-width,width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.3c92d36b.css" as="style"><link rel="preload" href="/assets/js/app.69732266.js" as="script"><link rel="preload" href="/assets/js/3.a2a245ac.js" as="script"><link rel="preload" href="/assets/js/73.d93b48c0.js" as="script"><link rel="preload" href="/assets/js/4.245b4373.js" as="script"><link rel="prefetch" href="/assets/js/10.a7e9ab05.js"><link rel="prefetch" href="/assets/js/100.3faa5e2f.js"><link rel="prefetch" href="/assets/js/101.4166e909.js"><link rel="prefetch" href="/assets/js/102.d4ecef7a.js"><link rel="prefetch" href="/assets/js/103.c5c9147f.js"><link rel="prefetch" href="/assets/js/104.8fd10595.js"><link rel="prefetch" href="/assets/js/105.0d3ac0ed.js"><link rel="prefetch" href="/assets/js/106.3ceb2f83.js"><link rel="prefetch" href="/assets/js/107.878a0660.js"><link rel="prefetch" href="/assets/js/108.26952ee4.js"><link rel="prefetch" href="/assets/js/109.cabfda98.js"><link rel="prefetch" href="/assets/js/11.0b0beb84.js"><link rel="prefetch" href="/assets/js/110.0ec777cb.js"><link rel="prefetch" href="/assets/js/111.fdba7ceb.js"><link rel="prefetch" href="/assets/js/112.fdabdec2.js"><link rel="prefetch" href="/assets/js/113.55128da4.js"><link rel="prefetch" href="/assets/js/114.e8f5e502.js"><link rel="prefetch" href="/assets/js/115.fe4f7c3c.js"><link rel="prefetch" href="/assets/js/116.3937d882.js"><link rel="prefetch" href="/assets/js/117.e55ee5f2.js"><link rel="prefetch" href="/assets/js/118.e409ae22.js"><link rel="prefetch" href="/assets/js/119.c0def90a.js"><link rel="prefetch" href="/assets/js/12.aa062600.js"><link rel="prefetch" href="/assets/js/120.d9e40ad4.js"><link rel="prefetch" href="/assets/js/121.cf8c1aca.js"><link rel="prefetch" href="/assets/js/122.a9ee4224.js"><link rel="prefetch" href="/assets/js/123.2794bfa5.js"><link rel="prefetch" href="/assets/js/124.f1e64ee3.js"><link rel="prefetch" href="/assets/js/125.fa948787.js"><link rel="prefetch" href="/assets/js/126.76504ca5.js"><link rel="prefetch" href="/assets/js/127.7da97249.js"><link rel="prefetch" href="/assets/js/128.bcb48426.js"><link rel="prefetch" href="/assets/js/129.2df25aeb.js"><link rel="prefetch" href="/assets/js/13.b8ba6830.js"><link rel="prefetch" href="/assets/js/130.a2f96af4.js"><link rel="prefetch" href="/assets/js/131.fb54f08d.js"><link rel="prefetch" href="/assets/js/132.f6ca0481.js"><link rel="prefetch" href="/assets/js/133.0d6b4b4d.js"><link rel="prefetch" href="/assets/js/134.c01f5483.js"><link rel="prefetch" href="/assets/js/135.8975e738.js"><link rel="prefetch" href="/assets/js/136.6b1be92a.js"><link rel="prefetch" href="/assets/js/137.8753fbd8.js"><link rel="prefetch" href="/assets/js/138.343ae9fd.js"><link rel="prefetch" href="/assets/js/139.8e1cd38c.js"><link rel="prefetch" href="/assets/js/14.fafd1a3d.js"><link rel="prefetch" href="/assets/js/140.dcfcea46.js"><link rel="prefetch" href="/assets/js/141.5db3d0fd.js"><link rel="prefetch" href="/assets/js/142.5512076f.js"><link rel="prefetch" href="/assets/js/143.dca2eb9b.js"><link rel="prefetch" href="/assets/js/144.9d4da2b7.js"><link rel="prefetch" href="/assets/js/145.faf85648.js"><link rel="prefetch" href="/assets/js/146.bb1cf597.js"><link rel="prefetch" href="/assets/js/147.351c7ab9.js"><link rel="prefetch" href="/assets/js/148.04b59724.js"><link rel="prefetch" href="/assets/js/149.e35da13a.js"><link rel="prefetch" href="/assets/js/15.939f65d2.js"><link rel="prefetch" href="/assets/js/150.d05853fa.js"><link rel="prefetch" href="/assets/js/151.94cc1ffb.js"><link rel="prefetch" href="/assets/js/152.9442170c.js"><link rel="prefetch" href="/assets/js/153.6165efcc.js"><link rel="prefetch" href="/assets/js/154.b5220e1d.js"><link rel="prefetch" href="/assets/js/155.91ad1d25.js"><link rel="prefetch" href="/assets/js/156.320e1870.js"><link rel="prefetch" href="/assets/js/157.74b155d4.js"><link rel="prefetch" href="/assets/js/158.01eb9bc7.js"><link rel="prefetch" href="/assets/js/159.c8bfa043.js"><link rel="prefetch" href="/assets/js/16.976e0a23.js"><link rel="prefetch" href="/assets/js/160.77d270af.js"><link rel="prefetch" href="/assets/js/161.0be68964.js"><link rel="prefetch" href="/assets/js/162.9225cd54.js"><link rel="prefetch" href="/assets/js/163.dbe37860.js"><link rel="prefetch" href="/assets/js/164.b34845ea.js"><link rel="prefetch" href="/assets/js/165.b5960db8.js"><link rel="prefetch" href="/assets/js/166.004736fe.js"><link rel="prefetch" href="/assets/js/167.01a4f7a5.js"><link rel="prefetch" href="/assets/js/168.6f2dc582.js"><link rel="prefetch" href="/assets/js/169.468464d3.js"><link rel="prefetch" href="/assets/js/17.7db29d69.js"><link rel="prefetch" href="/assets/js/170.ef6b0571.js"><link rel="prefetch" href="/assets/js/171.7695d1ab.js"><link rel="prefetch" href="/assets/js/172.8b83f5cb.js"><link rel="prefetch" href="/assets/js/173.266d932b.js"><link rel="prefetch" href="/assets/js/174.0ecc06eb.js"><link rel="prefetch" href="/assets/js/175.66b55b92.js"><link rel="prefetch" href="/assets/js/176.69779443.js"><link rel="prefetch" href="/assets/js/177.993c52dd.js"><link rel="prefetch" href="/assets/js/178.766ccfed.js"><link rel="prefetch" href="/assets/js/179.ce25a52d.js"><link rel="prefetch" href="/assets/js/18.5f30a089.js"><link rel="prefetch" href="/assets/js/180.c0b0212e.js"><link rel="prefetch" href="/assets/js/181.8741e0ab.js"><link rel="prefetch" href="/assets/js/182.71759a09.js"><link rel="prefetch" href="/assets/js/183.e7f41afd.js"><link rel="prefetch" href="/assets/js/184.aae32a59.js"><link rel="prefetch" href="/assets/js/185.5194e169.js"><link rel="prefetch" href="/assets/js/186.3f8a60e6.js"><link rel="prefetch" href="/assets/js/187.19f86e8d.js"><link rel="prefetch" href="/assets/js/188.27639a04.js"><link rel="prefetch" href="/assets/js/189.0dc70217.js"><link rel="prefetch" href="/assets/js/19.fac51ca5.js"><link rel="prefetch" href="/assets/js/190.681b28d2.js"><link rel="prefetch" href="/assets/js/191.264f721d.js"><link rel="prefetch" href="/assets/js/192.fc12ab90.js"><link rel="prefetch" href="/assets/js/193.5c0ff331.js"><link rel="prefetch" href="/assets/js/194.7557dd15.js"><link rel="prefetch" href="/assets/js/195.f96ed91d.js"><link rel="prefetch" href="/assets/js/196.e5783f95.js"><link rel="prefetch" href="/assets/js/197.e9ad0ceb.js"><link rel="prefetch" href="/assets/js/198.f1abb7d4.js"><link rel="prefetch" href="/assets/js/199.6561e896.js"><link rel="prefetch" href="/assets/js/20.d7300073.js"><link rel="prefetch" href="/assets/js/200.02925058.js"><link rel="prefetch" href="/assets/js/21.447d324b.js"><link rel="prefetch" href="/assets/js/22.5cb6d5b8.js"><link rel="prefetch" href="/assets/js/23.9238ddc8.js"><link rel="prefetch" href="/assets/js/24.78d0b53b.js"><link rel="prefetch" href="/assets/js/25.3f3fefdf.js"><link rel="prefetch" href="/assets/js/26.0d85913f.js"><link rel="prefetch" href="/assets/js/27.cc4a1c25.js"><link rel="prefetch" href="/assets/js/28.9c7420e7.js"><link rel="prefetch" href="/assets/js/29.a0229683.js"><link rel="prefetch" href="/assets/js/30.954c9b5b.js"><link rel="prefetch" href="/assets/js/31.557acce8.js"><link rel="prefetch" href="/assets/js/32.964dbed2.js"><link rel="prefetch" href="/assets/js/33.bad1891d.js"><link rel="prefetch" href="/assets/js/34.4db629ab.js"><link rel="prefetch" href="/assets/js/35.8e4f238a.js"><link rel="prefetch" href="/assets/js/36.be6d97f8.js"><link rel="prefetch" href="/assets/js/37.57ec2f3b.js"><link rel="prefetch" href="/assets/js/38.29752a9f.js"><link rel="prefetch" href="/assets/js/39.54cd4fb0.js"><link rel="prefetch" href="/assets/js/40.7d2fccc4.js"><link rel="prefetch" href="/assets/js/41.4d847a5e.js"><link rel="prefetch" href="/assets/js/42.bad47051.js"><link rel="prefetch" href="/assets/js/43.66fab90c.js"><link rel="prefetch" href="/assets/js/44.dd75797a.js"><link rel="prefetch" href="/assets/js/45.082dbc9e.js"><link rel="prefetch" href="/assets/js/46.db7ce530.js"><link rel="prefetch" href="/assets/js/47.c8a43539.js"><link rel="prefetch" href="/assets/js/48.7c424697.js"><link rel="prefetch" href="/assets/js/49.59225051.js"><link rel="prefetch" href="/assets/js/5.f9c6355e.js"><link rel="prefetch" href="/assets/js/50.3ca122c2.js"><link rel="prefetch" href="/assets/js/51.3dc4a085.js"><link rel="prefetch" href="/assets/js/52.8587e4b0.js"><link rel="prefetch" href="/assets/js/53.772c2349.js"><link rel="prefetch" href="/assets/js/54.5611074e.js"><link rel="prefetch" href="/assets/js/55.727222a5.js"><link rel="prefetch" href="/assets/js/56.e20a6fa6.js"><link rel="prefetch" href="/assets/js/57.dcb8a123.js"><link rel="prefetch" href="/assets/js/58.525bc0b8.js"><link rel="prefetch" href="/assets/js/59.fd423a7c.js"><link rel="prefetch" href="/assets/js/6.9db196de.js"><link rel="prefetch" href="/assets/js/60.38c8cb52.js"><link rel="prefetch" href="/assets/js/61.86d9151c.js"><link rel="prefetch" href="/assets/js/62.5328259e.js"><link rel="prefetch" href="/assets/js/63.23a3b199.js"><link rel="prefetch" href="/assets/js/64.24cc5ce1.js"><link rel="prefetch" href="/assets/js/65.33556baa.js"><link rel="prefetch" href="/assets/js/66.fd0ee3c5.js"><link rel="prefetch" href="/assets/js/67.415d010b.js"><link rel="prefetch" href="/assets/js/68.60764cc6.js"><link rel="prefetch" href="/assets/js/69.89981997.js"><link rel="prefetch" href="/assets/js/7.be26579a.js"><link rel="prefetch" href="/assets/js/70.b15b0579.js"><link rel="prefetch" href="/assets/js/71.de1aa836.js"><link rel="prefetch" href="/assets/js/72.2aa72a71.js"><link rel="prefetch" href="/assets/js/74.1e5ced20.js"><link rel="prefetch" href="/assets/js/75.42650e07.js"><link rel="prefetch" href="/assets/js/76.a1cabcf0.js"><link rel="prefetch" href="/assets/js/77.d88be595.js"><link rel="prefetch" href="/assets/js/78.553c4925.js"><link rel="prefetch" href="/assets/js/79.eeb36f42.js"><link rel="prefetch" href="/assets/js/8.81068d64.js"><link rel="prefetch" href="/assets/js/80.ef28d73c.js"><link rel="prefetch" href="/assets/js/81.d5890383.js"><link rel="prefetch" href="/assets/js/82.f96e0264.js"><link rel="prefetch" href="/assets/js/83.c4df3295.js"><link rel="prefetch" href="/assets/js/84.1d2c345e.js"><link rel="prefetch" href="/assets/js/85.f15ee1d6.js"><link rel="prefetch" href="/assets/js/86.52ab8df1.js"><link rel="prefetch" href="/assets/js/87.61f91bdb.js"><link rel="prefetch" href="/assets/js/88.7071fdf7.js"><link rel="prefetch" href="/assets/js/89.2627c1c2.js"><link rel="prefetch" href="/assets/js/9.b458959d.js"><link rel="prefetch" href="/assets/js/90.5d3cfa2c.js"><link rel="prefetch" href="/assets/js/91.bcc9bb81.js"><link rel="prefetch" href="/assets/js/92.7948e720.js"><link rel="prefetch" href="/assets/js/93.922c76d2.js"><link rel="prefetch" href="/assets/js/94.9a0089bc.js"><link rel="prefetch" href="/assets/js/95.bf94c391.js"><link rel="prefetch" href="/assets/js/96.77325728.js"><link rel="prefetch" href="/assets/js/97.017f8b9c.js"><link rel="prefetch" href="/assets/js/98.af87b098.js"><link rel="prefetch" href="/assets/js/99.1c2ec226.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.381052ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3c92d36b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icons/apple-touch-icon.png" alt="一苇" class="logo"> <span class="site-name can-hide">一苇</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/more/" class="nav-link router-link-active">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tool/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">ME</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="images/poster03.jpeg"> <div class="blogger-info"><h3></h3> <span>光阴缝隙，时间盛典。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/more/" class="nav-link router-link-active">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tool/" class="nav-link">其他</a></div><div class="nav-item"><a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">ME</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Github Actions自动部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/more/github-actions.html#简介" class="sidebar-link">简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/more/github-actions.html#github-action基本概念" class="sidebar-link">Github Action基本概念</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#yaml" class="sidebar-link">Yaml</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#context-上下文" class="sidebar-link">Context 上下文</a></li></ul></li><li><a href="/more/github-actions.html#实践" class="sidebar-link">实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/more/github-actions.html#新增git-page" class="sidebar-link">新增Git Page</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#git-actions自动部署" class="sidebar-link">Git Actions自动部署</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#配置-yml" class="sidebar-link">配置.yml</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#添加token" class="sidebar-link">添加Token</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#自动部署阿里云服务器" class="sidebar-link">自动部署阿里云服务器</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#代码规范" class="sidebar-link">代码规范</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#eslint-prettier" class="sidebar-link">Eslint&amp;Prettier</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#配置ci-yml" class="sidebar-link">配置ci.yml</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#husky" class="sidebar-link">Husky</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#commitlint" class="sidebar-link">Commitlint</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#代码测试" class="sidebar-link">代码测试</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#生成压缩包并发版" class="sidebar-link">生成压缩包并发版</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#邮箱自动通知" class="sidebar-link">邮箱自动通知</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#添加状态徽章" class="sidebar-link">添加状态徽章</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#添加回滚机制" class="sidebar-link">添加回滚机制</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#搭配docker" class="sidebar-link">搭配Docker</a></li><li class="sidebar-sub-header"><a href="/more/github-actions.html#gitlab-ci" class="sidebar-link">Gitlab-ci</a></li></ul></li><li><a href="/more/github-actions.html#备注" class="sidebar-link">备注</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/more/github-actions.html#与其他ci-cd工具的比较" class="sidebar-link">与其他CI/CD工具的比较</a></li></ul></li><li><a href="/more/github-actions.html#报错记录" class="sidebar-link">报错记录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/more/github-actions.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=more" title="分类" data-v-0c557b5e>more</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>阿沐</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2023-09-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Github Actions自动部署<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="github-actions自动部署"><a href="#github-actions自动部署" class="header-anchor">#</a> Github Actions自动部署</h1> <blockquote><p>其实前端部署无非就是把打包之后的代码丢到 <code>nginx html</code> 目录下。</p></blockquote> <blockquote><p>但如果每次上线总是手动：<code>修改、打包、登录服务器、上传代码、重启服务器</code>的话，就太低效了。这个时候，如果有个机器人能帮我们完成以上这些重复又没技术含量的活，那样部署工作就会轻松很多；而 <code>Github Actions</code> 就是我们需要的那个机器人。</p></blockquote> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p><strong>GitHub Actions 是一种持续集成和持续交付 (CI/CD) 平台，可用于自动执行生成、测试和部署管道。</strong> 您可以创建工作流程来构建和测试存储库的每个拉取请求，或将合并的拉取请求部署到生产环境。</p> <p><a href="https://docs.github.com/zh/actions" target="_blank" rel="noopener noreferrer">GitHub Actions 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>github于2019年11月后对该功能全面开放，现在所有的github用户可以直接使用该功能。GitHub 提供 Linux、Windows 和 macOS 虚拟机来运行您的工作流程，或者您可以在自己的数据中心或云基础架构中托管自己的自托管运行器。</p></blockquote> <p>CI（持续集成）由很多操作组成，比如拉取最新代码、运行测试、登录服务器、部署服务器等，GitHub 把这些操作统一称为 <strong>Actions</strong> 。</p> <blockquote><p>GitHub Actions是GitHub提供的一种自动化工作流程（workflow）管理工具。它可以根据特定的事件触发，执行各种操作和任务，例如编译代码、运行测试、部署应用等。</p></blockquote> <blockquote><p>使用GitHub Actions，开发者可以定义一个或多个工作流程，每个工作流程由一系列步骤（steps）组成。每个步骤可以包含命令行脚本、调用API、运行测试等任务。这些步骤可以在不同的操作系统环境下执行，如Linux、macOS和Windows。</p></blockquote> <blockquote><p>GitHub Actions提供了一系列预定义的事件（events），如提交代码、创建分支、打标签等，当这些事件发生时，可以触发相应的工作流程执行。同时，开发者也可以通过手动方式触发工作流程的执行。</p></blockquote> <p>正常需求的开发流程为：<code>需求 =&gt; 开发 =&gt; 构建 =&gt; 测试 =&gt; 预发 =&gt; 部署</code>，这些操作是可重复利用的，利用这一概念，Github 集成了 Actions 市场，允许开发者把操作写成独立的脚本，发布到 Actions 市场，允许所有开发者使用。</p> <p><a href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener noreferrer">Actions 市场<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>公共仓库和自托管运行器免费使用 GitHub Actions。 对于私有仓库，每个 GitHub 帐户可获得一定数量的免费记录和存储，具体取决于帐户所使用的产品。 超出包含金额的任何使用量都由支出限制控制。</p></blockquote> <h3 id="github-action基本概念"><a href="#github-action基本概念" class="header-anchor">#</a> Github Action基本概念</h3> <blockquote><p>当我们想往自己的项目里接入<code>Github Actions</code>时，要在根项目目录里新建<code>.github/workflows</code>目录。然后通过编写<code>yml</code>格式文件定义<code>Workflow(工作流程)</code>去实现CI。在阅读yml文件之前，我们要先搞懂在Workflow中一些比较重要的概念：</p></blockquote> <ol><li><strong>Workflows 工作流</strong></li></ol> <p><code>Workflows</code>（工作流程）持续集成的运行过程称为一次工作流程，也就是我们项目开始自动化部署到部署结束的这一段过程可以称为工作流程.</p> <blockquote><p>工作流是一个可配置的自动化流程，它将运行一个或多个作业。工作流是由签入存储库的 <code>YAML</code> 文件定义的，并且在由 <code>repository</code> 中的事件触发时运行，或者可以手动触发，或者按照定义的时间表运行。</p></blockquote> <blockquote><p>工作流在<code>.github/workflows</code> 目录中定义, 并且存储库可以有多个工作流，每个工作流可以执行不同的任务集。例如，您可以使用一个工作流来构建和测试拉请求，使用另一个工作流在每次创建发行版时部署您的应用程序，还可以使用另一个工作流在每次有人打开新问题时添加标签。</p></blockquote> <ol start="2"><li><strong>Events 事件</strong></li></ol> <p>事件是存储库中触发工作流运行的特定活动。例如，活动可以来自 GitHub 创建请求(<code>pull request</code>)、打开问题(<code>open an issue</code>)或向存储库提交(<code>push an commit</code>)。您还可以通过向 REST API 发布或手动触发按计划运行的工作流。</p> <blockquote><p>工作流可以由各种GitHub事件触发，例如代码推送、<code>pull request</code> 或发布。</p></blockquote> <ol start="3"><li><strong>Jobs 作业</strong></li></ol> <p>作业是工作流中在同一运行程序上执行的一组步骤。每个步骤要么是将要执行的 shell 脚本，要么是将要运行的操作。步骤按顺序执行，并相互依赖。由于每个步骤都在同一个运行程序上执行，因此可以将数据从一个步骤共享到另一个步骤。例如，您可以有一个生成应用程序的步骤，然后有一个测试生成的应用程序的步骤。</p> <p><code>job</code> （任务）一个工作流程中包含多个任务，简单来说就是一次自动部署的过程需要完成一个或多个任务.</p> <p><code>step</code>（步骤）部署项目需要按照一个一个的步骤来进行，每个job由多个step构成.</p> <ol start="4"><li><strong>Actions 动作</strong></li></ol> <p>动作是 GitHub Actions 平台的自定义应用程序，它执行复杂但经常重复的任务。使用一个操作来帮助减少在工作流文件中编写的重复代码的数量。操作可以从 GitHub 获取 git 存储库，为构建环境设置正确的工具链等。</p> <p><code>action</code>（动作）每个步骤step可以包含一个或多个动作，比如我们在一个步骤中执行打包命令这个Action.</p> <ol start="5"><li><strong>Runners 运行器</strong></li></ol> <p>运行器是在工作流被触发时运行它们的服务器。每个运行器可以一次运行一个作业。GitHub 提供 Ubuntu Linux、 Microsoft Windows 和 macOS 运行程序来运行您的工作流; 每个工作流运行在一个全新的、新配置的虚拟机中执行。GitHub 还提供了更大的运行器，可以进行更大的配置。</p> <ul><li><p><strong>Docker 集成</strong>：支持使用 Docker 容器运行工作流中的步骤。</p></li> <li><p><strong>共享与重用</strong>：开发者可以在 <code>GitHub Marketplace</code> 上共享自己的 Actions，并使用其他开发者分享的 Actions。</p></li></ul> <h3 id="yaml"><a href="#yaml" class="header-anchor">#</a> Yaml</h3> <p>编写 Github Action 的流程时，需要创建一个 workflow 工作流，workflow 必须存储在你的项目库根路径下的<code>.github/workflows</code>目录中，每一个 workflow 对应一个具体的<code>.yml</code> 文件（或者 <code>.yaml</code>）。</p> <blockquote><p>yml是<code>YAML（YAML Ain’t Markup Language）</code>语言的文件，以数据为中心，比properties、xml等更适合做配置文件。</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">特点</p> <ul><li>大小写敏感。</li> <li>使用缩进表示层级关系。</li> <li>缩进只能使用空格，不能用 <code>TAB</code> 字符。</li> <li>缩进的空格数量不重要，只要层级相同的元素左对齐即可。</li> <li><code>‘#’</code> 表示注释。</li></ul></div> <p><a href="https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions" target="_blank" rel="noopener noreferrer">GitHub Actions 的工作流语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>一个示例：<code>learn-github-actions.yml</code>：</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># 指定工作流程的名称</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> learn<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions
<span class="token comment"># 指定此工作流程的触发事件Event。 此示例使用 推送 事件，即执行push后，触发该流水线的执行</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>
<span class="token comment"># 存放 learn-github-actions 工作流程中的所有Job</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token comment"># 指定一个Job的名称为check-bats-version</span>
  <span class="token key atrule">check-bats-version</span><span class="token punctuation">:</span>
    <span class="token comment"># 指定该Job在最新版本的 Ubuntu Linux 的 Runner(运行器)上运行</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token comment"># 存放 check-bats-version 作业中的所有Step</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># step-no.1: 运行actions/checkout@v3操作，操作一般用uses来调用，</span>
      <span class="token comment"># 一般用于处理一些复杂又频繁的操作例如拉取分支，安装插件</span>
      <span class="token comment"># 此处 actions/checkout 操作是从仓库拉取代码到Runner里的操作</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token comment"># step-no.2: actions/setup-node@v3 操作来安装指定版本的 Node.js，此处指定安装的版本为v14</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&quot;14&quot;</span>
      <span class="token comment"># step-no.3: 运行命令行下载bats依赖到全局环境中</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g bats
      <span class="token comment"># step-no.4: 运行命令行查看bats依赖的版本</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bats <span class="token punctuation">-</span>v

</code></pre></div><ul><li>又一个示例：<code>hello-github-actions.yml</code></li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> hello<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions
<span class="token comment"># 触发 workflow 的事件</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token comment"># 分支随意</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> master
<span class="token comment"># 一个workflow由执行的一项或多项job</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token comment"># 一个job任务，任务名为build</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token comment">#运行在最新版ubuntu系统中</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token comment">#步骤合集</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment">#新建一个名为checkout_actions的步骤</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> checkout_actions
        <span class="token comment">#使用checkout@v2这个action获取源码</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2 
      <span class="token comment">#使用建一个名为setup-node的步骤</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> setup<span class="token punctuation">-</span>node
        <span class="token comment">#使用setup-node@v1这个action</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
        <span class="token comment">#指定某个action 可能需要输入的参数</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'14'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> npm install and build
        <span class="token comment">#执行执行某个shell命令或脚本</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          npm install
          npm run build</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> commit push
        <span class="token comment">#执行执行某个shell命令或脚本</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          git config --global user.email xxx@163.com
          git config --global user.name xxxx
          git add .
          git commit -m &quot;update&quot; -a
          git push</span>
         <span class="token comment"># 环境变量</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">email</span><span class="token punctuation">:</span> xxx@163.com   

</code></pre></div><ul><li><p><code>job-&gt;steps</code>：steps字段指定每个 Job 的运行步骤，每个job由多个step构成，它会从上至下依次执行。steps可以包含一个或多个步骤</p></li> <li><p>环境变量可以配置在以下地方: <code>jobs-&gt;job-&gt;env</code>, <code>jobs-&gt;job-&gt;steps.env</code></p></li> <li><p>使用<code>uses</code>指的是这一步骤需要先调用哪个 Action。 Action 是组成工作流最核心最基础的元素。 每个 Action 可以看作封装的独立脚本，有自己的操作逻辑，我们只需要 uses 并通过 with 传入参数即可。</p></li></ul> <blockquote><p>比如 <code>actions/checkout@v2</code> 就是官方社区贡献的用来拉取仓库分支的 Action， 你不需要考虑安装 git 命令工具，只需要把分支参数传入即可。</p></blockquote> <ul><li><p><code>steps</code> 其实是一个步骤数组，在 <code>YAML</code> 语法中，以 <code>-</code> 开始就是一个数组项, 每一个小步骤都有几个相关的选项：</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ul><li><code>name</code>，小步骤的名称。</li> <li><code>uses</code>，小步骤使用的 <code>actions</code> 库名称或路径，<code>Github Actions</code> 允许你使用别人写好的 <code>Actions</code> 库。</li> <li><code>run</code>，小步骤要执行的 <code>shell</code> 命令。</li> <li><code>env</code>，设置与小步骤相关的环境变量。</li> <li><code>with</code>，提供参数。</li></ul></div></li></ul> <p><strong>Action</strong></p> <p>Github Actions 是GitHub的持续集成服务。持续集成由很多操作组成，比如登录远程服务器，发布内容到第三方服务等等，这些相同的操作完全可以提取出来制作成脚本供所有人使用。</p> <p>GitHub允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用该脚本，这个脚本就是一个Action。</p> <p>如果你需要某种功能的Action可以从GitHub社区共享的<a href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener noreferrer">action官方市场<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查找，也可以自己编程Action开源出来供大家使用。既然 actions 是代码仓库，当然就有版本的概念，用户可以引用某个具体版本的 action。</p> <h3 id="context-上下文"><a href="#context-上下文" class="header-anchor">#</a> Context 上下文</h3> <p><a href="https://docs.github.com/en/actions/learn-github-actions/contexts" target="_blank" rel="noopener noreferrer">Context 上下文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是工作流各个步骤的信息。例如<code>env.sha</code>，就是自己设置的环境变量里面的sha变量。</p> <p>上下文种类和工作流步骤相关, 共有十一种:<code>github、env、job、jobs、steps、runner、secrets、strategy、matrix、needs、inputs</code></p> <ul><li><strong>secrets上下文</strong></li></ul> <blockquote><p>在持续集成的过程中，我们可能会使用到自己的敏感数据，这些数据不应该被开源并泄露。那么如何才能安全的使用这些敏感数据呢?</p></blockquote> <p><code>GithubActions</code>提供了<code>Secrets</code>变量来实现这一效果, 我们可以在 github repo 上依次点击 <code>Settings -&gt; Secrets-&gt; Actions-&gt;New repository secret</code>创建一个敏感数据例如:<code>OSS_KEY_ID，OSS_KEY_SECRET</code>， 然后我们就可以在<code>GithubAction</code>脚本中使用这一变量了:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token punctuation">-</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span>  setup  aliyun  oss
    <span class="token key atrule">uses</span><span class="token punctuation">:</span>  manyuanrong/setup<span class="token punctuation">-</span>ossutil@master
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>  oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>beijing.aliyuncs.com
        <span class="token key atrule">access-key-id</span><span class="token punctuation">:</span>  $<span class="token punctuation">{</span><span class="token punctuation">{</span>  secrets.OSS_KEY_ID  <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">access-key-secret</span><span class="token punctuation">:</span>  $<span class="token punctuation">{</span><span class="token punctuation">{</span>  secrets.OSS_KEY_SECRET  <span class="token punctuation">}</span><span class="token punctuation">}</span>

</code></pre></div><h2 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h2> <h3 id="新增git-page"><a href="#新增git-page" class="header-anchor">#</a> 新增Git Page</h3> <blockquote><p>Git Page 可以将我们托管在 GitHub 仓库的项目部署为一个可以对外访问的网站，免去了我们自己购买与配置服务器的麻烦。</p></blockquote> <ol><li>首先新建一个项目，项目搭建与配置不再赘述；</li></ol> <blockquote><p>这里我直接用 Vite 搭建了一个项目，并且推送到github上，项目地址：<a href="https://github.com/verneyZhou/githook-vite-test" target="_blank" rel="noopener noreferrer">githook-vite-test<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ol start="2"><li><p>项目推送上去以后，可以先在github上看下是否推送成功；之后需要新建一个GitPage分支, 就命名为<code>feature/git-page</code>吧~</p></li> <li><p>在这个分支上<code>npm run build</code>打包生成 dist文件，然后执行<code>cp -rf dist/* ./</code>将 dist 里面的内容都复制到根目录下；之后就可以<code>git push</code>提交了；</p></li></ol> <blockquote><p>github pages 默认只能识别项目根目录的 index 文件，所以需要把打包产物放在根目录下~</p></blockquote> <ol start="4"><li>项目提交后，进入github上该项目的 <code>GitHub Pages</code>配置项：</li></ol> <img src="/images/more/git01.jpeg" width="auto"> <blockquote><p>选择<code>feature/git-page</code>分支后，保存，刷新，等一会儿上方就会出现可访问链接，点击就能访问该项目了~！！！</p></blockquote> <p><strong>注：</strong> 上面可访问的域名理论上其实应该是<code>https://verneyzhou.github.io/githook-vite-test</code>这种形式，但因为我之前买了个的域名，已经添加过解析设置，所以这里自动解析为我自己的域名；自己如果想自定义域名也可以在【Custom domain】中添加自己的域名~</p> <ol start="5"><li>之后如果我们再在<code>feature/git-page</code>分支上做修改，push提交后，github会在【Actions】自动执行<code>pages build and deployment</code>工作流，将<code>feature/git-page</code>的代码自动部署到git page~</li></ol> <h3 id="git-actions自动部署"><a href="#git-actions自动部署" class="header-anchor">#</a> Git Actions自动部署</h3> <blockquote><p>上面的项目每一次修改后都要重新打包，切换分支拷贝dist文件夹，比较麻烦，能不能让GitHub自动检测push动作,自动进行打包部署吗？那就是GitHub Actions的工作了.</p></blockquote> <h4 id="配置-yml"><a href="#配置-yml" class="header-anchor">#</a> 配置<code>.yml</code></h4> <blockquote><p>在main分支下，新建<code>.github/workflows/git-page.yml</code>文件，添加如下命令：</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># git-page.yml</span>

<span class="token key atrule">name</span><span class="token punctuation">:</span> CI Github Pages <span class="token comment"># workflow 名称, 若省略则为文件名</span>

<span class="token comment"># 设置触发条件，指定触发workflow的条件，通常是某些事件,比如代码推送push,拉取pull_request,可以是事件的数组</span>
<span class="token comment"># on: [push, pull_request]</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token comment">#监听push操作</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main <span class="token comment"># 这里只配置了main分支，所以只有推送main分支才会触发以下任务</span>


<span class="token comment"># 设置权限为write，这样才能推送代码到仓库，否则会报错</span>
<span class="token key atrule">permissions</span><span class="token punctuation">:</span>
  <span class="token key atrule">contents</span><span class="token punctuation">:</span> write


<span class="token comment"># 任务，可以有多个</span>
<span class="token comment"># workflow的核心就是jobs，任务job放在jobs这个集合下，每一个job都有job_id，用job_id标识一个具体任务</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token comment"># 任务ID，可以自定义</span>
  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>
    <span class="token comment"># 指定运行所需要的虚拟机环境,必填字段</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># 构建环境使用 ubuntu</span>
    <span class="token comment"># 任务步骤，一个job可以包含多个步骤</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># 官方action，将代码拉取到虚拟机</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout   
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install and Build   <span class="token comment"># 安装依赖、打包，如果提前已打包好无需这一步</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          npm install
          npm run build</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy   <span class="token comment"># 部署， 将打包内容发布到 github page</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@3.7.1 <span class="token comment"># 使用别人写好的 actions</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>  <span class="token comment"># 自定义环境变量</span>
          <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHOOK_VITE_TEST <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment"># github token，需要在仓库的 secrets 中配置</span>
          <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> feature/git<span class="token punctuation">-</span>page <span class="token comment"># 部署到哪个分支</span>
          <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> dist <span class="token comment"># 打包后的文件夹</span>
        <span class="token comment">#   REPOSITORY_NAME: verneyzhou/verneyzhou.github.io # 这是我的 github page 仓库</span>
        <span class="token comment">#   TARGET_FOLDER: githook-vite-test # 打包的文件将放到静态服务器 githook-vite-test 目录下</span>

</code></pre></div><div class="custom-block tip"><p class="custom-block-title">流程梳理</p> <ol><li>只有当 main 分支有新的 push 推送时候才会执行整个 <code>workflow</code>；</li> <li>整个 <code>workflow</code> 只有一个 job, job_id 是 <code>build-and-deploy</code> ,name 被省略；</li> <li>job 有三个<code>step</code>：
<ul><li>第一步是 <code>Checkout</code>,获取源码，使用的 <code>action</code> 是GitHub官方的 <code>actions/checkout</code>;</li> <li>第二步：<code>Install and Build,</code>执行了两条命令：<code>npm install,npm run build</code>,分别安装依赖与打包应用.</li> <li>第三步：<code>Deploy</code> 部署，使用的第三方action：<code>JamesIves/github-pages-deploy-action@3.7.1</code>,它有两个参数：分别是<code>ACCESS_TOKEN, BRANCH, FOLDER</code>，更多关于这个 action 的详情可以去查看<a href="https://github.com/JamesIves/github-pages-deploy-action" target="_blank" rel="noopener noreferrer">github-pages-deploy-action<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul></li></ol></div> <blockquote><p>如果你需要某个action，不必自己写复杂的脚本，直接引用他人写好的 action即可，整个持续集成过程，就变成了一个actions的组合，你可以在GitHub的官方市场，可以搜索到他人提交的actions。</p></blockquote> <p><code>runs-on</code>: GitHub Actions给我们提提供的运行环境主要有以下几种：</p> <p><code>ubuntu-latest，ubuntu-18.04或ubuntu-16.04windows-latest，windows-2019或windows-2016macOS-latest或macOS-10.14</code></p> <p>上面<code>.yml</code>里面的内容也可以在github里面直接进行添加：进入项目主页, <code>Actions -&gt; New workflow -&gt; set up a workflow yourself</code>，添加上述<code>.yml</code>模板，点击<code>Commit changes</code>即可~</p> <h4 id="添加token"><a href="#添加token" class="header-anchor">#</a> 添加Token</h4> <blockquote><p>在上面的<code>.yml</code>中需要传一个<code>ACCESS_TOKEN</code>，这个需要在github中配置~</p></blockquote> <ol><li>生成<code>Personal access tokens（个人访问令牌）</code>: 进入github个人主页，<code>Settings =&gt; Developer settings =&gt; Personal access tokens</code>，选择<code>Tokens(classic)</code>，再选择<code>Generate new token(calssic)</code>，生成token:</li></ol> <img src="/images/more/git02.jpg" width="auto"> <blockquote><p>如上图勾选之后，点击【Gernerate Token】，即可生成~</p></blockquote> <ol start="2"><li>个人token生成之后，赶紧复制（只会显示一次！！！）；之后进入项目主页，<code>settings =&gt; Secrets and varibles</code>，生成 secret:</li></ol> <img src="/images/more/git03.jpg" width="auto"> <p>名称自定义，然后将刚才复制的token粘贴到这里即可，保存~</p> <img src="/images/more/git04.jpg" width="auto"> <blockquote><p>这个创建的scret<code>GITHOOK_VITE_TEST</code>就是我们在<code>.yml</code>配置中需要用的到token了~</p></blockquote> <ol start="3"><li>等到token配置完毕，之后直接<code>git push</code>提交 main 分支代码，就会自动触发 Actions 就行 Git Page 的自动部署了~</li></ol> <img src="/images/more/git05.jpg" width="auto"> <blockquote><p>部署完成后就可以在<code>https://verneyzhou.github.io/githook-vite-test</code>中访问到最新的修改了~~~！！！</p></blockquote> <h3 id="自动部署阿里云服务器"><a href="#自动部署阿里云服务器" class="header-anchor">#</a> 自动部署阿里云服务器</h3> <blockquote><p>上面是通过<code>git-page.yml</code>脚本执行<code>Git Actions</code>让我们的项目自动部署到<code>Git Page</code>，那接下来实现怎么通过<code>Git Actions</code>自动部署项目到我们自己的服务器~</p></blockquote> <p>在配置工作流之前，我们需要先在阿里云服务器中生成SSH密钥对~ <a href="https://www.alibabacloud.com/help/zh/ecs/user-guide/connect-to-a-linux-instance-by-using-an-ssh-key-pair" target="_blank" rel="noopener noreferrer">通过密钥认证登录Linux实例<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>SSH密钥对是一种安全便捷的登录认证方式。在Windows环境和支持SSH命令的环境（例如Linux环境、Windows下的MobaXterm）中，您均可以使用SSH密钥对连接Linux实例。</p></blockquote> <p>1.<strong>创建密钥对</strong>：<code>ECS控制台 =&gt; 网络与安全 =&gt; 密钥对</code></p> <p><a href="https://www.alibabacloud.com/help/zh/ecs/user-guide/create-an-ssh-key-pair" target="_blank" rel="noopener noreferrer">创建SSH密钥对<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>创建密钥对流程比较简单，按上面官方文档操作即可~创建后会自动在本地下载<code>.pem</code>私钥文件</p> <ol start="2"><li><strong>绑定密钥对</strong>：<code>ECS控制台 =&gt; 实例与镜像 =&gt; 实例 =&gt; 实例属性 =&gt; 绑定密钥对</code></li></ol> <p><a href="https://www.alibabacloud.com/help/zh/ecs/user-guide/bind-an-ssh-key-pair-to-an-instance" target="_blank" rel="noopener noreferrer">绑定SSH密钥对<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>创建秘钥对之后，接着就是绑定ECS实例；流程简单，按上面官网操作即可~</p> <blockquote><p>绑定之后需要重启服务器，重启之后服务器中的nginx,node，jenkins服务可能会关闭，也需要重启（没有就算了）~</p></blockquote> <ol start="3"><li><strong>github中添加秘钥</strong>：项目 =&gt; <code>Settings =&gt; Secrets and variables =&gt; New repository secret</code></li></ol> <blockquote><p>跟上面添加<code>ACCESS_TOKEN</code>流程一样，这里填入的key就是创建秘钥时下载到本地私钥~</p></blockquote> <ol start="4"><li><strong>项目中添加<code>yml</code>文件</strong>：</li></ol> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># aliyun-deploy.yml</span>

<span class="token key atrule">name</span><span class="token punctuation">:</span> Build app and deploy to aliyun  <span class="token comment"># 工作流名称</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token comment">#监听push操作</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token comment"># 所监听的分支</span>
      <span class="token punctuation">-</span> feature/git<span class="token punctuation">-</span>aliyun
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>

    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># 服务器环境，表示你这个工作流程要运行在什么操作系统上</span>

    <span class="token key atrule">steps</span><span class="token punctuation">:</span> <span class="token comment"># 步骤</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v1
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Node.js
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1  <span class="token comment"># 安装 node 环境</span>
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
       <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'16'</span>  <span class="token comment"># 你的node版本</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install npm dependencies
      <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run build task
      <span class="token key atrule">run</span><span class="token punctuation">:</span> OUTDIR=githook<span class="token punctuation">-</span>vite npm run build  <span class="token comment"># 打包到 githook-vite 文件夹</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy to Server
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> easingthemes/ssh<span class="token punctuation">-</span>deploy@main <span class="token comment"># 使用的 action, 部署到阿里云服务器</span>
      <span class="token key atrule">env</span><span class="token punctuation">:</span> <span class="token comment"># 环境变量</span>
          <span class="token key atrule">SSH_PRIVATE_KEY</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ALIYUN_ECS_KEY <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment"># 保存在github上的私钥</span>
          <span class="token key atrule">ARGS</span><span class="token punctuation">:</span> <span class="token string">'-rltgoDzvO --delete'</span>
          <span class="token key atrule">SOURCE</span><span class="token punctuation">:</span> githook<span class="token punctuation">-</span>vite <span class="token comment"># 这是要复制到阿里云静态服务器的文件夹名称</span>
          <span class="token key atrule">REMOTE_HOST</span><span class="token punctuation">:</span> <span class="token string">'123.57.172.182'</span> <span class="token comment"># 你的阿里云公网地址</span>
          <span class="token key atrule">REMOTE_USER</span><span class="token punctuation">:</span> root <span class="token comment"># 阿里云登录后默认为 root 用户，并且所在文件夹为 root</span>
          <span class="token key atrule">TARGET</span><span class="token punctuation">:</span> /root/nginx/upload/dev <span class="token comment"># 打包后的文件夹将放在 /root/nginx/upload/dev 目录下</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">流程</p> <ol><li>使用 <code>actions/checkout@v1</code> 库克隆代码到 <code>ubuntu</code> 上。</li> <li>使用 <code>actions/setup-node@v1</code> 库安装 <code>nodejs</code>，<code>with</code> 提供了一个参数 <code>node-version</code> 表示要安装的 <code>nodejs</code> 版本。</li> <li>在 <code>ubuntu</code> 的 <code>shell</code> 上执行 <code>npm install</code> 下载依赖。</li> <li>执行 <code>npm run build</code> 打包项目。</li> <li>使用 <code>easingthemes/ssh-deploy@main</code> 库，这个库的作用就是用 <code>SSH</code> 的方式远程登录到阿里云服务器，将打包好的文件夹复制到阿里云指定的目录上。</li></ol></div> <blockquote><p>这里使用了第三方脚本来实现部署到阿里云服务器：<a href="https://github.com/easingthemes/ssh-deploy" target="_blank" rel="noopener noreferrer">easingthemes/ssh-deploy@main<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ol start="5"><li>yml文件配置完成后，之后将<code>feature/git-aliyun</code>分支<code>git push</code>提交，就会自动执行该脚本，将我们打包后的文件部署到阿里云服务器了，部署成功后，直接访问<code>http://123.57.172.182/dev/githook-vite</code>就可以看到我们的项目了~~~！！！</li></ol> <blockquote><p>我在部署过程中报错了，下方【报错记录】有备注，应该是ssh登录权限问题，我先在服务器安全规则处配上<code>0.0.0.0</code>把权限放开，才能部署成功...暂时无其他解...</p></blockquote> <p>上面的<code>Git Page</code>自动部署和自动部署阿里云服务器是属于<code>CD</code>的流程；作为<code>CI/CD</code>工具，<code>Git Actions</code>肯定是还可以添加一些<code>CI</code>操作的。</p> <h3 id="代码规范"><a href="#代码规范" class="header-anchor">#</a> 代码规范</h3> <blockquote><p>代码规范离不开各种 <code>Linter</code>, 一般前端项目都是使用 <code>Prettier</code> 解决代码格式问题，使用 <code>linters</code> 解决代码质量问题~</p></blockquote> <h4 id="eslint-prettier"><a href="#eslint-prettier" class="header-anchor">#</a> Eslint&amp;Prettier</h4> <ul><li><strong>集成Prettier配置</strong></li></ul> <blockquote><p><a href="https://prettier.io/" target="_blank" rel="noopener noreferrer">Prettier<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一款强大的代码格式化工具，支持 <code>JavaScript、TypeScript、CSS、SCSS、Less、JSX、Angular、Vue、GraphQL、JSON、Markdown</code> 等语言，基本上前端能用到的文件格式它都可以搞定，是当下最流行的代码格式化工具。</p></blockquote> <p>VSCode 编辑器使用 Prettier 配置需要下载插件: <code>Code formatter</code></p> <ol><li>安装：<code>npm i prettier -D</code></li> <li>在根目录下创建 <code>.prettierrc</code> 文件，配置</li></ol> <ul><li><strong>集成Eslint配置</strong></li></ul> <blockquote><p>ESLint 是一款用于查找并报告代码中问题的工具，并且支持部分问题自动修复。</p></blockquote> <p>VSCode 使用 ESLint 配置文件需要去插件市场下载插件: <code>ESLint</code> 。</p> <ol><li>安装：<code>npm i eslint -D</code></li> <li>执行<code>npx eslint --init</code>配置 ESlint</li></ol> <blockquote><p>关于 Eslint 与 Prettier 的具体配置不是这篇博文的重点，这里不再赘述~</p></blockquote> <ul><li><strong>解决Eslint 与 Prettier 冲突问题</strong></li></ul> <ol><li><p><code>npm i eslint-plugin-prettier eslint-config-prettier -D</code></p> <ul><li><code>eslint-plugin-prettier</code>: 将 <code>Prettier</code> 的规则设置到 <code>ESLint</code> 的规则中；</li> <li><code>eslint-config-prettier</code>: 关闭 <code>ESLint</code> 中与 <code>Prettier</code> 中会发生冲突的规则。</li></ul></li> <li><p>在 <code>.eslintrc.js</code> 添加 prettier 插件, 形成优先级：<code>Prettier 配置规则 &gt; ESLint 配置规则</code></p></li></ol> <ul><li>配置完成后，还需要在<code>package.json</code>中添加命令：</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js,.vue src&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;lint:fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js,.vue src --fix&quot;</span>
</code></pre></div><ul><li>之后在项目中添加如下代码：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">addFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// console.log('====addFn', addFn(3, 4));</span>
</code></pre></div><p>然后执行<code>npm run lint</code>看下eslint配置是否生效~ 正常命令行应该会有提示; 执行<code>npm run lint:fix</code>, 一般的格式会问题应该也会修复，但像上面代码应该会报错误：</p> <p><code>Error: 4:7 error 'addFn' is assigned a value but never used no-unused-vars</code></p> <p>不能自动修复，就需要手动修复了~</p> <h4 id="配置ci-yml"><a href="#配置ci-yml" class="header-anchor">#</a> 配置<code>ci.yml</code></h4> <blockquote><p>代码规范配置完成，项目中试着<code>npm run lint</code>看下是否生效；没问题后，接着配置ci流程~</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> CI

<span class="token comment"># 监听任意分支的pull或push都会触发</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'**'</span> <span class="token comment"># 任意分支</span>
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'**'</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">linter</span><span class="token punctuation">:</span> <span class="token comment"># 任务ID，可以自定义</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># 构建环境使用 ubuntu</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3 <span class="token comment"># 官方action，将代码拉取到虚拟机</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2 <span class="token comment"># 安装node环境</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token number">16</span>
      
      <span class="token comment"># 检查缓存</span>
      <span class="token comment"># 如果key命中缓存则直接将缓存的文件还原到 path 目录，从而减少流水线运行时间</span>
      <span class="token comment"># 若 key 没命中缓存时，在当前Job成功完成时将自动创建一个新缓存</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache
        <span class="token comment"># 缓存命中结果会存储在steps.[id].outputs.cache-hit里，该变量在继后的step中可读</span>
        <span class="token key atrule">id</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>dependencies
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> ./node_modules <span class="token comment"># 缓存文件目录的路径</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># key中定义缓存标志位的生成方式。runner.OS指当前环境的系统</span>
          <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            ${{ runner.os }}-node-</span>
      
      <span class="token comment"># 安装依赖</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Dependencies
        <span class="token comment"># 如果缓存标志位没命中，则执行该step。否则就跳过该step</span>
        <span class="token key atrule">if</span><span class="token punctuation">:</span> steps.cache<span class="token punctuation">-</span>dependencies.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true'
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci  <span class="token comment"># npm ci和npm install命令一样，是用来安装依赖的命令, npm i依赖package.json，而npm ci依赖package-lock.json</span>

      <span class="token comment"># 代码格式检查</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Running Lint
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run lint
</code></pre></div><blockquote><p>关于上面的<code>Cahe</code>步骤中，7 天内未被访问的任何缓存条目将会被删除。 可以存储的缓存数没有限制，但存储库中所有缓存的总大小限制为 10 GB。</p></blockquote> <p>上面的<code>ci.yml</code>配置完成后，然后执行<code>git push</code>,会在<code>github</code>的 Actions 上发现有 workflows 在执行，如果代码中有格式问题的话，应该是会报错的~</p> <h4 id="husky"><a href="#husky" class="header-anchor">#</a> Husky</h4> <blockquote><p>上面添加了<code>npm run lint</code>虽然能够暴露出来不规范的语法，但不能保证每个人在提交代码之前执行一遍<code>lint</code>校验; 而且<code>ci.yml</code>运行报错也只是一个提示而已，用户还是很有可能提交不符合规范的代码的~ 所以就需要 <code>git hooks</code> 来自动化校验的过程，否则禁止提交。</p></blockquote> <p><a href="https://git-scm.com/docs/githooks" target="_blank" rel="noopener noreferrer">Git hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是可以设置在 <code>Git</code> 生命周期的在某些事件下运行的脚本。 这些事件包括提交的不同阶段，例如在提交之前（<code>pre-commit</code>,提交之后（<code>post-commit</code>）。</p> <p><a href="https://github.com/typicode/husky" target="_blank" rel="noopener noreferrer">Husky<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一种工具:让我们可以轻松地接入 <code>Git hooks</code> ，并在我们需要的某些阶段运行脚本。</p> <blockquote><p>它的工作方式是在<code>package.json</code>文件中包含一个对象，该对象通过配置 <code>Husky</code> 来运行我们指定的脚本。 之后，<code>Husky</code> 负责管理我们的脚本(<code>hooks</code> 将在 <code>Git</code> 生命周期中的哪一点运行)~</p></blockquote> <ul><li><strong>husky初体验</strong></li></ul> <ol><li>安装 husky：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npm i husky -D
npx husky install
</code></pre></div><ol start="2"><li><code>package.json</code>脚本中添加命令：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&quot;prepare&quot;: &quot;husky install&quot;
</code></pre></div><p>如果如果你的<code>npm</code>版本大于等于<code>7.1.0</code>, 可以执行：<code>npm set-script prepare &quot;husky install&quot;</code>自动添加~</p> <ol start="3"><li>添加一个<code>lint</code>钩子：新建<code>.husky/pre-commit</code>，写入以下内容：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>#!/bin/sh
. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;
npm run lint
</code></pre></div><p>或者执行<code>npx husky add .husky/pre-commit &quot;npm run lint&quot;</code>，也会自动生成上述文件~</p> <ol start="4"><li>之后项目中添加如下代码：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">addFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// console.log('====addFn', addFn(3, 4));</span>
</code></pre></div><ol start="5"><li>最后<code>git commit</code>提交修改，会发现报错了：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>➜  githook-vite-test git:<span class="token punctuation">(</span>feature/dev<span class="token punctuation">)</span> ✗ <span class="token function">git</span> commit -am添加husky

<span class="token operator">&gt;</span> githook-vite-test@0.0.0 lint
<span class="token operator">&gt;</span> eslint --ext .js,.vue src


/Users/zhouyuan10/test-code/githook-vite-test/src/App.vue
  <span class="token number">4</span>:7  error  <span class="token string">'addFn'</span> is assigned a value but never used  no-unused-vars

✖ <span class="token number">1</span> problem <span class="token punctuation">(</span><span class="token number">1</span> error, <span class="token number">0</span> warnings<span class="token punctuation">)</span>

husky - pre-commit hook exited with code <span class="token number">1</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>说明在<code>pre-commmit</code>这个<code>hook</code>里执行了<code>npm run lint</code>，存在报错信息，则<code>commit</code>提交将会失效~</p></blockquote> <p>运用<code>Husky</code>我们就可以在<code>commit, push</code>等这些钩子中执行一些如代码校验，代码格式化等任务，在这个项目中添加了<code>Husky</code>以后每次提交都会强制进行校验，能很大程度确保代码格式规范~</p> <ul><li><a href="https://juejin.cn/post/6904150964266074119" target="_blank" rel="noopener noreferrer">如何通过 Git 和 Husky 添加提交钩子并实现代码任务自动化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="commitlint"><a href="#commitlint" class="header-anchor">#</a> Commitlint</h4> <blockquote><p>既然已经到这里了，那就顺手再把<code>commitlint</code>加了吧~</p></blockquote> <p>为什么需要 <code>Commitlint</code>，除了在后续的生成<code>changelog</code>文件和语义发版中需要提取<code>commit</code>中的信息，也利于其他同学分析你提交的代码，所以我们要约定<code>commit</code>的规范。</p> <ol><li><p>安装<code>Commitlint</code>: <code>npm i @commitlint/config-conventional @commitlint/cli -D</code></p></li> <li><p>将<code>commitlint</code>添加到钩子：<code>npx husky add .husky/commit-msg 'npx --no-install commitlint --edit &quot;$1&quot;'</code></p></li></ol> <blockquote><p>也可以新建<code>.husky/commit-msg</code>, 手动添加内容：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>#!/usr/bin/env sh
. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;

npx --no-install commitlint --edit &quot;&quot;
</code></pre></div><ol start="3"><li>项目根目录下创建<code>.commitlintrc</code>，并写入配置：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@commitlint/config-conventional&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>最后随便修改一下，提交一条不符合规范的<code>commit</code>，测试下是否生效，如：<code>git commit -amsubmit</code>；正常情况应该会像下面一样报错：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>➜  githook-vite-test git:<span class="token punctuation">(</span>feature/dev<span class="token punctuation">)</span> ✗ <span class="token function">git</span> commit -amsubmit

<span class="token operator">&gt;</span> githook-vite-test@0.0.0 lint
<span class="token operator">&gt;</span> eslint --ext .js,.vue src

⧗   input: submit
✖   subject may not be empty <span class="token punctuation">[</span>subject-empty<span class="token punctuation">]</span>
✖   <span class="token builtin class-name">type</span> may not be empty <span class="token punctuation">[</span>type-empty<span class="token punctuation">]</span>

✖   found <span class="token number">2</span> problems, <span class="token number">0</span> warnings
ⓘ   Get help: https://github.com/conventional-changelog/commitlint/<span class="token comment">#what-is-commitlint</span>

husky - commit-msg hook exited with code <span class="token number">1</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span>
</code></pre></div><p>提交一个符合规范的commit:<code>git commit -am&quot;ci: 添加commitlint&quot;</code>, 就提交成功了~</p> <div class="custom-block tip"><p class="custom-block-title">@commitlint/config-conventional 规范</p> <ul><li><code>feat</code>：新功能</li> <li><code>fix</code>：修补 BUG</li> <li><code>docs</code>：修改文档，比如 <code>README, CHANGELOG, CONTRIBUTE</code> 等等</li> <li><code>style</code>：不改变代码逻辑 (仅仅修改了空格、格式缩进、逗号等等)</li> <li><code>refactor</code>：重构（既不修复错误也不添加功能）</li> <li><code>perf</code>：优化相关，比如提升性能、体验</li> <li><code>test</code>：增加测试，包括单元测试、集成测试等</li> <li><code>build</code>：构建系统或外部依赖项的更改</li> <li><code>ci</code>：自动化流程配置或脚本修改</li> <li><code>chore</code>：非 src 和 test 的修改，发布版本等</li> <li><code>revert</code>：恢复先前的提交</li></ul></div> <p><a href="https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional" target="_blank" rel="noopener noreferrer">@commitlint/config-conventional<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="代码测试"><a href="#代码测试" class="header-anchor">#</a> 代码测试</h3> <blockquote><p>前端测试主要有单元测试（Unit Test）、集成测试（Integration Test）、UI 测试（UI Test）。由于项目里只有一个页面组件，且本章节的重点是实现CI而不是前端自动化测试，因此这里用单元测试来实现一下~</p></blockquote> <p>所谓<strong>单元测试</strong>，指的是对最小测试单元进行测试。比如在项目中写了一个计算文本宽度的方法，方法写好之后如果直接拿过去用，除非是经过验证的现有方法，否则是容易出现处理上的漏洞的。因此我们可以把这个方法单独提取出来，放到测试文件夹中。</p> <p>在前端项目中，有很多用于单元测试的工具，如最常见的<a href="https://jestjs.io/zh-Hans/" target="_blank" rel="noopener noreferrer">Jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。但对于由<code>vite</code>构建的前端项目而言，使用<code>vite</code>配套的<code>vitest</code>会更加方便、舒适。</p> <p><a href="https://cn.vitest.dev/guide/" target="_blank" rel="noopener noreferrer">vitest官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>安装<code>vitest</code>: <code>npm install vitest -D</code></p></li> <li><p><code>package.json</code>中添加脚本命令：<code>&quot;test&quot;: &quot;vitest&quot;</code></p></li> <li><p>根目录下新建<code>test</code>目录，新建<code>sum.js</code>和<code>sum.text.js</code>文件：</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * sum.js
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * sum.test.js
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vitest'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> sum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./sum'</span><span class="token punctuation">;</span>

<span class="token comment">// test方法是用于编写单元测试的函数。test方法接受两个参数：测试名称和测试函数</span>
<span class="token comment">// test(name: string, testFn: Function, timeout?: number | TestOptions): Promise&lt;void&gt;;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'adds 1 + 2 to equal 3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// expect方法是用于创建断言的函数。断言是一种用于验证代码的行为和输出是否符合预期的方式。</span>
    <span class="token comment">// expect(actual).matcher(expected)</span>
    <span class="token comment">// actual是一个表达式或变量，表示要检查的实际值。matcher是一个函数，表示要使用的比较方法。expected是一个值或对象，表示期望的结果。</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>然后执行<code>npm run test</code>，会发现：</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">&gt;</span> vitest

<span class="token builtin class-name">command</span> serve <span class="token builtin class-name">test</span> 

 DEV  v0.34.5 /Users/zhouyuan10/test-code/githook-vite-test

 ✓ test/sum.test.js <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   ✓ adds <span class="token number">1</span> + <span class="token number">2</span> to equal <span class="token number">3</span>

 Test Files  <span class="token number">1</span> passed <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      Tests  <span class="token number">1</span> passed <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   Start at  <span class="token number">23</span>:12:59
   Duration  156ms <span class="token punctuation">(</span>transform 19ms, setup 0ms, collect 10ms, tests 1ms, environment 0ms, prepare 52ms<span class="token punctuation">)</span>


 PASS  Waiting <span class="token keyword">for</span> <span class="token function">file</span> changes<span class="token punctuation">..</span>.
       press h to show help, press q to quit
</code></pre></div><blockquote><p>说明添加单元测试成功了~</p></blockquote> <ol start="5"><li>之后在<code>ci.yml</code>后面添加测试step:</li></ol> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">tests</span><span class="token punctuation">:</span> <span class="token comment"># 测试</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> linter <span class="token comment"># 依赖linter任务</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token number">16</span> 
      <span class="token comment"># 安装依赖</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Dependencies
        <span class="token comment"># 如果缓存标志位没命中，则执行该step。否则就跳过该step</span>
        <span class="token key atrule">if</span><span class="token punctuation">:</span> steps.cache<span class="token punctuation">-</span>dependencies.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true'
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run test
</code></pre></div><ol start="6"><li>添加完成后，就可以提交，这样就每次提交会执行<code>npm run test</code>了，在github的 Actions 上就能看到<code>tests</code>任务的自动执行~</li></ol> <ul><li>测试覆盖率</li></ul> <blockquote><p>代码覆盖率是一种用于评估代码的质量和完整性的指标，它表示代码中有多少比例被测试用例所覆盖。测试覆盖率的工具可以帮助开发者生成和查看覆盖率报告，从而发现代码中的潜在问题和改进点。</p></blockquote> <p>关于<code>vitest</code>更多的使用这里不做阐述了，具体可参考下面链接：</p> <ul><li><a href="https://blog.csdn.net/qq_28255733/article/details/132479859" target="_blank" rel="noopener noreferrer">【前端】前端单元测试、覆盖率测试工具Vitest入门指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7190159077908381756" target="_blank" rel="noopener noreferrer">年轻人的第一款单元测试框架———vitest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="生成压缩包并发版"><a href="#生成压缩包并发版" class="header-anchor">#</a> 生成压缩包并发版</h3> <p>这里在<code>git-page.yml</code>中添加一个新的任务, 实现自动生成压缩包并发版，这里就直接上代码了~</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># git-page.yml</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
    <span class="token key atrule">zip-and-release</span><span class="token punctuation">:</span> <span class="token comment"># 生成压缩包并发版</span>
        <span class="token key atrule">needs</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>and<span class="token punctuation">-</span>deploy <span class="token comment"># 依赖前面的build-and-deploy任务</span>
        <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
        <span class="token key atrule">steps</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
        <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2
            <span class="token key atrule">with</span><span class="token punctuation">:</span>
            <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token number">16</span>

        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache
            <span class="token comment"># 缓存命中结果会存储在steps.[id].outputs.cache-hit里，该变量在继后的step中可读</span>
            <span class="token key atrule">id</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>dependencies
            <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
            <span class="token key atrule">with</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> ./node_modules <span class="token comment"># 缓存文件目录的路径</span>
            <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># key中定义缓存标志位的生成方式。runner.OS指当前环境的系统</span>
            <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
                ${{ runner.os }}-node-</span>

        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install npm dependencies
            <span class="token comment"># 如果缓存标志位没命中，则执行该step。否则就跳过该step</span>
            <span class="token key atrule">if</span><span class="token punctuation">:</span> steps.cache<span class="token punctuation">-</span>dependencies.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true'
            <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install

        <span class="token comment"># 从package.json里获取version属性的值</span>
        <span class="token comment"># 在CD Workflow中会给每个生成的制品打上标签，而标签取值于version值</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Read Version
            <span class="token comment"># 读取出来的值会放在steps.[id].outputs.value供其他步骤step读取</span>
            <span class="token key atrule">id</span><span class="token punctuation">:</span> version
            <span class="token key atrule">uses</span><span class="token punctuation">:</span> ashley<span class="token punctuation">-</span>taylor/read<span class="token punctuation">-</span>json<span class="token punctuation">-</span>property<span class="token punctuation">-</span>action@v1.0
            <span class="token key atrule">with</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> ./package.json
            <span class="token key atrule">property</span><span class="token punctuation">:</span> version

        

        <span class="token comment"># 打包, 压缩制品，压缩到bundle.zip压缩包里</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Building
            <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            npm run build
            pwd &amp; ls
            zip -r bundle ./dist/**</span>

        <span class="token comment"># 基于当前commit进行版本发布(Create a release)，tag_name是v前缀加上package.json的version值</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Create GitHub Release
            <span class="token comment"># 此步骤中，版本发布后会返回对应的url，以供下面上传制品的步骤中读取使用</span>
            <span class="token key atrule">id</span><span class="token punctuation">:</span> create_release
            <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/create<span class="token punctuation">-</span>release@v1
            <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHOOK_VITE_TEST <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token key atrule">with</span><span class="token punctuation">:</span>
            <span class="token key atrule">tag_name</span><span class="token punctuation">:</span> v$<span class="token punctuation">{</span><span class="token punctuation">{</span>steps.version.outputs.value<span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token key atrule">release_name</span><span class="token punctuation">:</span> v$<span class="token punctuation">{</span><span class="token punctuation">{</span>steps.version.outputs.value<span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token key atrule">draft</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">prerelease</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

        <span class="token comment"># 把bundle.zip上传到仓库对应的发布版本Release上</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Update Release Asset
            <span class="token key atrule">id</span><span class="token punctuation">:</span> upload<span class="token punctuation">-</span>release<span class="token punctuation">-</span>asset
            <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>release<span class="token punctuation">-</span>asset@v1
            <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHOOK_VITE_TEST <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token key atrule">with</span><span class="token punctuation">:</span>
            <span class="token key atrule">upload_url</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.create_release.outputs.upload_url <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token key atrule">asset_path</span><span class="token punctuation">:</span> ./bundle.zip
            <span class="token key atrule">asset_name</span><span class="token punctuation">:</span> bundle.zip
            <span class="token key atrule">asset_content_type</span><span class="token punctuation">:</span> application/zip <span class="token comment"># 格式</span>
</code></pre></div><ol><li>配置完成后，在<code>main</code>分支上提交新的修改，之后github上就会自动执行<code>git-page.yml</code>里面的工作流；</li> <li>等到<code>Git Page</code>部署完成后，就开始获取<code>package.json</code>中的版本信息，打包压缩成<code>.zip</code>文件；</li> <li>压缩完成后就添加版本信息，并把压缩包上传到<code>Release</code>上；执行完毕后，就可以在github上看到信息了：</li></ol> <img src="/images/more/git20.jpeg" width="auto"> <p>点进去就可以看到<code>Release</code>压缩包信息：</p> <img src="/images/more/git21.png" width="auto"> <blockquote><p>在每次主干更新后进行版本发布不仅符合开源项目的更新流程，而且利于我们之后部署特定发布版本的制品~</p></blockquote> <p>Q: 为什么需要 <code>Update Release Asset</code> 这个流程?</p> <blockquote><p>首先，把制品放在对应的发布版本上是很常见的开源行为，读者也可以把制品下载下来放到nginx直接查看页面效果。其次也是很重要的，是为了回滚（下面深入篇会写回滚机制的实现）的实现，回滚需要快速获取前一个发布版本的制品覆盖到部署机器上。因此需要我们把每个制品都存放在对应的发布版本以实现持久化。</p></blockquote> <p>**注：**每次提 pr 时要确保 <code>package.json</code> 中的 <code>version</code> 值有变化，不然 <code>CD Workflow</code> 会在 <code>Create GitHub Release</code> 的步骤里报已存在 <code>Tag</code> 的错误; <code>version</code>值在<code>CD Workflow</code>主要用于版本发布，此过程需要填写指定的<code>tag_name</code>。</p> <h3 id="邮箱自动通知"><a href="#邮箱自动通知" class="header-anchor">#</a> 邮箱自动通知</h3> <blockquote><p><code>github action</code>执行流程的时候，成功后不会发送通知，只有失败才会，需要我们手动开启一下~</p></blockquote> <p>进入github，点击右侧头像 =&gt; settings, 进入个人主页  =&gt; 点击左侧【Notifations】 =&gt; 往下滑，System =&gt; Actions, 【Only notify failed workflows】取消，保存~</p> <img src="/images/more/git10.jpeg" width="auto"> <h3 id="添加状态徽章"><a href="#添加状态徽章" class="header-anchor">#</a> 添加状态徽章</h3> <p>我们可以在项目的<code>README.md</code>中加了<code>CI</code>和<code>CD</code>两个状态徽章来代表这个项目已成功实现了<code>CI</code>和<code>CD</code>的流程，如上图所示。这两个状态徽章是根据你指定的<code>Workflow</code>的名称和最近一次运行的结果动态变化的</p> <ul><li>直接在<code>README.md</code>中添加即可：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>![CI](https://github.com/verneyZhou/githook-vite-test/actions/workflows/ci.yml/badge.svg)
![CD](https://github.com/verneyZhou/githook-vite-test/actions/workflows/git-page.yml/badge.svg)
</code></pre></div><ul><li>添加完成，提交，就会有这个：</li></ul> <img src="/images/more/git22.jpeg" width="auto"> <h3 id="添加回滚机制"><a href="#添加回滚机制" class="header-anchor">#</a> 添加回滚机制</h3> <p>在项目发布后，如果发现当前项目存在重大bug时，一般操作就是手动回滚到上一个版本。因此需要新增一个用于回滚的workflow(下称<code>Rollback Workflow</code>)。</p> <ul><li>新增<code>rollback.yml</code>:</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Rollback
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span> <span class="token comment"># 触发条件Event: workflow_dispatch; 该事件还能支持手动输入信息，然后把这个信息当作环境变量供整个Workflow读取</span>
    <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
      <span class="token comment"># 这里的version指的是我们要部署的哪个发布版本的制品</span>
      <span class="token comment"># 这里输入的信息会作为github.event.inputs.version供此Workflow下的job读取</span>
      <span class="token key atrule">version</span><span class="token punctuation">:</span>
        <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;choose a version to deploy&quot;</span>
        <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">Rollback</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># 输出我们输入的version值</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Echo Version
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">VERSION</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.event.inputs.version <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          echo &quot;Version: $VERSION&quot;</span>
  
      <span class="token comment"># 获取对应发布版本的制品</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Download Artifact
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dsaltares/fetch<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>release<span class="token punctuation">-</span>asset@master
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;tags/${{ github.event.inputs.version }}&quot;</span>
          <span class="token comment"># 指定存放制品的压缩包</span>
          <span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token string">&quot;bundle.zip&quot;</span>
          <span class="token comment"># 这里需要CD Workflow中准备工作里的Github Personal Access Token</span>
          <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHOOK_VITE_TEST <span class="token punctuation">}</span><span class="token punctuation">}</span>
  
      <span class="token comment"># 下载压缩包后解压</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Unzip
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          unzip bundle.zip
          ls -a ./dist</span>

      <span class="token comment"># 把部署到git page</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload to GitPage Deploy   <span class="token comment"># 部署， 将打包内容发布到 github page</span>
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@3.7.1 <span class="token comment"># 使用别人写好的 actions</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>  <span class="token comment"># 自定义环境变量</span>
          <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHOOK_VITE_TEST <span class="token punctuation">}</span><span class="token punctuation">}</span>  <span class="token comment"># github token，需要在仓库的 secrets 中配置</span>
          <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> feature/git<span class="token punctuation">-</span>page <span class="token comment"># 部署到哪个分支</span>
          <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> dist <span class="token comment"># 打包后的文件夹</span>
</code></pre></div><blockquote><p><code>Rollback Workflow</code>的触发条件<code>Event</code>, 这里我们选择<code>workflow_dispatch</code>: 该事件还能支持手动输入信息，然后把这个信息当作环境变量供整个<code>Workflow</code>读取。</p></blockquote> <ul><li>配置好<code>rollback.yml</code>之后，<code>main</code>分支提交代码，之后如果发现线上版本有问题，需要回滚时，在 github 上直接手动操作：</li></ul> <img src="/images/more/git23.jpeg" width="auto"> <blockquote><p>手动执行成功后，即将线上代码回滚到了指定版本~</p></blockquote> <h3 id="搭配docker"><a href="#搭配docker" class="header-anchor">#</a> 搭配Docker</h3> <h3 id="gitlab-ci"><a href="#gitlab-ci" class="header-anchor">#</a> Gitlab-ci</h3> <ul><li><strong>gitlab-ci &amp;&amp; 自动化部署工具的运行机制</strong></li></ul> <ol><li><p>通过在项目根目录下配置<code>.gitlab-ci.yml</code>文件，可以控制ci流程的不同阶段，例如<code>install/检查/编译/部署服务器</code>；gitlab平台会扫描<code>.gitlab-ci.yml</code>文件，并据此处理ci流程；</p></li> <li><p>ci流程在每次团队成员<code>push/merge</code>后之后触发。每当你<code>push/merge</code>一次，<code>gitlab-ci</code>都会检查项目下有没有<code>.gitlab-ci.yml</code>文件，如果有，它会执行你在里面编写的脚本，并完整地走一遍从<code>intall =&gt; eslint检查=&gt;编译 =&gt;部署服务器</code>的流程；</p></li> <li><p>gitlab-ci提供了指定ci运行平台的机制，它提供了一个叫<code>gitlab-runner</code>的软件，只要在对应的平台(机器或docker)上下载并运行这个命令行软件，并输入从gitlab交互界面获取的token,就可以把当前机器和对应的gitlab-ci流程绑定，也即：每次跑ci都在这个平台上进行。</p></li> <li><p><code>.gitlab-ci</code>的所有流程都是可视化的，每个流程节点的状态可以在gitlab的交互界面上看到，包括执行成功或失败。因为它的执行看上去就和多节管道一样，所以我们通常用<code>pipeLine</code>来称呼它;</p></li> <li><p>不同<code>push/merge</code>所触发的CI流程不会互相影响，也就是说，你的一次push引发的CI流程并不会因为接下来另一位同事的push而阻断，它们是互不影响的。这一个特点方便让测试同学根据不同版本进行测试。</p></li> <li><p><code>pipeline</code>不仅能被动触发，也是可以手动触发的。</p></li></ol> <p><a href="https://zhuanlan.zhihu.com/p/184936276" target="_blank" rel="noopener noreferrer">Gitlab-ci:从零开始的前端自动化部署<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="备注"><a href="#备注" class="header-anchor">#</a> 备注</h2> <h3 id="与其他ci-cd工具的比较"><a href="#与其他ci-cd工具的比较" class="header-anchor">#</a> 与其他CI/CD工具的比较</h3> <p>Gitlab CI：与Gitlab高度绑定，项目放在Gitlab就谈不上开源了</p> <p>Travic CI：限时免费，过后按进程收费</p> <p>Drone CI：执行任务时，国内机器从Github拉取仓库代码时会偶尔超时，从而导致任务失败</p> <p>Jenkins CI：除了存在与Drone CI一样的缺点外，自身比较重量，占用宿主机较多资源</p> <h2 id="报错记录"><a href="#报错记录" class="header-anchor">#</a> 报错记录</h2> <ul><li><code>git push</code>后自行执行<code>.yml</code>时报错：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>remote: Permission to verneyzhou/verneyzhou.github.io.git denied to github-actions<span class="token punctuation">[</span>bot<span class="token punctuation">]</span>.
fatal: unable to access <span class="token string">'https://github.com/verneyzhou/verneyzhou.github.io.git/'</span><span class="token builtin class-name">:</span> The requested URL returned error: <span class="token number">403</span>
Running post deployment cleanup jobs… 🗑️
/usr/bin/git worktree remove github-pages-deploy-action-temp-deployment-folder --force
fatal: <span class="token string">'github-pages-deploy-action-temp-deployment-folder'</span> is not a working tree
Error: The process <span class="token string">'/usr/bin/git'</span> failed with <span class="token builtin class-name">exit</span> code <span class="token number">128</span>
Deployment failed<span class="token operator">!</span> ❌
</code></pre></div><blockquote><p>因为在我的<code>git-page.yml</code>文件是使用第三方脚本来部署git page,这里报的是用户没有权限的问题，在 <code>.yml</code>中添加如下命令即可~</p></blockquote> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">permissions</span><span class="token punctuation">:</span>
  <span class="token key atrule">contents</span><span class="token punctuation">:</span> write
</code></pre></div><ul><li>自动部署到阿里云服务器时报错：</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 报错1：</span>
❌ <span class="token punctuation">[</span>Rsync<span class="token punctuation">]</span> stderr: 
ssh: connect to <span class="token function">host</span> <span class="token number">123.57</span>.172.182 port <span class="token number">22</span>: Connection timed out
rsync: connection unexpectedly closed <span class="token punctuation">(</span><span class="token number">0</span> bytes received so far<span class="token punctuation">)</span> <span class="token punctuation">[</span>sender<span class="token punctuation">]</span>
<span class="token function">rsync</span> error: unexplained error <span class="token punctuation">(</span>code <span class="token number">255</span><span class="token punctuation">)</span> at io.c<span class="token punctuation">(</span><span class="token number">231</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>sender<span class="token operator">=</span><span class="token number">3.2</span>.7<span class="token punctuation">]</span>

❌️ <span class="token punctuation">[</span>Rsync<span class="token punctuation">]</span> stdout: 

❌ <span class="token punctuation">[</span>Rsync<span class="token punctuation">]</span> command: 
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Error: R<span class="token punctuation">]</span> <span class="token function">rsync</span> exited with code <span class="token number">255</span>


<span class="token comment"># 报错2：</span>
❌ <span class="token punctuation">[</span>SSH<span class="token punctuation">]</span> Adding <span class="token function">host</span> to <span class="token variable"><span class="token variable">`</span>known_hosts<span class="token variable">`</span></span> ERROR <span class="token number">123.57</span>.172.182 Command failed: ssh-keyscan -p <span class="token number">22</span> -H <span class="token number">123.57</span>.172.182  <span class="token operator">&gt;&gt;</span> 
</code></pre></div><blockquote><p>ssh 22 端口访问权限问题，需要在<a href="https://ecs.console.aliyun.com/server/i-2zef9ue9eyhqrvjxs3aq/group/ingress" target="_blank" rel="noopener noreferrer">安全组规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>添加~</p></blockquote> <p>方法1：安全组规则<code>22</code>的端口授权对象直接配置为<code>0.0.0.0</code>，但这样比较危险，意味着谁都可以访问，比较容易被攻击，慎用~</p> <p>方法2：暂没找到...😌</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://mp.weixin.qq.com/s/_MhYVCoJwgd0VsFVxPpxuw" target="_blank" rel="noopener noreferrer">GitHub Actions 自动部署前端 Vue 项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6887751398499287054#heading-7" target="_blank" rel="noopener noreferrer">Github Actions 自动构建前端项目并部署到服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/unreliable_narrator/article/details/124468384" target="_blank" rel="noopener noreferrer">GitHubActions详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6950799922178310152" target="_blank" rel="noopener noreferrer">手把手教你用 Github Actions 部署前端项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7113562222852309023" target="_blank" rel="noopener noreferrer">作为前端，要学会用Github Action给自己的项目加上CICD<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6971812117993226248" target="_blank" rel="noopener noreferrer">前端工程化配置指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E5%B7%A5%E7%A8%8B%E5%8C%96" title="标签">#工程化</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/25/2023, 2:44:16 AM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/project/mono-react-project.html"><div>
            MonoRepo——React项目实践
            <!----></div></a> <span class="date">09-11</span></dt></dl><dl><dd>02</dd> <dt><a href="/more/jenkins-deploy.html"><div>
            Jenkins前端自动化部署
            <!----></div></a> <span class="date">08-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/more/docker-note.html"><div>
            Docker入门学习笔记
            <!----></div></a> <span class="date">08-05</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>一苇 | <a href="https://beian.miit.gov.cn/" target="_blank" style="font-weight:normal"><img src="/blog/images/icp.png" width="20" height="20" alt="公网备案"/>京ICP备2021006935号-2</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><!----><!----><div></div></div></div>
    <script src="/assets/js/app.69732266.js" defer></script><script src="/assets/js/3.a2a245ac.js" defer></script><script src="/assets/js/73.d93b48c0.js" defer></script><script src="/assets/js/4.245b4373.js" defer></script>
  </body>
</html>
