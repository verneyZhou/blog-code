<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目实战：使用ethers.js本地生成离线钱包 | 一葦</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/icons/favicon.ico">
    <link rel="manifest" href="/blog/js/mainfest.json">
    <link rel="stylesheet" href="/blog/styles/css/style.css">
    <script type="utf-8" src="/blog/js/disable-user-zoom.js"></script>
    <meta name="description" content="这是一苇的前端技术博客哦~">
    <meta name="Author" content="一苇">
    <meta rel="keywords" content="verneyzhou,阿沐,一苇,前端,docs.verneyzhou-code.cn,博客,fe,IT,技术">
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport" content="width=device-width,width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/blog/assets/css/0.styles.61668f40.css" as="style"><link rel="preload" href="/blog/assets/js/app.76fa57e6.js" as="script"><link rel="preload" href="/blog/assets/js/3.a2a245ac.js" as="script"><link rel="preload" href="/blog/assets/js/97.23b93196.js" as="script"><link rel="preload" href="/blog/assets/js/4.245b4373.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2c3fb9b8.js"><link rel="prefetch" href="/blog/assets/js/100.84bf5092.js"><link rel="prefetch" href="/blog/assets/js/101.6b905b71.js"><link rel="prefetch" href="/blog/assets/js/102.7ece9162.js"><link rel="prefetch" href="/blog/assets/js/103.01775736.js"><link rel="prefetch" href="/blog/assets/js/104.c9b72bdf.js"><link rel="prefetch" href="/blog/assets/js/105.b7ceaf1e.js"><link rel="prefetch" href="/blog/assets/js/106.5321c092.js"><link rel="prefetch" href="/blog/assets/js/107.dfde808a.js"><link rel="prefetch" href="/blog/assets/js/108.76e55255.js"><link rel="prefetch" href="/blog/assets/js/109.b6b8f78e.js"><link rel="prefetch" href="/blog/assets/js/11.d8db7424.js"><link rel="prefetch" href="/blog/assets/js/110.03440fcf.js"><link rel="prefetch" href="/blog/assets/js/111.7001d092.js"><link rel="prefetch" href="/blog/assets/js/112.2c3ec8a9.js"><link rel="prefetch" href="/blog/assets/js/113.17aec38b.js"><link rel="prefetch" href="/blog/assets/js/114.d5c86b19.js"><link rel="prefetch" href="/blog/assets/js/115.c5e7ed6d.js"><link rel="prefetch" href="/blog/assets/js/116.c48f3f00.js"><link rel="prefetch" href="/blog/assets/js/117.46f33ca4.js"><link rel="prefetch" href="/blog/assets/js/118.891ade5b.js"><link rel="prefetch" href="/blog/assets/js/119.58a54ba4.js"><link rel="prefetch" href="/blog/assets/js/12.b6309f61.js"><link rel="prefetch" href="/blog/assets/js/120.e96a1ea7.js"><link rel="prefetch" href="/blog/assets/js/121.ba217794.js"><link rel="prefetch" href="/blog/assets/js/122.fa395dd6.js"><link rel="prefetch" href="/blog/assets/js/123.8dee52e0.js"><link rel="prefetch" href="/blog/assets/js/124.5964facb.js"><link rel="prefetch" href="/blog/assets/js/125.2b5713d4.js"><link rel="prefetch" href="/blog/assets/js/126.0b020030.js"><link rel="prefetch" href="/blog/assets/js/127.73d8db3a.js"><link rel="prefetch" href="/blog/assets/js/128.e350bccb.js"><link rel="prefetch" href="/blog/assets/js/129.6efe4916.js"><link rel="prefetch" href="/blog/assets/js/13.8df65d8d.js"><link rel="prefetch" href="/blog/assets/js/130.2feb4a2a.js"><link rel="prefetch" href="/blog/assets/js/131.ebf7c589.js"><link rel="prefetch" href="/blog/assets/js/132.2fd4ea82.js"><link rel="prefetch" href="/blog/assets/js/133.e9db689a.js"><link rel="prefetch" href="/blog/assets/js/134.8c37cc25.js"><link rel="prefetch" href="/blog/assets/js/135.ae783483.js"><link rel="prefetch" href="/blog/assets/js/136.92671aff.js"><link rel="prefetch" href="/blog/assets/js/137.0db285b2.js"><link rel="prefetch" href="/blog/assets/js/138.c73abe07.js"><link rel="prefetch" href="/blog/assets/js/139.41626f14.js"><link rel="prefetch" href="/blog/assets/js/14.b950268f.js"><link rel="prefetch" href="/blog/assets/js/140.99fdcd5c.js"><link rel="prefetch" href="/blog/assets/js/141.fbc8e614.js"><link rel="prefetch" href="/blog/assets/js/142.4f34e195.js"><link rel="prefetch" href="/blog/assets/js/143.127a9850.js"><link rel="prefetch" href="/blog/assets/js/144.0f65824d.js"><link rel="prefetch" href="/blog/assets/js/145.1ee8c5fc.js"><link rel="prefetch" href="/blog/assets/js/146.3ba627c8.js"><link rel="prefetch" href="/blog/assets/js/147.09e3708c.js"><link rel="prefetch" href="/blog/assets/js/148.5e218851.js"><link rel="prefetch" href="/blog/assets/js/149.0e52c725.js"><link rel="prefetch" href="/blog/assets/js/15.030ef122.js"><link rel="prefetch" href="/blog/assets/js/150.d3ae11a8.js"><link rel="prefetch" href="/blog/assets/js/151.817b960d.js"><link rel="prefetch" href="/blog/assets/js/152.5a77e7f4.js"><link rel="prefetch" href="/blog/assets/js/153.5bc9a462.js"><link rel="prefetch" href="/blog/assets/js/154.d4c7af79.js"><link rel="prefetch" href="/blog/assets/js/155.dc03710e.js"><link rel="prefetch" href="/blog/assets/js/156.5e872d85.js"><link rel="prefetch" href="/blog/assets/js/157.9e2becea.js"><link rel="prefetch" href="/blog/assets/js/158.a2942e85.js"><link rel="prefetch" href="/blog/assets/js/159.26c63404.js"><link rel="prefetch" href="/blog/assets/js/16.cfb1a53b.js"><link rel="prefetch" href="/blog/assets/js/160.96d3beaa.js"><link rel="prefetch" href="/blog/assets/js/161.c34c5b2e.js"><link rel="prefetch" href="/blog/assets/js/162.45223b4c.js"><link rel="prefetch" href="/blog/assets/js/163.dca039a1.js"><link rel="prefetch" href="/blog/assets/js/164.c188755b.js"><link rel="prefetch" href="/blog/assets/js/165.774591a1.js"><link rel="prefetch" href="/blog/assets/js/166.0bb7199e.js"><link rel="prefetch" href="/blog/assets/js/167.6c729c82.js"><link rel="prefetch" href="/blog/assets/js/168.9ddae43f.js"><link rel="prefetch" href="/blog/assets/js/169.a041747e.js"><link rel="prefetch" href="/blog/assets/js/17.7f17682b.js"><link rel="prefetch" href="/blog/assets/js/170.b70b623c.js"><link rel="prefetch" href="/blog/assets/js/171.4b0257b9.js"><link rel="prefetch" href="/blog/assets/js/172.7f4c2d3c.js"><link rel="prefetch" href="/blog/assets/js/173.b3b75dfa.js"><link rel="prefetch" href="/blog/assets/js/174.52d7ea40.js"><link rel="prefetch" href="/blog/assets/js/175.beb33995.js"><link rel="prefetch" href="/blog/assets/js/176.95e06720.js"><link rel="prefetch" href="/blog/assets/js/177.f491f17d.js"><link rel="prefetch" href="/blog/assets/js/178.71c66889.js"><link rel="prefetch" href="/blog/assets/js/179.ca760d60.js"><link rel="prefetch" href="/blog/assets/js/18.cbfdeb09.js"><link rel="prefetch" href="/blog/assets/js/180.b50d733c.js"><link rel="prefetch" href="/blog/assets/js/181.335287be.js"><link rel="prefetch" href="/blog/assets/js/182.8cad2bdb.js"><link rel="prefetch" href="/blog/assets/js/183.37a5fb7a.js"><link rel="prefetch" href="/blog/assets/js/184.e920bd7f.js"><link rel="prefetch" href="/blog/assets/js/185.0ffd8f98.js"><link rel="prefetch" href="/blog/assets/js/186.b9b7e58a.js"><link rel="prefetch" href="/blog/assets/js/187.ee242116.js"><link rel="prefetch" href="/blog/assets/js/188.a7f885d1.js"><link rel="prefetch" href="/blog/assets/js/189.41087ead.js"><link rel="prefetch" href="/blog/assets/js/19.355e9671.js"><link rel="prefetch" href="/blog/assets/js/190.0ff0d636.js"><link rel="prefetch" href="/blog/assets/js/191.b0c298a8.js"><link rel="prefetch" href="/blog/assets/js/192.e1fdc41d.js"><link rel="prefetch" href="/blog/assets/js/193.a12e8cc4.js"><link rel="prefetch" href="/blog/assets/js/194.552a7d72.js"><link rel="prefetch" href="/blog/assets/js/195.65c94003.js"><link rel="prefetch" href="/blog/assets/js/196.7ecad629.js"><link rel="prefetch" href="/blog/assets/js/197.769eb8f4.js"><link rel="prefetch" href="/blog/assets/js/198.417e877e.js"><link rel="prefetch" href="/blog/assets/js/199.c198e821.js"><link rel="prefetch" href="/blog/assets/js/20.925de35d.js"><link rel="prefetch" href="/blog/assets/js/200.aaf0c7da.js"><link rel="prefetch" href="/blog/assets/js/201.b9b528a4.js"><link rel="prefetch" href="/blog/assets/js/202.dc2130c4.js"><link rel="prefetch" href="/blog/assets/js/203.494c16a2.js"><link rel="prefetch" href="/blog/assets/js/204.5451a8b2.js"><link rel="prefetch" href="/blog/assets/js/205.3a9d9143.js"><link rel="prefetch" href="/blog/assets/js/206.8f218f53.js"><link rel="prefetch" href="/blog/assets/js/207.e286efec.js"><link rel="prefetch" href="/blog/assets/js/208.b15e7ceb.js"><link rel="prefetch" href="/blog/assets/js/209.8be13a1b.js"><link rel="prefetch" href="/blog/assets/js/21.73aa97dc.js"><link rel="prefetch" href="/blog/assets/js/210.8af7e1c3.js"><link rel="prefetch" href="/blog/assets/js/211.cf4f7aba.js"><link rel="prefetch" href="/blog/assets/js/212.b1e8078a.js"><link rel="prefetch" href="/blog/assets/js/213.99b7c2dd.js"><link rel="prefetch" href="/blog/assets/js/214.3073fbf3.js"><link rel="prefetch" href="/blog/assets/js/215.7884f71b.js"><link rel="prefetch" href="/blog/assets/js/216.fc4df39d.js"><link rel="prefetch" href="/blog/assets/js/217.dcf694ab.js"><link rel="prefetch" href="/blog/assets/js/218.91ac665b.js"><link rel="prefetch" href="/blog/assets/js/219.04f0e072.js"><link rel="prefetch" href="/blog/assets/js/22.a5e696f3.js"><link rel="prefetch" href="/blog/assets/js/220.ec5aa358.js"><link rel="prefetch" href="/blog/assets/js/221.eeacfb35.js"><link rel="prefetch" href="/blog/assets/js/222.6d68084c.js"><link rel="prefetch" href="/blog/assets/js/223.6d1ff62a.js"><link rel="prefetch" href="/blog/assets/js/224.b1682e38.js"><link rel="prefetch" href="/blog/assets/js/23.e58011e2.js"><link rel="prefetch" href="/blog/assets/js/24.9a66d8cd.js"><link rel="prefetch" href="/blog/assets/js/25.bbfbc411.js"><link rel="prefetch" href="/blog/assets/js/26.0a58cb04.js"><link rel="prefetch" href="/blog/assets/js/27.30ff8122.js"><link rel="prefetch" href="/blog/assets/js/28.1b138f63.js"><link rel="prefetch" href="/blog/assets/js/29.8706dde6.js"><link rel="prefetch" href="/blog/assets/js/30.7354bbdd.js"><link rel="prefetch" href="/blog/assets/js/31.42f329d7.js"><link rel="prefetch" href="/blog/assets/js/32.89b2e87d.js"><link rel="prefetch" href="/blog/assets/js/33.e762c9a2.js"><link rel="prefetch" href="/blog/assets/js/34.c4cc6afc.js"><link rel="prefetch" href="/blog/assets/js/35.a3e5fba6.js"><link rel="prefetch" href="/blog/assets/js/36.03e0ebe8.js"><link rel="prefetch" href="/blog/assets/js/37.ec453e24.js"><link rel="prefetch" href="/blog/assets/js/38.cf1f5fcf.js"><link rel="prefetch" href="/blog/assets/js/39.1156b141.js"><link rel="prefetch" href="/blog/assets/js/40.d33ba184.js"><link rel="prefetch" href="/blog/assets/js/41.2820e583.js"><link rel="prefetch" href="/blog/assets/js/42.c088f38a.js"><link rel="prefetch" href="/blog/assets/js/43.a832abeb.js"><link rel="prefetch" href="/blog/assets/js/44.9391c80d.js"><link rel="prefetch" href="/blog/assets/js/45.a0235304.js"><link rel="prefetch" href="/blog/assets/js/46.9730b825.js"><link rel="prefetch" href="/blog/assets/js/47.56fd5076.js"><link rel="prefetch" href="/blog/assets/js/48.b5374317.js"><link rel="prefetch" href="/blog/assets/js/49.8bb025d5.js"><link rel="prefetch" href="/blog/assets/js/5.32a2e1b6.js"><link rel="prefetch" href="/blog/assets/js/50.8011aa1f.js"><link rel="prefetch" href="/blog/assets/js/51.a915dbc4.js"><link rel="prefetch" href="/blog/assets/js/52.99d2399f.js"><link rel="prefetch" href="/blog/assets/js/53.be187caf.js"><link rel="prefetch" href="/blog/assets/js/54.07b08901.js"><link rel="prefetch" href="/blog/assets/js/55.3ef99688.js"><link rel="prefetch" href="/blog/assets/js/56.9258b8d8.js"><link rel="prefetch" href="/blog/assets/js/57.4762d5e6.js"><link rel="prefetch" href="/blog/assets/js/58.8d1268be.js"><link rel="prefetch" href="/blog/assets/js/59.20eb3b71.js"><link rel="prefetch" href="/blog/assets/js/6.9db196de.js"><link rel="prefetch" href="/blog/assets/js/60.0adc2f64.js"><link rel="prefetch" href="/blog/assets/js/61.7a4bb849.js"><link rel="prefetch" href="/blog/assets/js/62.4b595b7b.js"><link rel="prefetch" href="/blog/assets/js/63.8efe6050.js"><link rel="prefetch" href="/blog/assets/js/64.2daf2555.js"><link rel="prefetch" href="/blog/assets/js/65.01aa6930.js"><link rel="prefetch" href="/blog/assets/js/66.b71e30c2.js"><link rel="prefetch" href="/blog/assets/js/67.b88d5dfc.js"><link rel="prefetch" href="/blog/assets/js/68.0455a3ce.js"><link rel="prefetch" href="/blog/assets/js/69.aac22b54.js"><link rel="prefetch" href="/blog/assets/js/7.c958551b.js"><link rel="prefetch" href="/blog/assets/js/70.513be29f.js"><link rel="prefetch" href="/blog/assets/js/71.dda331fc.js"><link rel="prefetch" href="/blog/assets/js/72.20dc430c.js"><link rel="prefetch" href="/blog/assets/js/73.5046c7ef.js"><link rel="prefetch" href="/blog/assets/js/74.436c2c94.js"><link rel="prefetch" href="/blog/assets/js/75.717953f1.js"><link rel="prefetch" href="/blog/assets/js/76.4898deac.js"><link rel="prefetch" href="/blog/assets/js/77.1417b15d.js"><link rel="prefetch" href="/blog/assets/js/78.d51e77f9.js"><link rel="prefetch" href="/blog/assets/js/79.e7af2572.js"><link rel="prefetch" href="/blog/assets/js/8.d5f2c1ba.js"><link rel="prefetch" href="/blog/assets/js/80.f5d5c456.js"><link rel="prefetch" href="/blog/assets/js/81.e46213a6.js"><link rel="prefetch" href="/blog/assets/js/82.a2b78450.js"><link rel="prefetch" href="/blog/assets/js/83.ec57022e.js"><link rel="prefetch" href="/blog/assets/js/84.1a1e65b2.js"><link rel="prefetch" href="/blog/assets/js/85.453ecac0.js"><link rel="prefetch" href="/blog/assets/js/86.98f2e40a.js"><link rel="prefetch" href="/blog/assets/js/87.56486cd5.js"><link rel="prefetch" href="/blog/assets/js/88.25a76bc5.js"><link rel="prefetch" href="/blog/assets/js/89.0a157175.js"><link rel="prefetch" href="/blog/assets/js/9.952385f9.js"><link rel="prefetch" href="/blog/assets/js/90.5b516e54.js"><link rel="prefetch" href="/blog/assets/js/91.6d74ff97.js"><link rel="prefetch" href="/blog/assets/js/92.3b2d151b.js"><link rel="prefetch" href="/blog/assets/js/93.f20ce1f2.js"><link rel="prefetch" href="/blog/assets/js/94.c3062efe.js"><link rel="prefetch" href="/blog/assets/js/95.206ed12d.js"><link rel="prefetch" href="/blog/assets/js/96.fad1a27d.js"><link rel="prefetch" href="/blog/assets/js/98.a90f6f17.js"><link rel="prefetch" href="/blog/assets/js/99.adc32b70.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.381052ad.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.61668f40.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/icons/apple-touch-icon.png" alt="一葦" class="logo"> <span class="site-name can-hide">一葦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/blog/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/blog/more/" class="nav-link">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/blog/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/blog/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/blog/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/more/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">其他</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/about/" class="nav-link">ME</a></li><li class="dropdown-item"><!----> <a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="images/poster03.jpeg"> <div class="blogger-info"><h3></h3> <span>是旷野，不是轨道哦，少年。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/archives/" class="nav-link">时间轴</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><!----> <span class="title" style="display:;">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/frontend/css/" class="nav-link">CSS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><!----> <span class="title" style="display:;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/skills/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/skills/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link">源码</a></li><li class="dropdown-item"><!----> <a href="/blog/more/web3/" class="nav-link">Web3</a></li><li class="dropdown-item"><!----> <a href="/blog/more/" class="nav-link">更多</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><!----> <span class="title" style="display:;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>PC端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/vue-node-admin/" class="nav-link">vue-node-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-vite-admin.html" class="nav-link">vue3-vite-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-cli-admin.html" class="nav-link">vue3-cli-admin</a></li><li class="dropdown-subitem"><a href="/blog/skills/vue/vue3-webpack5-admin.html" class="nav-link">vue3-webpack5-admin</a></li><li class="dropdown-subitem"><a href="/blog/project/mono-react-project.html" class="nav-link">teach-react-mono</a></li></ul></li><li class="dropdown-item"><h4>移动端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/project/mobile-h5/" class="nav-link">微信h5</a></li><li class="dropdown-subitem"><a href="/blog/project/mini-program/" class="nav-link">微信小程序</a></li><li class="dropdown-subitem"><a href="/blog/project/mobile/" class="nav-link">移动端开发笔记</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/blog/more/ai/" class="nav-link">AI</a></div><div class="nav-item"><a href="/blog/tool/" class="nav-link">其他</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/about/" class="nav-link">ME</a></li><li class="dropdown-item"><!----> <a href="https://github.com/verneyZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>项目实战：使用ethers.js本地生成离线钱包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/838ca5/#笔记" class="sidebar-link">笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#助记词-钱包-私钥" class="sidebar-link">助记词 =&gt; 钱包 =&gt; 私钥</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#钱包-provider-以太坊网络" class="sidebar-link">钱包 =&gt; Provider =&gt; 以太坊网络</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#私钥的保存-助记词的导入" class="sidebar-link">私钥的保存 + 助记词的导入</a></li></ul></li><li><a href="/blog/pages/838ca5/#实践" class="sidebar-link">实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#provider-ts" class="sidebar-link">Provider.ts</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#metamaskwallet-ts" class="sidebar-link">MetamaskWallet.ts</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#etherswallet-ts" class="sidebar-link">EthersWallet.ts</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#basscontract-ts" class="sidebar-link">BassContract.ts</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#封装合约方法" class="sidebar-link">封装合约方法</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#crypto-js" class="sidebar-link">crypto.js</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#合约调用" class="sidebar-link">合约调用</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#流程图" class="sidebar-link">流程图</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#报错记录" class="sidebar-link">报错记录</a></li></ul></li><li><a href="/blog/pages/838ca5/#备注" class="sidebar-link">备注</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#metamask原理总结" class="sidebar-link">MetaMask原理总结</a></li><li class="sidebar-sub-header"><a href="/blog/pages/838ca5/#初始化流程" class="sidebar-link">初始化流程</a></li></ul></li><li><a href="/blog/pages/838ca5/#问题" class="sidebar-link">问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/pages/838ca5/#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/blog/categories/?category=more" title="分类" data-v-0c557b5e>more</a></li><li data-v-0c557b5e><a href="/blog/categories/?category=web3" title="分类" data-v-0c557b5e>web3</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>阿沐</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-08-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">项目实战：使用ethers.js本地生成离线钱包<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="项目实战-使用ethers-js本地生成离线钱包"><a href="#项目实战-使用ethers-js本地生成离线钱包" class="header-anchor">#</a> 项目实战：使用ethers.js本地生成离线钱包</h1> <blockquote><p>由于之前做的web3小游戏需要下载metamask才能进行后续交互，且metamask需要翻墙才能下载，上手成本较高，所以考虑本地生成离线钱包，无需下载第三方钱包也能开启我们的web3之旅~</p></blockquote> <h2 id="笔记"><a href="#笔记" class="header-anchor">#</a> 笔记</h2> <h3 id="助记词-钱包-私钥"><a href="#助记词-钱包-私钥" class="header-anchor">#</a> 助记词 =&gt; 钱包 =&gt; 私钥</h3> <ul><li><strong>数字钱包</strong></li></ul> <blockquote><p>钱包用来存钱的，在区块链中，我们的数字资产都会对应到一个账户地址上， <strong>只有拥有账户的钥匙（私钥）才可以对资产进行消费（用私钥对消费交易签名）</strong>。</p></blockquote> <p>私钥通过椭圆曲线生成公钥， 公钥通过哈希函数生成地址，这两个过程都是单向的。数字钱包实际是一个管理私钥（生成、存储、签名）的工具，注意钱包并不保存资产，资产是在链上的。</p> <p>创建账号关键是生成一个私钥， 私钥是一个32个字节的数， 生成一个私钥在本质上在1到2^256之间选一个数字。</p> <p>什么是<strong>去中心化钱包</strong>，账号秘钥的管理，交易的签名，都是在客户端完成， 即私钥相关的信息都是在用户手中，<strong>钱包的开发者接触不到私钥信息</strong>。</p> <blockquote><p>对应的中心化钱包则是私钥由中心服务器托管，如交易所的钱包就是这种。</p></blockquote> <ul><li><code>path: m/44'/60'/0'/0/0</code></li></ul> <blockquote><p>BIP44则是为这个路径约定了一个规范的含义(也扩展了对多币种的支持)，BIP0044指定了包含5个预定义树状层级的结构：<code>m / purpose' / coin' / account' / change / address_index</code></p></blockquote> <div class="custom-block tip"><p class="custom-block-title">提示</p> <ul><li>m是固定的, Purpose也是固定的，值为44（或者 0x8000002C）;</li> <li>Coin type: 这个代表的是币种，0代表比特币，1代表比特币测试链，60代表以太坊; 完整的币种列表地址：https://github.com/satoshilabs/slips/blob/master/slip-0044.md</li> <li>Account: 代表这个币的账户索引，从0开始</li> <li>Change: 常量0用于外部(收款地址)，常量1用于内部（也称为找零地址）。外部用于在钱包外可见的地址（例如，用于接收付款）。内部链用于在钱包外部不可见的地址，用于返回交易变更。 (所以一般使用0)</li> <li>address_index: 这就是地址索引，从0开始，代表生成第几个地址，官方建议，每个account下的address_index不要超过20</li></ul></div> <p>以太坊钱包也遵循BIP44标准，确定路径是m/44'/60'/a'/0/n; a 表示帐号，n 是第 n 生成的地址，60 是在 SLIP44 提案中确定的以太坊的编码。所以我们要开发以太坊钱包同样需要对比特币的钱包提案BIP32、BIP39有所了解。</p> <ul><li><strong>BIP39</strong></li></ul> <blockquote><p>BIP32 提案可以让我们保存一个随机数种子（通常16进制数表示），而不是一堆秘钥，确实方便一些，不过用户使用起来(比如冷备份)也比较繁琐，这就出现了BIP39，它是使用助记词的方式，生成种子的，这样用户只需要记住12（或24）个单词，单词序列通过 PBKDF2 与 HMAC-SHA512 函数创建出随机种子作为 BIP32 的种子。</p></blockquote> <p>参考：<a href="https://learnblockchain.cn/2018/09/28/hdwallet" target="_blank" rel="noopener noreferrer">理解开发HD 钱包涉及的 BIP32、BIP44、BIP39<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><strong>实现: 随机数 =&gt; 助记词 =&gt; 钱包</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 生成随机数</span>
<span class="token keyword">var</span> rand <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成助记词</span>
<span class="token keyword">var</span> mnemonic <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">entropyToMnemonic</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token string">&quot;m/44'/60'/0'/0/0&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 通过助记词创建钱包</span>
<span class="token keyword">let</span> wallet <span class="token operator">=</span> ethers<span class="token punctuation">.</span>Wallet<span class="token punctuation">.</span><span class="token function">fromMnemonic</span><span class="token punctuation">(</span>mnemonic<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
{
    address: &quot;0x79d8B50477c84D0C74634513acA923ddFabf3CB2&quot;  // 地址
    privateKey: &quot;0x7d499b3fe6d706b9cdd5948550d8525347688e13e8d6ec6ac8e0d948eb47829b&quot;  // 私钥
    publicKey: &quot;0x047c6e585d411bd3efa75337f012bdba7e366c567e2efe2e845c2823b4c86b1933cab60fb3ef40816ebf718ac34aebd76d129bdd58a1c675593779cc783f  // 公钥
}
 */</span>
</code></pre></div><p>参考：<a href="https://learnblockchain.cn/2018/10/25/eth-web-wallet_1" target="_blank" rel="noopener noreferrer">使用ethers.js开发以太坊Web钱包1 - 创建钱包账号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="钱包-provider-以太坊网络"><a href="#钱包-provider-以太坊网络" class="header-anchor">#</a> 钱包 =&gt; Provider =&gt; 以太坊网络</h3> <blockquote><p>如果想获取钱包账号的相关信息，比如余额、交易记录，发起交易的话，就需要让钱包连上以太坊的网络。不管是在 Web3 中，还是Ethers.js 都是使用 Provider 来进行网络连接的，Ethers.js 提供了集成多种 Provider 的方式</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用一个已有的web3 兼容的Provider，如有MetaMask。</span>
<span class="token keyword">let</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>Web3Provider</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>ethereum<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果没有自己的节点，可以使用Etherscan 及 Infura 的Provider，他们都是以太坊的基础设施服务提供商</span>
<span class="token keyword">let</span> provider <span class="token operator">=</span> ethers<span class="token punctuation">.</span><span class="token function">getDefaultProvider</span><span class="token punctuation">(</span><span class="token string">'ropsten'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果有自己的节点可以使用，可以连接主网，测试网络，私有网络或Ganache</span>
<span class="token keyword">let</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>JsonRpcProvider</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// activeWallet是用来请求余额发送交易的对象</span>
<span class="token keyword">var</span> activeWallet <span class="token operator">=</span> wallet<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>发送交易</strong></li></ul> <blockquote><p>所有会更改区块链数据的函数都需要关联签名器，如果是视图函数则只需要连接provider。</p></blockquote> <ol><li>首选发送一个签名交易，也称为离线交易（因为这个过程可以离线进行：在离线状态下对交易进行签名，然后把签名后的交易进行广播）；</li></ol> <blockquote><p>如果用MetaMask，则签名交易是利用MetaMask来完成的：在发送交易之前先检查当前钱包状态，检查钱包是否解锁(是否输入了密码进入了MetaMask)，通常使用<code>eth_requestAccounts</code>获取钱包账户地址，如果当前账号列表里面有数据的话，说明钱包已经解锁可以获得到账号，如果账号拿到的列表是空的话，那么说明钱包没有解锁。</p></blockquote> <ol start="2"><li>发送（广播）交易</li></ol> <blockquote><p>ethers.js 里提供了一个简洁的接口<code>sendTransaction</code>，来完成所有这两步操作(签名已经在接口里帮我们完成了)。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 交易传参</span>
<span class="token keyword">const</span> txParams <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">'000000000000000'</span><span class="token punctuation">,</span> <span class="token comment">// 发起交易的账户地址，如果没有就会用当前的默认账号</span>
  <span class="token literal-property property">nonce</span><span class="token operator">:</span> <span class="token string">'0x00'</span><span class="token punctuation">,</span> <span class="token comment">// 每次交易会生成一个唯一性的序号，展示交易顺序，也是为了防止重放攻击</span>
  <span class="token literal-property property">gasPrice</span><span class="token operator">:</span> <span class="token string">'0x09184e72a000'</span><span class="token punctuation">,</span> <span class="token comment">// gasPrice是交易发起者是愿意为工作量支付的单位费用，矿工在选择交易的时候，是按照gasPrice进行排序，先服务高出价者</span>
  <span class="token literal-property property">gasLimit</span><span class="token operator">:</span> <span class="token string">'0x2710'</span><span class="token punctuation">,</span> <span class="token comment">// 表示预计的指令和存储空间的工作量，如果工作量没有用完，会退回交易发起者</span>
  <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'0x0000000000000000000000000000000000000000'</span><span class="token punctuation">,</span> <span class="token comment">// 交易目标账户地址</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'0x00'</span><span class="token punctuation">,</span> <span class="token comment">// 用户转账金额</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'0x7f7465737432000000000000000000000000000000000000000000000000000000600057'</span><span class="token punctuation">,</span> <span class="token comment">// 是交易时附加的消息，如果是对合约地址发起交易，这会转化为对合约函数的执行</span>
  <span class="token literal-property property">chainId</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token comment">// 链id，用来去区分不同的链（分叉链）id</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * nonce 和 chainId 有一个重要的作用就是防止重放攻击，如果没有nonce的活，收款人可能把这笔签名过的交易再次进行广播，没有chainId的话，以太坊上的交易可以再次进行广播。
 * Gas是以太坊的工作计费机制，是交易者给矿工打包的一笔预算，预算 = gasLimit * gasPrice， 可以类比为请货车的运费：公里数 * 每公里单价。
 */</span>

<span class="token comment">// 发送交易</span>
activeWallet<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>txParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>如果是用MetaMask交易，则<code>nonce, gasPrice, gasLimit, data, chainId</code>可以在调起钱包的时候设置，不需要在调用合约的时候传参</p> <blockquote><p>在发送交易的时候 MetaMask 会弹出来一个授权的窗口，如果我们 gas和 gasPrice 没有设置的话，就可以在 MetaMask 里面去设置。如果这两个 gas 和 gas Price 设置了的话，MetaMask就会使用我们设置的gas。</p></blockquote> <p>参考：</p> <ul><li><a href="https://learnblockchain.cn/2018/10/26/eth-web-wallet_3" target="_blank" rel="noopener noreferrer">使用ethers.js开发以太坊Web钱包3 - 展示钱包信息及发起签名交易<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://learnblockchain.cn/article/52" target="_blank" rel="noopener noreferrer">如何使用Web3.js API 在页面中进行转账<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="私钥的保存-助记词的导入"><a href="#私钥的保存-助记词的导入" class="header-anchor">#</a> 私钥的保存 + 助记词的导入</h3> <ul><li><p>生成钱包后，通过<code>私钥 + 密码</code>将加密后的私钥保存在本地，每次需要调链上合约时，先读取本地缓存，用户输入密码后解密获取私钥，生成钱包，调合约；</p></li> <li><p>调用 ethers.js 的api就可以通过助记词导入，生成钱包，详见下方实践~</p></li></ul> <p>参考：<a href="https://learnblockchain.cn/2018/10/25/eth-web-wallet_2/" target="_blank" rel="noopener noreferrer">使用ethers.js开发以太坊Web钱包2 - 账号Keystore文件导入导出<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h2> <h3 id="provider-ts"><a href="#provider-ts" class="header-anchor">#</a> <code>Provider.ts</code></h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//Provider.js（最终要选择MetaMask还是ethers选择的提供者）</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ethers'</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Provider</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">static</span> <span class="token function">isMetaMaskProvider</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>ethereum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否安装MetaMask钱包, 先禁掉</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">static</span> <span class="token function">createProvider</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 基于浏览器插件MetaMask插件节点</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span>providers<span class="token punctuation">.</span><span class="token function">Web3Provider</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>ethereum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// JsonRpcProvider是基于url来连接！</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span>providers<span class="token punctuation">.</span><span class="token function">JsonRpcProvider</span><span class="token punctuation">(</span>
                <span class="token string">'http://xxx.xxx.xxx.xxx:xxx'</span> <span class="token comment">// 自己的ip地址</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="metamaskwallet-ts"><a href="#metamaskwallet-ts" class="header-anchor">#</a> <code>MetamaskWallet.ts</code></h4> <blockquote><p>Metamask钱包~</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//MetamaskWallet.js（MetaMask浏览器钱包）</span>
 
<span class="token keyword">import</span> Provider <span class="token keyword">from</span> <span class="token string">'./Provider'</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MetamaskWallet</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>signer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">getSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function-variable function">get_address</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span>account<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>
                <span class="token string">'eth_requestAccounts'</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> account<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token function">initProvider</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span> <span class="token string">'您正在使用当前离线钱包,暂时不能使用MetaMask钱包或先退出当前离线钱包！'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> Provider<span class="token punctuation">.</span><span class="token function">createProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'您正在使用的是MetaMask浏览器钱包！！！'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="etherswallet-ts"><a href="#etherswallet-ts" class="header-anchor">#</a> <code>EthersWallet.ts</code></h3> <blockquote><p>通过 <code>ethers.js</code>生成本地离线钱包~</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/**
  * ethers.js创建或导入钱包
  */</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Wallet<span class="token punctuation">,</span> ethers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ethers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Provider <span class="token keyword">from</span> <span class="token string">'./Provider'</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EthersWallet</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 生成助记词</span>
    <span class="token keyword">static</span> <span class="token function">createMnemonic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 生成随机数</span>
        <span class="token keyword">const</span> rand <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成助记词</span>
        <span class="token keyword">const</span> mnemonic <span class="token operator">=</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">entropyToMnemonic</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mnemonic<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token function">initProvider</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span> <span class="token string">'浏览器已经提供了MetaMask钱包,不能再创建其他离线钱包了！'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> Provider<span class="token punctuation">.</span><span class="token function">createProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'您正在使用的是离线钱包！！！'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// 私钥生成钱包！</span>
    <span class="token function">generate_private_key_wallet</span> <span class="token punctuation">(</span> private_key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span> private_key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// 助记词生成钱包！</span>
    <span class="token function">generate_mnemonric_wallet</span> <span class="token punctuation">(</span> mnemonric<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">m/44'/60'/0'/0/0</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _mnemonric <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mnemonric<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _mnemonric <span class="token operator">=</span> EthersWallet<span class="token punctuation">.</span><span class="token function">createMnemonic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            _mnemonric <span class="token operator">=</span> mnemonric<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">isValidMnemonic</span><span class="token punctuation">(</span>_mnemonric<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 必须连接provider才是活跃钱包</span>
            <span class="token keyword">return</span> Wallet<span class="token punctuation">.</span><span class="token function">fromMnemonic</span><span class="token punctuation">(</span> _mnemonric<span class="token punctuation">,</span> path <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// keystore.json文件生成钱包</span>
    <span class="token keyword">async</span> <span class="token function">generate_keystore_wallet</span> <span class="token punctuation">(</span> keystore_json_string<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> progressCallback<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 必须连接provider才是活跃钱包</span>
        <span class="token keyword">const</span> off_wallet <span class="token operator">=</span> <span class="token keyword">await</span> Wallet<span class="token punctuation">.</span><span class="token function">fromEncryptedJson</span><span class="token punctuation">(</span> keystore_json_string<span class="token punctuation">,</span> password<span class="token punctuation">,</span> progressCallback <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> off_wallet<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// 随机创建一个钱包</span>
    <span class="token function">create_new_wallet</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="basscontract-ts"><a href="#basscontract-ts" class="header-anchor">#</a> <code>BassContract.ts</code></h3> <blockquote><p>构造基础合约~</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> EthersWallet <span class="token keyword">from</span> <span class="token string">'./EthersWallet'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MetamaskWallet <span class="token keyword">from</span> <span class="token string">'./MetamaskWallet'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Provider <span class="token keyword">from</span> <span class="token string">'./Provider'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ethers'</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BassContract</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span> param<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> type<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initWallet</span><span class="token punctuation">(</span> param<span class="token punctuation">,</span> type <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 务必注意：钱包是实现了Signer接口,所以active_wallet中的一些属性是signer没有的【比如address属性】</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>active_WalletOrSigner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>active_wallet<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token function">initWallet</span> <span class="token punctuation">(</span> param<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> type<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _type <span class="token operator">=</span> type <span class="token operator">||</span> <span class="token string">'mnemonric'</span><span class="token punctuation">;</span> <span class="token comment">//  默认是按照助记词生成钱包   mnemonric 助记词 privateKey 私钥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 确定是MetaMask钱包</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>signer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MetamaskWallet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>signer<span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'MetaMask之this.signer'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>active_wallet <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'mnemonric'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 确定是Ethers自己创建或助记词导入的钱包！</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>active_wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EthersWallet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generate_mnemonric_wallet</span><span class="token punctuation">(</span> param <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'privateKey'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 通过私钥生成钱包</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>active_wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EthersWallet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generate_private_key_wallet</span><span class="token punctuation">(</span> param <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'ethers钱包========active_wallet'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>active_wallet <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token function">createContract</span> <span class="token punctuation">(</span> abi_data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> bytecode<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">ContractFactory</span><span class="token punctuation">(</span> abi_data<span class="token punctuation">,</span> bytecode<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>active_WalletOrSigner <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// 创建合约实例</span>
    <span class="token function">createContractInstance</span> <span class="token punctuation">(</span> contract_address<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> abi_data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ethers</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span> contract_address<span class="token punctuation">,</span> abi_data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>active_WalletOrSigner <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="封装合约方法"><a href="#封装合约方法" class="header-anchor">#</a> 封装合约方法</h3> <blockquote><p>Vue项目中合约方法封装~</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> CryptoJS <span class="token keyword">from</span> <span class="token string">'@/utils/crypto'</span><span class="token punctuation">;</span> <span class="token comment">// crypto 加解密</span>
<span class="token keyword">import</span> Provider <span class="token keyword">from</span> <span class="token string">'@/contracts/modules/Provider'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> BaseContract <span class="token keyword">from</span> <span class="token string">'@/contracts/modules/BaseContract'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">NFTS_ABI</span> <span class="token keyword">from</span> <span class="token string">'@/contracts/nfts-abi'</span><span class="token punctuation">;</span>



<span class="token comment">// 钱包初始化</span>
<span class="token comment">// 页面加载时调用该方法</span>
<span class="token keyword">async</span> <span class="token function">metaInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 已安装metamask钱包</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重置</span>
        <span class="token keyword">const</span> Contract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> wallet <span class="token operator">=</span> Contract<span class="token punctuation">.</span>active_WalletOrSigner<span class="token punctuation">;</span> <span class="token comment">// 获取钱包</span>
        <span class="token keyword">const</span> address <span class="token operator">=</span> <span class="token keyword">await</span> wallet<span class="token punctuation">.</span><span class="token function">get_address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'钱包地址:'</span><span class="token punctuation">,</span> wallet<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取钱包当前账户地址</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateUserAds'</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 全局保存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pageInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 未安装</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=====encryptPrivateKey'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encryptPrivateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'infoReset'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重置</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>encryptPrivateKey <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>userAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 加密私钥或用户地址丢失, 直接去初始化离线钱包</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/wallet-intro'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 该页面可以导入或重新创建助记词</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pageInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成Provider实例</span>
<span class="token function">Provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Provider<span class="token punctuation">.</span><span class="token function">createProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 获取gasPrice</span>
<span class="token keyword">async</span> <span class="token function">GasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getGasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 获取交易序列号nonce</span>
<span class="token keyword">async</span> <span class="token function">Nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTransactionCount</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 获取燃料费</span>
<span class="token keyword">async</span> <span class="token function">GetGas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gasPrice <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">formatEther</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>gasPrice <span class="token operator">*</span> <span class="token number">21000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 获取解密后的私钥</span>
<span class="token function">getEncryptPrivateKey</span><span class="token punctuation">(</span> pwd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> encryptPrivateKey<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _key <span class="token operator">=</span> encryptPrivateKey <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>encryptPrivateKey<span class="token punctuation">;</span>
    <span class="token keyword">return</span> CryptoJS<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>_key<span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解密</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 基础合约</span>
<span class="token function">baseWallet</span><span class="token punctuation">(</span>pwd <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> Contract <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Provider<span class="token punctuation">.</span><span class="token function">isMetaMaskProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Contract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过MetaMask生成钱包</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> _key <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEncryptPrivateKey</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            Contract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseContract</span><span class="token punctuation">(</span>_key<span class="token punctuation">,</span> <span class="token string">'privateKey'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过私钥生成离线钱包</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> wallet <span class="token operator">=</span> Contract<span class="token punctuation">.</span>active_WalletOrSigner<span class="token punctuation">;</span> <span class="token comment">// 钱包</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'======wallet'</span><span class="token punctuation">,</span> wallet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>Contract<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 合约实例</span>
<span class="token keyword">async</span> <span class="token function">Contract</span><span class="token punctuation">(</span>address <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> abi<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> pwd <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>address<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> res<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">baseWallet</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> contract <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">createContractInstance</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> abi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成合约实例</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'====contract'</span><span class="token punctuation">,</span> contract<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> contract<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">/**
 * 以购买nft为例：
 * 购买NFT-去
 */</span>
<span class="token keyword">async</span> <span class="token function">buyNFTs</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> confirmCallback<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>amount<span class="token punctuation">,</span> token_id<span class="token punctuation">,</span> address<span class="token punctuation">,</span> pwd <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token comment">// 生成Contract实例</span>
    <span class="token keyword">const</span> contract<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Contract</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>addressInfo<span class="token punctuation">.</span>erc721_address<span class="token punctuation">,</span> <span class="token constant">NFTS_ABI</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为null则表示生成失败（密码错误）</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>contract<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> gasPrice <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取gasPrice</span>
    <span class="token keyword">const</span> nonce <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取交易序列号nonce</span>
    <span class="token keyword">const</span> gasLimit <span class="token operator">=</span> <span class="token keyword">await</span> contract<span class="token punctuation">.</span>estimateGas<span class="token punctuation">.</span><span class="token function">buyNFTs</span><span class="token punctuation">(</span>token_id<span class="token punctuation">,</span> address<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取gasLimit</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=====GasPrice'</span><span class="token punctuation">,</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">formatEther</span><span class="token punctuation">(</span>gasPrice<span class="token punctuation">)</span><span class="token punctuation">,</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">formatEther</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> tx <span class="token operator">=</span> <span class="token keyword">await</span> contract<span class="token punctuation">.</span><span class="token function">buyNFTs</span><span class="token punctuation">(</span>token_id<span class="token punctuation">,</span> address<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        gasLimit<span class="token operator">:</span> <span class="token number">260000</span><span class="token punctuation">,</span>
        gasPrice<span class="token punctuation">,</span>
        nonce
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    confirmCallback <span class="token operator">&amp;&amp;</span> <span class="token function">confirmCallback</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点击确认后的回调</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> tx<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待tx执行完毕</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=====buyNFTs'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="crypto-js"><a href="#crypto-js" class="header-anchor">#</a> <code>crypto.js</code></h3> <blockquote><p>加解密私钥~</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">import</span> CryptoJS <span class="token keyword">from</span> <span class="token string">'crypto-js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token comment">// AES加密</span>
    <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token parameter">word<span class="token punctuation">,</span> keyStr<span class="token punctuation">,</span> ivStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        keyStr <span class="token operator">=</span> keyStr <span class="token operator">?</span> keyStr<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token operator">:</span> <span class="token string">'WyTIdrCHNVKtW4f8'</span><span class="token punctuation">;</span> <span class="token comment">// 十六进制数作为密钥</span>
        ivStr <span class="token operator">=</span> ivStr <span class="token operator">||</span> <span class="token string">'WyTIdrCHNVKtW4f8'</span><span class="token punctuation">;</span> <span class="token comment">// 十六进制数作为密钥偏移量</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>keyStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'===key'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iv <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ivStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> _word <span class="token operator">=</span> <span class="token keyword">typeof</span> word <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token operator">:</span> word<span class="token punctuation">;</span>
        <span class="token comment">// const encrypted = CryptoJS.AES.encrypt(_word, key,{</span>
        <span class="token comment">//         iv,</span>
        <span class="token comment">//         mode: CryptoJS.mode.CBC,</span>
        <span class="token comment">//         padding: CryptoJS.pad.Pkcs7</span>
        <span class="token comment">//     });</span>
        <span class="token keyword">const</span> encrypted <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>_word<span class="token punctuation">,</span> keyStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//对加密数据进行base64处理, 原理：就是先将字符串转换为utf8字符数组，再转换为base64数据</span>
        <span class="token keyword">let</span> encData <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> encData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 
    <span class="token comment">// AES解密</span>
    <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token parameter">word<span class="token punctuation">,</span> keyStr<span class="token punctuation">,</span> ivStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        keyStr <span class="token operator">=</span> keyStr <span class="token operator">?</span> keyStr<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token operator">:</span> <span class="token string">'WyTIdrCHNVKtW4f8'</span><span class="token punctuation">;</span>
        ivStr <span class="token operator">=</span> ivStr <span class="token operator">||</span> <span class="token string">'WyTIdrCHNVKtW4f8'</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>keyStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iv <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ivStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将数据先base64还原，再转为utf8数据</span>
        <span class="token keyword">let</span> decData <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// const decrypt = CryptoJS.AES.decrypt( decData, key,{</span>
        <span class="token comment">//     iv,</span>
        <span class="token comment">//     mode: CryptoJS.mode.CBC,</span>
        <span class="token comment">//     padding: CryptoJS.pad.Pkcs7</span>
        <span class="token comment">// });</span>
        <span class="token keyword">const</span> decrypt <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span> decData<span class="token punctuation">,</span> keyStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> decryptedStr <span class="token operator">=</span> decrypt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> decryptedStr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="合约调用"><a href="#合约调用" class="header-anchor">#</a> 合约调用</h3> <blockquote><p>最后就是项目中合约方法的调用~</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// nft购买</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">nftBuy</span><span class="token punctuation">(</span>pwd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> proxy<span class="token punctuation">.</span>elRoot<span class="token punctuation">.</span><span class="token function">buyNFTs</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">(</span>tx<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'confirmCallback'</span><span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点击确认后的回调</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 购买结束回调</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'====res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 输入密码错误</span>
            proxy<span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'生成钱包失败，请检查输入密码是否正确'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 购买成功回调处理</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="流程图"><a href="#流程图" class="header-anchor">#</a> 流程图</h3> <blockquote><p>根据上面的操作，大概画了一张流程图，梳理一下~</p></blockquote> <img src="/blog/images/more/web3-wallet01.jpg" width="auto" class="zoom-custom-imgs"> <blockquote><p>主要分三步：连接区块链网络、生成本地钱包、连接合约并调用~</p></blockquote> <h3 id="报错记录"><a href="#报错记录" class="header-anchor">#</a> 报错记录</h3> <ul><li>连接以太坊网络，调用<code>getBalance</code>时报错：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Uncaught</span> <span class="token punctuation">(</span><span class="token keyword">in</span> promise<span class="token punctuation">)</span> TypeError<span class="token operator">:</span> <span class="token string">'get'</span> on proxy<span class="token operator">:</span> property <span class="token string">'_network'</span> is a read<span class="token operator">-</span>only and non<span class="token operator">-</span>configurable data property on the proxy target but the proxy did not <span class="token keyword">return</span> its actual <span class="token function">value</span> <span class="token punctuation">(</span>expected <span class="token string">'#&lt;Object&gt;'</span> but got <span class="token string">'#&lt;Object&gt;'</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Provider初始化的时候别用 <code>ref(null)</code>, 可以用 window.Provider 或者 函数 Provider()</p></blockquote> <p>参考：<a href="https://blog.csdn.net/jdjfjgfdgdfg/article/details/124407358" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/jdjfjgfdgdfg/article/details/124407358<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><code>transaction</code>的时候报错：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">Error</span><span class="token operator">:</span> invalid hexlify <span class="token function">value</span> <span class="token punctuation">(</span>argument<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x79d8B50477c84D0C74634513acA923ddFabf3CB2&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x51E09974EFAf3a7f46671c3f1120166361Fd2EfE&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;BigNumber&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;hex&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x0de0b6b3a7640000&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;gasPrice&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;BigNumber&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;hex&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x3b9aca00&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;nonce&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string-property property">&quot;gasLimit&quot;</span><span class="token operator">:</span><span class="token number">21000</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token constant">INVALID_ARGUMENT</span><span class="token punctuation">,</span> version<span class="token operator">=</span>bytes<span class="token operator">/</span><span class="token number">5.6</span><span class="token number">.1</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>transaction</code>报错：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>index<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">261</span> <span class="token function">Uncaught</span> <span class="token punctuation">(</span><span class="token keyword">in</span> promise<span class="token punctuation">)</span> Error<span class="token operator">:</span> insufficient funds <span class="token keyword">for</span> intrinsic transaction cost <span class="token punctuation">[</span> See<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>links<span class="token punctuation">.</span>ethers<span class="token punctuation">.</span>org<span class="token operator">/</span>v5<span class="token operator">-</span>errors<span class="token operator">-</span><span class="token constant">INSUFFICIENT_FUNDS</span> <span class="token punctuation">]</span> <span class="token punctuation">(</span>error<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">&quot;reason&quot;</span><span class="token operator">:</span><span class="token string">&quot;processing response error&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span><span class="token string">&quot;SERVER_ERROR&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;body&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;id\&quot;:52,\&quot;error\&quot;:{\&quot;code\&quot;:-32000,\&quot;message\&quot;:\&quot;insufficient funds for transfer\&quot;}}\n&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;error&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">32000</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;requestBody&quot;</span><span class="token operator">:</span><span class="token string">&quot;{\&quot;method\&quot;:\&quot;eth_estimateGas\&quot;,\&quot;params\&quot;:[{\&quot;gasPrice\&quot;:\&quot;0x3b9aca00\&quot;,\&quot;value\&quot;:\&quot;0xde0b6b3a7640000\&quot;,\&quot;from\&quot;:\&quot;0x79d8b50477c84d0c74634513aca923ddfabf3cb2\&quot;,\&quot;to\&quot;:\&quot;0x51e09974efaf3a7f46671c3f1120166361fd2efe\&quot;}],\&quot;id\&quot;:52,\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;}&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;requestMethod&quot;</span><span class="token operator">:</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://10.182.10.193:1234&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">&quot;estimateGas&quot;</span><span class="token punctuation">,</span> transaction<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string-property property">&quot;from&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x79d8B50477c84D0C74634513acA923ddFabf3CB2&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;gasPrice&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;BigNumber&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;hex&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x3b9aca00&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;to&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x51E09974EFAf3a7f46671c3f1120166361Fd2EfE&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;BigNumber&quot;</span><span class="token punctuation">,</span><span class="token string-property property">&quot;hex&quot;</span><span class="token operator">:</span><span class="token string">&quot;0x0de0b6b3a7640000&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string-property property">&quot;accessList&quot;</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token constant">INSUFFICIENT_FUNDS</span><span class="token punctuation">,</span> version<span class="token operator">=</span>providers<span class="token operator">/</span><span class="token number">5.6</span><span class="token number">.8</span><span class="token punctuation">)</span>
    at Logger<span class="token punctuation">.</span><span class="token function">makeError</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">261</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">)</span>
    at Logger<span class="token punctuation">.</span><span class="token function">throwError</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">273</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
    at <span class="token function">checkError</span> <span class="token punctuation">(</span>json<span class="token operator">-</span>rpc<span class="token operator">-</span>provider<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">98</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
    at JsonRpcProvider<span class="token punctuation">.</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span>json<span class="token operator">-</span>rpc<span class="token operator">-</span>provider<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">603</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
    at Generator<span class="token punctuation">.</span><span class="token function">throw</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    at <span class="token function">rejected</span> <span class="token punctuation">(</span>base<span class="token operator">-</span>provider<span class="token punctuation">.</span>ts<span class="token operator">:</span><span class="token number">2208</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>内在交易成本资金不足，应该是用户的账户地址没eth了，通过调用<code>this.Provider().getBalance(this.userAddress)</code>方法可以查看余额</p></blockquote> <ul><li>调授权接口的时报错：<code>index.ts:261 Uncaught (in promise) Error: transaction failed</code></li></ul> <blockquote><p>应该是<code>gasLimit</code>的传参的问题, 值设大点就可以了...</p></blockquote> <ul><li>调合约方法报错：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>inpage.js:1 MetaMask - RPC Error: Internal JSON-RPC error. <span class="token punctuation">{</span>code: -32603, message: <span class="token string">'Internal JSON-RPC error.'</span>, data: <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">}</span>code: -32603data: <span class="token punctuation">{</span>code: -32000, message: <span class="token string">'execution reverted'</span><span class="token punctuation">}</span>message: <span class="token string">&quot;Internal JSON-RPC error.&quot;</span><span class="token punctuation">[</span><span class="token punctuation">[</span>Prototype<span class="token punctuation">]</span><span class="token punctuation">]</span>: Object

contract02.ts:221 Error: cannot estimate gas<span class="token punctuation">;</span> transaction may fail or may require manual gas limit <span class="token punctuation">[</span> See: https://links.ethers.org/v5-errors-UNPREDICTABLE_GAS_LIMIT <span class="token punctuation">]</span> <span class="token punctuation">(</span>reason<span class="token operator">=</span><span class="token string">&quot;execution reverted&quot;</span>, <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">&quot;estimateGas&quot;</span>, <span class="token assign-left variable">transaction</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;from&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;0x5Eab66c132E5A522259d3569C9D8D000aFc7c44A&quot;</span>,<span class="token string">&quot;to&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;0x6260fb50e464C58566Ac99201dA398E7dC355Ca4&quot;</span>,<span class="token string">&quot;data&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;0x8042d1bf0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000003e70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000004068747470733a2f2f63646e2e73696e61636c6f75642e6e65742f636861696e2f3066376638333939363165393838343165303965616536386462343137653835&quot;</span>,<span class="token string">&quot;accessList&quot;</span>:null<span class="token punctuation">}</span>, <span class="token assign-left variable">error</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span>:-32603,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Internal JSON-RPC error.&quot;</span>,<span class="token string">&quot;data&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span>:-32000,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;execution reverted&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;stack&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;{<span class="token entity" title="\n">\n</span>  <span class="token entity" title="\&quot;">\&quot;</span>code<span class="token entity" title="\&quot;">\&quot;</span>: -32603,<span class="token entity" title="\n">\n</span>  <span class="token entity" title="\&quot;">\&quot;</span>message<span class="token entity" title="\&quot;">\&quot;</span>: <span class="token entity" title="\&quot;">\&quot;</span>Internal JSON-RPC error.<span class="token entity" title="\&quot;">\&quot;</span>,<span class="token entity" title="\n">\n</span>  <span class="token entity" title="\&quot;">\&quot;</span>data<span class="token entity" title="\&quot;">\&quot;</span>: {<span class="token entity" title="\n">\n</span>    <span class="token entity" title="\&quot;">\&quot;</span>code<span class="token entity" title="\&quot;">\&quot;</span>: -32000,<span class="token entity" title="\n">\n</span>    <span class="token entity" title="\&quot;">\&quot;</span>message<span class="token entity" title="\&quot;">\&quot;</span>: <span class="token entity" title="\&quot;">\&quot;</span>execution reverted<span class="token entity" title="\&quot;">\&quot;</span><span class="token entity" title="\n">\n</span>  },<span class="token entity" title="\n">\n</span>  <span class="token entity" title="\&quot;">\&quot;</span>stack<span class="token entity" title="\&quot;">\&quot;</span>: <span class="token entity" title="\&quot;">\&quot;</span>Error: Internal JSON-RPC error.<span class="token entity" title="\\">\\</span>n    at new i (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:183112)<span class="token entity" title="\\">\\</span>n    at s (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:180655)<span class="token entity" title="\\">\\</span>n    at Object.internal (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:181265)<span class="token entity" title="\\">\\</span>n    at u (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/background-1.js:1:105253)<span class="token entity" title="\\">\\</span>n    at chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/background-1.js:1:106285<span class="token entity" title="\\">\\</span>n    at async chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:18:160950<span class="token entity" title="\&quot;">\&quot;</span><span class="token entity" title="\n">\n</span>}<span class="token entity" title="\n">\n</span>  at new i (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:183112)<span class="token entity" title="\n">\n</span>  at s (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:180655)<span class="token entity" title="\n">\n</span>  at Object.internal (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:1:181265)<span class="token entity" title="\n">\n</span>  at u (chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/background-1.js:1:105253)<span class="token entity" title="\n">\n</span>  at chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/background-1.js:1:106285<span class="token entity" title="\n">\n</span>  at async chrome-extension://lppkaedlaekcakaleabiodoomlckjecj/common-0.js:18:160950&quot;</span><span class="token punctuation">}</span>, <span class="token assign-left variable">code</span><span class="token operator">=</span>UNPREDICTABLE_GAS_LIMIT, <span class="token assign-left variable">version</span><span class="token operator">=</span>providers/5.6.8<span class="token punctuation">)</span>
    at Logger.makeError <span class="token punctuation">(</span>index.ts:261:28<span class="token punctuation">)</span>
    at Logger.throwError <span class="token punctuation">(</span>index.ts:273:20<span class="token punctuation">)</span>
    at checkError <span class="token punctuation">(</span>json-rpc-provider.ts:78:20<span class="token punctuation">)</span>
    at Web3Provider.<span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span> <span class="token punctuation">(</span>json-rpc-provider.ts:603:20<span class="token punctuation">)</span>
    at Generator.throw <span class="token punctuation">(</span><span class="token operator">&lt;</span>anonymous<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    at rejected <span class="token punctuation">(</span>base-provider.ts:2208:5<span class="token punctuation">)</span>
</code></pre></div><ul><li>调合约报错：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Error: invalid BigNumber value (argument=&quot;value&quot;, value=null, code=INVALID_ARGUMENT, version=bignumber/5.6.2)
</code></pre></div><ul><li>CryptoJS 解密出现报错：<code>Malformed UTF-8 data</code></li></ul> <blockquote><p>估计是传参不符合规范吧，先暂时统一按钱包生成失败处理~</p></blockquote> <h2 id="备注"><a href="#备注" class="header-anchor">#</a> 备注</h2> <h3 id="metamask原理总结"><a href="#metamask原理总结" class="header-anchor">#</a> MetaMask原理总结</h3> <ul><li><p>一个钱包里可以有无限个账户。每个账户都有自己的地址和密钥，每个账户都可以根据地址在区块链浏览器上查看账本。助记词是对于钱包来说的，一个钱包只有一个助记词，无论钱包里有多少个账户都是用一个助记词。</p></li> <li><p>点击小狐狸界面右上角头像处，可以新建或导入多个钱包账户，不过除了第一个账户需要助记词，后面新导入的或新建的都是只有秘钥形式存在。在该页面的 设置 里选择 安全与隐私 可以查看助记词，不过这个助记词是第一个账号的。</p></li></ul> <p>MetaMask可以通过 <code>私钥</code> 或 <code>keystore文件</code> 导入账户。</p> <ul><li><strong>MetaMask 怎么保存私钥？</strong></li></ul> <p>MetaMask不会将用户私钥存储在任何服务器上，而是通过密码保护安全地存储在浏览器主文件夹中。</p> <p>MetaMask支持通过硬件钱包以离线方式存储用户私钥，保障用户资产安全。私钥决定用户资产的所有权，就类似用户在银行的所有权凭证或保险柜钥匙，公钥类似于用户在银行开设的一个账户，地址就类似用户的银行卡号。<strong>在区块链系统上，公钥和地址是用户对外公开的，而私钥则是万不能泄露的，私钥安全对用户而言至关重要</strong>。相比于服务器托管用户私钥的方式，MetaMask可以借助硬件钱包将私钥进行本地存储，极大帮助用户账户的隐私安全。</p> <ol><li>MetaMask第一次进入会先创建密码；然后生成助记词，生成钱包；之后会 钱包+密码 生成 Keystore 文件；</li> <li>退出登录后，输入密码，先从 Keystore 文件解密出私钥，登录成功，开始交易；</li> <li>重置钱包后，导入助记词，输入密码，重新生成钱包，备份 Keystore 文件；</li></ol> <blockquote><p>助记词和密码不会存到浏览器或服务器，需要用户自己记住；本地会缓存 Keystore 文件</p></blockquote> <p>助记词（seed phrase/Secret Recovery Phrase）可以用于恢复钱包，当钱包恢复时会提示设置密码（password），这个密码就是守护这个扩展程序和app钱包的，这个密码只对当前这个实例有效。</p> <p>助记词恢复钱包时只先恢复第一个账户，那其他账户呢？通过创建账户，钱包会按照原来创建账户的顺序恢复你的账户。所以说，只要有了你钱包的助记词，就能够恢复、控制你钱包上所有的账户，你的钱包不再安全。</p> <p>私钥是相对账户来说的，每一个账户都有一个地址，对应一个私钥；导出私钥需要先输入自己的设置的密码。</p> <h3 id="初始化流程"><a href="#初始化流程" class="header-anchor">#</a> 初始化流程</h3> <p>页面初次加载，判断是否安装metamask，是则按之前的流程走；否则生成离线钱包</p> <div class="language-js extra-class"><pre class="language-js"><code>私钥 <span class="token operator">+</span> 密码<span class="token punctuation">,</span> 用crypto加密，加密后存储本地
刷新页面后，先判断能否拿到本地加密后的私钥 和 用户账户地址，不能则提示导入助记词生成钱包<span class="token punctuation">;</span> 调去中心接口时，提示用户输入密码，解密，通过私钥生成钱包；
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">流程总结</p> <ul><li><p>钱包初始化
是否已安装metamask
是：重置信息，获取钱包账户地址全局保存，页面初始化
否：判断本地是否有加密私钥+用户地址
是：页面初始化
否：跳至 /wallet-intro 页面，通过助记词生成钱包
生成钱包后，本地缓存加密私钥+用户地址，跳至首页 /welcome</p></li> <li><p>页面初始化
获取合约信息、获取用户信息、获取新人引导步骤，未注册则跳转 /login 页面</p></li> <li><p>调中心化接口
是否已安装metamask
是：获取MetaMask钱包，生成Contract实例，传入 address 和 abi, 调接口
否：输入密码，解密缓存本地私钥，通过私钥生成钱包，生成Contract实例，传入 address 和 abi, 调接口</p></li></ul></div> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <ul><li><strong>用户第一次进入页面的输入的密码（初始化MetaMask时也有）在哪里会用到？</strong></li></ul> <blockquote><p>创建钱包输入的密码，并不是用于生成种子，而是用来做 keystore 加密的密码，这是业内的一个常规做法，尽管这个做法会降低一些安全性，但是不遵循行规，会导致和其他的钱包不兼容，及在其他钱包的助记词不能导入到我们钱包，或反之。keystore 文件应该存储在内部存储沙盒类，即应用程序自身目录内，保证其他程序无法读取内容，万万不可存取在外部存储中，如SD卡。</p></blockquote> <ul><li><p><strong>MetaMask钱包有多个账户，ethers通过助记词生成的账户只有一个？</strong></p></li> <li><p><strong>助记词，私钥公钥，密码需要存到哪里？</strong></p></li></ul> <blockquote><p>助记词需要用户单独保存在只有自己知道的地方；公钥不需要保存；私钥也是需要用户单独保存，只有用户自己知道，因为需要通过私钥生成自己的钱包（但一般保存助记词就可以了，可以通过助记词生成钱包）；密码则需要用户自己保存，一般都是通过<code>密码 + 加密后的私钥 = 私钥</code>生成私钥</p></blockquote> <ul><li><strong>助记词怎么导入？</strong></li></ul> <blockquote><p>用户手动输入助记词，通过调用 <code>ethers.js</code> 的 <code>Wallet.fromMnemonic</code>方法生成钱包，详见上方示例</p></blockquote> <ul><li><strong>新注册的用户如何获取互通币（ht_amount）购买nft道具？如何获取燃料费(eth)?</strong></li></ul> <blockquote><p>nft道具需要互通币（ht_amount）购买，有token_id；普通道具需要互助币（hz_amount）购买，无token_id；如果没有互通币和燃料费, 可通过互助币充值~</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">说明</p> <ol><li>互助币 = hz_amount =&gt; 中心化币，购买游戏道具（图标为 F），新用户初始化赠送2000，可换购燃料费、互通币</li> <li>互通币 = ht_amount =&gt; 去中心化币，购买nft（图标为￥），新用户初始化为0，需要通过互助币充值，汇率 1:1</li> <li>燃料费 = eth_amount =&gt; eth货币，每次交易需要花费一定eth，新用户初始化为0，可通过互助币充值，汇率 =&gt; 燃料费： 互助币 = 1：1000</li></ol></div> <ul><li>如果往测试账号里加点钱?</li></ul> <blockquote><p>可通过充值实现，初始化时送用户一定中心化币a，可以通过用户手动充值转换为交易需要的燃料费eth，也可转换为购买NFT道具时需要的去中心化币b，有一定汇率~</p></blockquote> <ul><li><strong>怎么判断交易是否成功？</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> transactionHash <span class="token operator">=</span> <span class="token string">&quot;0xa4ddad980075786c204b45ab8193e543aec4411bd94894abef47dc90d4d3cc01&quot;</span>

<span class="token comment">// 获取交易信息</span>
provider<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>transactionHash<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">transaction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 授权合约发送之后返回的参数 transaction</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">accessList</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">blockHash</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">blockNumber</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">chainId</span><span class="token operator">:</span> <span class="token number">9215</span> <span class="token comment">// </span>
        <span class="token literal-property property">confirmations</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token literal-property property">creates</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&quot;0x095ea7b300000000000000000000000010b4b88cf23f594f12e51a2e753167eb126e64830000000000000000000000000000000000000000000000004563918244f40000&quot;</span>
        <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">&quot;0x5Eab66c132E5A522259d3569C9D8D000aFc7c44A&quot;</span> <span class="token comment">// 发起交易的账户地址</span>
        <span class="token literal-property property">gasLimit</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x640b'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
        <span class="token literal-property property">gasPrice</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x3b9aca00'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
        <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token string">&quot;0xe5a20f7327d3e5d05e20a2a3d798beafac4c232ef819eed524b8b6b8d5b01c86&quot;</span>
        <span class="token literal-property property">nonce</span><span class="token operator">:</span> <span class="token number">14</span> <span class="token comment">// 每次交易都会生成一个唯一性的序号</span>
        <span class="token literal-property property">r</span><span class="token operator">:</span> <span class="token string">&quot;0xa9b4fe617477910f7a358909b0ed1b9c45905a16ee7081b7966f389dcc2d610d&quot;</span>
        <span class="token literal-property property">s</span><span class="token operator">:</span> <span class="token string">&quot;0x4c024203a56dd3e73ef0e261bb64cde6f49264175843ac366dc9f1d8c09db9fa&quot;</span>
        <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">&quot;0x51E09974EFAf3a7f46671c3f1120166361Fd2EfE&quot;</span> <span class="token comment">// 目标地址</span>
        <span class="token literal-property property">transactionIndex</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token literal-property property">v</span><span class="token operator">:</span> <span class="token number">18465</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x00'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token comment">// 用户转账金额</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取交易回复</span>
provider<span class="token punctuation">.</span><span class="token function">getTransactionReceipt</span><span class="token punctuation">(</span>transactionHash<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">receipt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>receipt<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  授权合约调用成功之后返回的参数 receipt</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">blockHash</span><span class="token operator">:</span> <span class="token string">&quot;0x004bfdc5d2b04f45c8339a74c7e346d0c45cf46d1b166cde31fe57cee8d22cdf&quot;</span> <span class="token comment">// 调用成功后生成</span>
        <span class="token literal-property property">blockNumber</span><span class="token operator">:</span> <span class="token number">593466</span>
        <span class="token literal-property property">byzantium</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token literal-property property">confirmations</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token literal-property property">contractAddress</span><span class="token operator">:</span> <span class="token keyword">null</span>
        <span class="token literal-property property">cumulativeGasUsed</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x640b'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
        <span class="token literal-property property">effectiveGasPrice</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x3b9aca00'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
        <span class="token literal-property property">events</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">&quot;0x5Eab66c132E5A522259d3569C9D8D000aFc7c44A&quot;</span>
        <span class="token literal-property property">gasUsed</span><span class="token operator">:</span> BigNumber <span class="token punctuation">{</span><span class="token literal-property property">_hex</span><span class="token operator">:</span> <span class="token string">'0x640b'</span><span class="token punctuation">,</span> <span class="token literal-property property">_isBigNumber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token comment">// 本次交易花费的gas</span>
        <span class="token literal-property property">logs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token literal-property property">logsBloom</span><span class="token operator">:</span> <span class="token string">&quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200200000000000002000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000480000000000000000000000000000000000000020000000000000000020000004000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000020000000000000000000000&quot;</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">&quot;0x51E09974EFAf3a7f46671c3f1120166361Fd2EfE&quot;</span> <span class="token comment">// 目标地址</span>
        <span class="token literal-property property">transactionHash</span><span class="token operator">:</span> <span class="token string">&quot;0xe5a20f7327d3e5d05e20a2a3d798beafac4c232ef819eed524b8b6b8d5b01c86&quot;</span> <span class="token comment">// 交易hash</span>
        <span class="token literal-property property">transactionIndex</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>一般交易成功后<code>getTransactionReceipt</code>返回的<code>status=1,且logs.length&gt;=1</code>~</p></blockquote> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://learnblockchain.cn/2019/04/11/wallet-dev-guide/#ethers.js" target="_blank" rel="noopener noreferrer">如何开发钱包 - 技术文章整理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/weixin_43343144/article/details/89222438" target="_blank" rel="noopener noreferrer">基于ethers.js库同时兼容实现MetaMask钱包和独立的HDWallet钱包代码总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <a href="/more/web3/" class="fix-link" data-v-84d70020>Back</a></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/blog/tags/?tag=ethers" title="标签">#ethers</a><a href="/blog/tags/?tag=metamask" title="标签">#metamask</a><a href="/blog/tags/?tag=wallet" title="标签">#wallet</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/11/2023, 10:29:38 AM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/more/node-deploy.html"><div>
            Vue+Node实现可视化部署工具
            <!----></div></a> <span class="date">01-21</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/tool/vscode-plugins.html"><div>
            VSCode插件开发笔记
            <!----></div></a> <span class="date">01-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/skills/vue/vue3-cli-repo.html"><div>
            开发一个快速搭建vue3项目的脚手架
            <!----></div></a> <span class="date">12-13</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>一苇 | <a href="https://beian.miit.gov.cn/" target="_blank" style="font-weight:normal"><img src="/blog/images/icp.png" width="20" height="20" alt="公网备案"/>京ICP备2021006935号-2</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><!----><!----><div></div></div></div>
    <script src="/blog/assets/js/app.76fa57e6.js" defer></script><script src="/blog/assets/js/3.a2a245ac.js" defer></script><script src="/blog/assets/js/97.23b93196.js" defer></script><script src="/blog/assets/js/4.245b4373.js" defer></script>
  </body>
</html>
